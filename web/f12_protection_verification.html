<!DOCTYPE html>
<html>
<head>
    <title>F12 Protection Verification Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { border: 1px solid #ddd; margin: 10px 0; padding: 15px; }
        .pass { color: green; }
        .fail { color: red; }
        .warning { color: orange; }
        #results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>F12 Protection Verification Test</h1>
    <p><strong>Instructions:</strong> This page tests the F12 protection system. Try the following:</p>
    <ol>
        <li>Press F12 (should be blocked)</li>
        <li>Try Ctrl+Shift+I (should be blocked)</li>
        <li>Right-click (should be blocked)</li>
        <li>Open console and try: score = 999999</li>
        <li>Try: lives = 999</li>
        <li>Try: level = 999</li>
        <li>Try: cheat_score = 100000</li>
    </ol>
    
    <div id="results"></div>
    
    <script>
        // Include the same protection system from breakout.html
        // =====================================================
        // COMPREHENSIVE F12 PROTECTION SYSTEM
        // =====================================================
        
        // Global security state
        const SECURITY_STATE = {
            devToolsDetected: false,
            tamperingDetected: false,
            consoleBlocked: false,
            gameCompromised: false,
            lastIntegrityCheck: Date.now(),
            protectionLevel: 'MAXIMUM'
        };

        // 1. DEV TOOLS DETECTION SYSTEM
        (function() {
            let devtools = { open: false, orientation: null };
            
            // Method 1: Console object monitoring - Block ALL console methods
            const originalConsole = {};
            ['log', 'warn', 'error', 'info', 'debug', 'trace', 'dir', 'dirxml', 'table', 'clear'].forEach(method => {
                originalConsole[method] = console[method];
                Object.defineProperty(console, method, {
                    get: function() {
                        SECURITY_STATE.devToolsDetected = true;
                        triggerSecurityResponse('console_access_' + method, 'CRITICAL');
                        return function() {}; // Return empty function
                    },
                    configurable: false
                });
            });

            // Method 2: Performance timing detection
            setInterval(function() {
                const before = performance.now();
                debugger;
                const after = performance.now();
                
                if (after - before > 100) {
                    SECURITY_STATE.devToolsDetected = true;
                    triggerSecurityResponse('debugger_detected', 'CRITICAL');
                }
            }, 1000);

            // Method 3: Window size detection
            let threshold = 160;
            const detect = () => {
                if (window.outerHeight - window.innerHeight > threshold || 
                    window.outerWidth - window.innerWidth > threshold) {
                    if (!devtools.open) {
                        devtools.open = true;
                        SECURITY_STATE.devToolsDetected = true;
                        triggerSecurityResponse('devtools_size_detection', 'CRITICAL');
                    }
                } else {
                    devtools.open = false;
                }
            };
            
            setInterval(detect, 500);
            window.addEventListener('resize', detect);

            // Method 4: Feature detection
            const detectDevTools = () => {
                const start = performance.now();
                originalConsole.log(start);
                const end = performance.now();
                
                if (end - start > 5) {
                    SECURITY_STATE.devToolsDetected = true;
                    triggerSecurityResponse('console_timing_anomaly', 'CRITICAL');
                }
            };
            
            setInterval(detectDevTools, 2000);

            // Method 5: Keyboard shortcut detection
            document.addEventListener('keydown', function(e) {
                // F12
                if (e.keyCode === 123) {
                    e.preventDefault();
                    triggerSecurityResponse('f12_key_detected', 'CRITICAL');
                    return false;
                }
                
                // Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
                if ((e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) || 
                    (e.ctrlKey && e.keyCode === 85)) {
                    e.preventDefault();
                    triggerSecurityResponse('dev_shortcut_detected', 'CRITICAL');
                    return false;
                }
                
                // Ctrl+Shift+C (element inspector)
                if (e.ctrlKey && e.shiftKey && e.keyCode === 67) {
                    e.preventDefault();
                    triggerSecurityResponse('inspector_shortcut_detected', 'CRITICAL');
                    return false;
                }
            });

            // Method 6: Right-click context menu blocking
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                triggerSecurityResponse('right_click_blocked', 'HIGH');
                return false;
            });

            // Method 7: Disable text selection
            document.addEventListener('selectstart', function(e) {
                if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                    return false;
                }
            });
        })();

        // 2. PROTECTED VARIABLE SYSTEM
        const GameSecurityManager = (function() {
            let _score = 0;
            let _lives = 3;
            let _level = 1;
            let _sessionValid = true;
            
            // Honeypot variables that should never be accessed legitimately
            window.cheat_score = 0;
            window.admin_mode = false;
            window.debug_enabled = false;
            
            // Monitor honeypot access
            Object.defineProperty(window, 'cheat_score', {
                get: function() {
                    triggerSecurityResponse('honeypot_cheat_score_access', 'CRITICAL');
                    return 0;
                },
                set: function(value) {
                    triggerSecurityResponse('honeypot_cheat_score_modification', 'CRITICAL');
                },
                configurable: false
            });

            return {
                // Protected score getter/setter
                get score() {
                    return _score;
                },
                set score(value) {
                    if (!validateScoreChange(value)) {
                        triggerSecurityResponse('invalid_score_modification', 'CRITICAL');
                        return;
                    }
                    const oldScore = _score;
                    _score = Math.max(0, Math.floor(value));
                    
                    // Log score changes for analysis
                    if (Math.abs(_score - oldScore) > 500) {
                        triggerSecurityResponse('suspicious_score_jump', 'HIGH');
                    }
                },
                
                // Protected lives getter/setter
                get lives() {
                    return _lives;
                },
                set lives(value) {
                    if (value > _lives && !validateLifeIncrease()) {
                        triggerSecurityResponse('invalid_life_increase', 'CRITICAL');
                        return;
                    }
                    _lives = Math.max(0, Math.min(10, Math.floor(value)));
                },
                
                // Protected level getter/setter
                get level() {
                    return _level;
                },
                set level(value) {
                    if (value < _level) {
                        triggerSecurityResponse('level_regression_attempt', 'HIGH');
                        return;
                    }
                    _level = Math.max(1, Math.min(100, Math.floor(value)));
                },
                
                // Session validation
                invalidateSession: function() {
                    _sessionValid = false;
                    SECURITY_STATE.gameCompromised = true;
                },
                
                isSessionValid: function() {
                    return _sessionValid && !SECURITY_STATE.gameCompromised;
                }
            };
            
            function validateScoreChange(newScore) {
                const currentTime = Date.now();
                const timeDiff = currentTime - (window.lastScoreUpdate || currentTime);
                const scoreDiff = Math.abs(newScore - _score);
                
                // Maximum reasonable score increase per second
                const maxScorePerSecond = 1000;
                if (timeDiff > 0 && scoreDiff > (maxScorePerSecond * (timeDiff / 1000))) {
                    return false;
                }
                
                window.lastScoreUpdate = currentTime;
                return true;
            }
            
            function validateLifeIncrease() {
                // Lives should only increase through legitimate powerups
                return window.legit_powerup_collected === true;
            }
        })();

        // 3. SECURITY RESPONSE SYSTEM
        function triggerSecurityResponse(violationType, severity) {
            const timestamp = new Date().toISOString();
            const userAgent = navigator.userAgent;
            const url = window.location.href;
            
            // Log security event to our results div instead of console
            const resultsDiv = document.getElementById('results');
            const logEntry = document.createElement('div');
            logEntry.className = 'test-section';
            logEntry.innerHTML = `
                <h3 class="fail">🚨 SECURITY VIOLATION DETECTED</h3>
                <p><strong>Type:</strong> ${violationType}</p>
                <p><strong>Severity:</strong> ${severity}</p>
                <p><strong>Time:</strong> ${timestamp}</p>
            `;
            resultsDiv.appendChild(logEntry);
            
            // Update security state
            SECURITY_STATE.tamperingDetected = true;
            
            // Severity-based responses
            if (severity === 'CRITICAL') {
                SECURITY_STATE.gameCompromised = true;
                GameSecurityManager.invalidateSession();
                
                // Display warning
                setTimeout(() => {
                    alert('🚨 CRITICAL: Security violation detected! F12 protection is working.');
                }, 100);
            }
        }

        // 4. INITIALIZATION
        (function initializeSecurity() {
            // Replace global variables with protected versions
            Object.defineProperty(window, 'score', {
                get: () => GameSecurityManager.score,
                set: (value) => GameSecurityManager.score = value,
                configurable: false
            });
            
            Object.defineProperty(window, 'lives', {
                get: () => GameSecurityManager.lives,
                set: (value) => GameSecurityManager.lives = value,
                configurable: false
            });
            
            Object.defineProperty(window, 'level', {
                get: () => GameSecurityManager.level,
                set: (value) => GameSecurityManager.level = value,
                configurable: false
            });
            
            // Block eval
            Object.defineProperty(window, 'eval', {
                get: function() {
                    triggerSecurityResponse('eval_access_blocked', 'CRITICAL');
                    return function() { return null; };
                },
                configurable: false
            });
            
            // Status display
            const statusDiv = document.createElement('div');
            statusDiv.className = 'test-section';
            statusDiv.innerHTML = '<h3 class="pass">✅ F12 Protection System Active</h3><p>Security monitoring is now active. Try the test scenarios above.</p>';
            document.getElementById('results').appendChild(statusDiv);
        })();

        // Test runner
        setTimeout(() => {
            const testDiv = document.createElement('div');
            testDiv.className = 'test-section';
            testDiv.innerHTML = `
                <h3>Automated Tests</h3>
                <button onclick="testVariableProtection()">Test Variable Protection</button>
                <button onclick="testHoneypots()">Test Honeypot Protection</button>
                <button onclick="testEval()">Test Eval Protection</button>
            `;
            document.getElementById('results').appendChild(testDiv);
        }, 1000);

        function testVariableProtection() {
            try {
                window.score = 999999;
                window.lives = 999;
                window.level = 999;
            } catch(e) {
                // Expected
            }
        }

        function testHoneypots() {
            try {
                window.cheat_score = 100000;
                let x = window.cheat_score;
            } catch(e) {
                // Expected
            }
        }

        function testEval() {
            try {
                window.eval('alert("This should be blocked")');
            } catch(e) {
                // Expected
            }
        }
    </script>
</body>
</html>