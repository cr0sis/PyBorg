<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Breakout Debug</title>
    <style>
        body { margin: 0; padding: 20px; background: #000; color: #fff; }
        canvas { border: 1px solid #fff; display: block; margin: 20px auto; }
        #debug { color: #0f0; font-family: monospace; margin: 20px; }
    </style>
</head>
<body>
    <div id="debug">Debug Output:</div>
    <canvas id="gameCanvas" width="1000" height="750"></canvas>
    
    <script>
        const debug = document.getElementById('debug');
        const log = (msg) => {
            debug.innerHTML += '<br>' + new Date().toLocaleTimeString() + ': ' + msg;
        };
        
        log('Page loaded');
        
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        if (!ctx) {
            log('ERROR: Cannot get canvas context');
        } else {
            log('Canvas context obtained');
            
            // Simple test drawing
            ctx.fillStyle = '#fff';
            ctx.fillRect(450, 650, 100, 10); // Paddle
            ctx.beginPath();
            ctx.arc(500, 640, 5, 0, Math.PI * 2);
            ctx.fill(); // Ball
            
            log('Test drawing complete');
        }
        
        // Test loading the actual game
        fetch('breakout.html')
            .then(r => {
                log('Breakout.html fetch status: ' + r.status);
                return r.text();
            })
            .then(text => {
                log('Breakout.html size: ' + text.length + ' bytes');
                
                // Check for obvious errors
                if (text.includes('console.error')) {
                    log('File contains error handling code');
                }
                if (text.includes('initBreakoutGame')) {
                    log('initBreakoutGame function found');
                }
                if (text.includes('startGame')) {
                    log('startGame function found');
                }
            })
            .catch(e => log('ERROR fetching breakout.html: ' + e));
            
        // Test game_session.php
        fetch('game_session.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                action: 'start_session',
                player_name: 'TestPlayer'
            })
        })
        .then(r => {
            log('game_session.php status: ' + r.status);
            return r.text();
        })
        .then(text => {
            log('game_session.php response: ' + text.substring(0, 200));
        })
        .catch(e => log('ERROR with game_session.php: ' + e));
    </script>
</body>
</html>