<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyBorg - IRC Bot Documentation</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Advanced IRC bot with AI integration, multi-network support, web interface, and interactive games. Features include PyBorg AI chat, UNO game, breakout, weather commands, and real-time monitoring.">
    <meta name="keywords" content="IRC bot, PyBorg, AI chat bot, multi-network IRC, web interface, interactive games, UNO, breakout, weather bot, Python IRC">
    <meta name="author" content="cr0s.is">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://cr0s.is/">
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="PyBorg - IRC Bot Documentation">
    <meta property="og:description" content="Advanced IRC bot with AI integration, multi-network support, web interface, and interactive games. Features include PyBorg AI chat, UNO game, breakout, weather commands, and real-time monitoring.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://cr0s.is/">
    <meta property="og:site_name" content="cr0s.is">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="PyBorg - IRC Bot Documentation">
    <meta name="twitter:description" content="Advanced IRC bot with AI integration, multi-network support, web interface, and interactive games.">
    <meta name="twitter:site" content="@cr0s">
    
    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "PyBorg IRC Bot",
        "description": "Advanced IRC bot with AI integration, multi-network support, web interface, and interactive games",
        "url": "https://cr0s.is/",
        "applicationCategory": "CommunicationApplication",
        "operatingSystem": "Linux",
        "programmingLanguage": "Python",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "author": {
            "@type": "Organization",
            "name": "cr0s.is"
        },
        "featureList": [
            "AI-powered chat responses",
            "Multi-network IRC support",
            "Web-based administration",
            "Interactive games (UNO, Breakout)",
            "Weather and API commands",
            "Real-time monitoring",
            "Two-factor authentication"
        ]
    }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/css/terminal.css?v=20250810" id="terminal-css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #3b82f6;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-tertiary: #f3f4f6;
            --border-light: #e5e7eb;
            --border-medium: #d1d5db;
            --accent-blue: #eff6ff;
            --accent-green: #f0fdf4;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --font-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
        }

        [data-theme="dark"] {
            --primary-color: #3b82f6;
            --primary-dark: #2563eb;
            --primary-light: #60a5fa;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            --bg-primary: #1f2937;
            --bg-secondary: #111827;
            --bg-tertiary: #374151;
            --border-light: #374151;
            --border-medium: #4b5563;
            --accent-blue: #1e3a8a;
            --accent-green: #14532d;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.3), 0 2px 4px -2px rgb(0 0 0 / 0.3);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.3), 0 4px 6px -4px rgb(0 0 0 / 0.3);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            font-weight: 400;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        /* Dark Mode Toggle */
        .theme-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 0.75rem;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .theme-toggle:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-medium);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .theme-toggle-icon {
            font-size: 1rem;
            color: var(--primary-color);
            transition: transform 0.2s ease;
        }

        .theme-toggle:hover .theme-toggle-icon {
            transform: rotate(15deg);
        }
        
        /* Loading spinner animation */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Notification slide-in animation */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* User Authentication */
        .auth-container {
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1000;
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .user-info {
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 0.75rem 1rem;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-primary);
            position: relative;
        }

        .profile-picture {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin-right: 0.5rem;
            vertical-align: middle;
            border: 2px solid var(--border-light);
        }

        .fallback-emoji {
            margin-right: 0.5rem;
        }

        /* Color Picker Styles */
        .username-clickable {
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            transition: background-color 0.2s ease;
            border: 1px solid transparent;
        }

        .username-clickable:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-medium);
        }

        .color-picker-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 1rem;
            box-shadow: var(--shadow-lg);
            z-index: 1001;
            width: 280px;
            display: none;
        }

        .color-picker-dropdown.active {
            display: block;
        }

        .color-picker-title {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        .color-wheel-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto 1rem;
        }

        .color-wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            cursor: crosshair;
        }

        .color-wheel-pointer {
            position: absolute;
            width: 12px;
            height: 12px;
            border: 2px solid white;
            border-radius: 50%;
            pointer-events: none;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 4px rgba(0,0,0,0.3);
        }

        .hue-slider-container {
            margin-bottom: 1rem;
        }

        .hue-slider {
            width: 100%;
            height: 20px;
            border-radius: 10px;
            background: linear-gradient(to right, 
                #ff0000 0%, #ffff00 16.66%, #00ff00 33.33%, 
                #00ffff 50%, #0000ff 66.66%, #ff00ff 83.33%, #ff0000 100%);
            position: relative;
            cursor: pointer;
        }

        .hue-slider-thumb {
            position: absolute;
            width: 16px;
            height: 16px;
            border: 2px solid white;
            border-radius: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            box-shadow: 0 0 4px rgba(0,0,0,0.3);
        }

        .color-preview-section {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .color-preview {
            width: 40px;
            height: 40px;
            border: 2px solid var(--border-medium);
            border-radius: var(--radius-md);
            box-shadow: inset 0 0 0 1px rgba(0,0,0,0.1);
        }

        .color-info {
            flex: 1;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .color-picker-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .color-picker-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .color-picker-btn.primary {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .color-picker-btn.primary:hover {
            background: var(--primary-dark);
            border-color: var(--primary-dark);
        }

        .color-picker-btn.secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .color-picker-btn.secondary:hover {
            background: var(--bg-tertiary);
        }

        .auth-button {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .auth-button:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }

        .auth-button.secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-light);
        }

        .auth-button.secondary:hover {
            background: var(--bg-secondary);
        }

        /* SSO Button Styles */
        .sso-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-md);
            background: var(--bg-primary);
            color: var(--text-primary);
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
            margin-bottom: 0.5rem;
        }

        .sso-button:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-medium);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
            color: var(--text-primary);
            text-decoration: none;
        }

        .sso-button img {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .sso-button .sso-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .sso-divider {
            position: relative;
            text-align: center;
            margin: 1.5rem 0;
        }

        .sso-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--border-light);
        }

        .sso-divider span {
            background: var(--bg-primary);
            color: var(--text-secondary);
            padding: 0 1rem;
            font-size: 0.875rem;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            padding: 2rem;
            width: 90%;
            max-width: 400px;
            box-shadow: var(--shadow-2xl);
            border: 1px solid var(--border-light);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h2 {
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.25rem;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.875rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: border-color 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }

        .form-actions button {
            flex: 1;
        }

        .error-message {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            text-align: center;
        }

        .success-message {
            color: #059669;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            text-align: center;
        }

        /* GDPR Cookie Consent */
        .cookie-consent {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-primary);
            border-top: 1px solid var(--border-light);
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);
            z-index: 1500;
            padding: 1rem;
        }

        .cookie-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .cookie-text h4 {
            margin: 0 0 0.5rem 0;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .cookie-text p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.4;
        }

        .cookie-actions {
            display: flex;
            gap: 0.5rem;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .cookie-content {
                flex-direction: column;
                align-items: stretch;
                text-align: center;
            }
            
            .cookie-actions {
                justify-content: center;
            }
        }

        .admin-nav-tabs {
            border-bottom: 2px solid var(--border-light);
            margin-bottom: 2rem;
        }

        .admin-nav-tab {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border: none;
            padding: 0.75rem 1rem;
            margin-right: 0.25rem;
            border-radius: var(--radius-md) var(--radius-md) 0 0;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .admin-nav-tab:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .admin-nav-tab.active {
            background: var(--primary-color);
            color: white;
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 3rem 0 2rem;
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
            letter-spacing: -0.025em;
        }

        .header .subtitle {
            font-size: 1.125rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-weight: 500;
        }

        .network-tabs {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .tab-button {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-light);
            color: var(--text-secondary);
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tab-button:hover {
            background: var(--bg-primary);
            border-color: var(--border-medium);
            color: var(--text-primary);
        }

        .tab-button.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: var(--shadow-sm);
        }

        .commands-container {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            border: 1px solid var(--border-light);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .network-header {
            background: var(--accent-blue);
            border-bottom: 1px solid var(--border-light);
            padding: 2rem;
            text-align: center;
        }

        .network-header h2 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: 600;
        }

        .network-header .network-description {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .commands-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1px;
            background: var(--border-light);
        }

        .command-category {
            background: var(--bg-primary);
        }

        .category-header {
            background: var(--bg-tertiary);
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-light);
            font-weight: 600;
            font-size: 1rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .category-header i {
            color: var(--primary-color);
            font-size: 1.125rem;
        }

        .command-list {
            padding: 0;
        }

        .command-item {
            border-bottom: 1px solid var(--border-light);
            transition: all 0.2s ease;
        }

        .command-item:last-child {
            border-bottom: none;
        }

        .command-item:hover {
            background: var(--bg-secondary);
        }

        .command-header {
            padding: 1rem 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .command-name {
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--primary-color);
            background: var(--accent-blue);
            padding: 0.375rem 0.75rem;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-light);
            white-space: nowrap;
            position: relative;
            transition: all 0.2s ease;
        }

        .command-name:hover {
            background: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }

        .command-name::after {
            content: '📋';
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            opacity: 0;
            transform: scale(0);
            transition: all 0.2s ease;
        }

        .command-name:hover::after {
            opacity: 1;
            transform: scale(1);
        }

        .command-description {
            color: var(--text-secondary);
            font-size: 0.875rem;
            flex: 1;
            font-weight: 500;
        }

        .command-toggle {
            color: var(--text-muted);
            font-size: 0.75rem;
            transition: transform 0.2s ease;
        }

        .command-details {
            display: none;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-light);
        }

        .command-details.active {
            display: block;
        }

        .command-item.expanded .command-toggle {
            transform: rotate(180deg);
        }

        .detail-row {
            display: flex;
            margin-bottom: 0.75rem;
            gap: 1rem;
        }

        .detail-row:last-child {
            margin-bottom: 0;
        }

        .detail-label {
            font-weight: 600;
            color: var(--text-primary);
            min-width: 4rem;
            font-size: 0.875rem;
        }

        .detail-value {
            color: var(--text-secondary);
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 0.875rem;
            flex: 1;
        }

        .stats-bar {
            background: var(--bg-tertiary);
            padding: 1.5rem;
            border-top: 1px solid var(--border-light);
            display: flex;
            justify-content: center;
            gap: 3rem;
            flex-wrap: wrap;
        }

        .stats-item {
            text-align: center;
        }

        .stats-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.25rem;
        }

        .stats-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .footer {
            text-align: center;
            margin-top: 3rem;
            padding: 2rem;
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
        }

        .footer p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }

        .footer a {
            color: var(--primary-color);
            text-decoration: none;
            margin: 0 1rem;
            font-size: 1.125rem;
            transition: color 0.2s ease;
        }

        .footer a:hover {
            color: var(--primary-dark);
        }

        /* Copy notification */
        .copy-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .copy-notification.show {
            transform: translate(-50%, -50%) scale(1);
        }

        /* Leaderboard Styles */
        .leaderboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
        }

        .stat-box {
            text-align: center;
            background: var(--bg-primary);
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
        }

        .stat-number {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .leaderboard-table {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
        }

        .sortable-header {
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .sortable-header:hover {
            background: var(--accent-blue);
            color: var(--primary-color);
            font-weight: 700;
        }

        .sort-indicator {
            color: var(--primary-color);
            font-weight: 700;
            font-size: 0.75rem;
        }

        .network-selector {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .network-btn {
            padding: 0.75rem 1.5rem;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .network-btn.active {
            background: var(--primary-color) !important;
            color: white !important;
            border-color: var(--primary-color) !important;
        }

        /* Game Styles */
        .game-container {
            background: var(--bg-primary);
            padding: 2rem;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
        }

        .ui {
            color: var(--text-primary);
        }

        #gameCanvas {
            border: 2px solid var(--border-medium);
            border-radius: var(--radius-lg);
        }

        button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        button:hover:not(:disabled) {
            background: var(--primary-dark);
        }

        button:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header {
                padding: 2rem 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .commands-grid {
                grid-template-columns: 1fr;
                gap: 1px;
            }

            .network-tabs {
                gap: 0.25rem;
            }

            .tab-button {
                padding: 0.625rem 1rem;
                font-size: 0.8125rem;
            }

            .stats-bar {
                gap: 1.5rem;
            }

            .command-header {
                padding: 0.875rem 1rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .command-name {
                align-self: flex-start;
            }

            .command-toggle {
                align-self: flex-end;
                margin-top: -1.5rem;
            }

            .theme-toggle {
                top: 0.75rem;
                right: 0.75rem;
                padding: 0.625rem;
                font-size: 0.8125rem;
            }

            .theme-toggle-icon {
                font-size: 0.875rem;
            }
        }

        /* User management action buttons */
        .user-action-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-sm);
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .user-action-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-1px);
        }

        .user-action-btn.admin {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .user-action-btn.admin:hover {
            background: #1d4ed8;
            border-color: #1d4ed8;
        }

        .user-action-btn.inactive {
            background: #f59e0b;
            color: white;
            border-color: #f59e0b;
        }

        .user-action-btn.inactive:hover {
            background: #d97706;
            border-color: #d97706;
        }

        .user-action-btn.delete-user:hover {
            background: #991b1b !important;
            border-color: #991b1b !important;
        }

        /* Pigs Game Rules Styling */
        .rules-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .rule-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            border-left: 3px solid var(--accent-color);
        }

        .rule-item i {
            font-size: 1rem;
            color: var(--accent-color);
            width: 16px;
            text-align: center;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .rules-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Comprehensive Mobile Responsive Styles */
        @media (max-width: 768px) {
            /* Base adjustments */
            body {
                font-size: 14px;
                overflow-x: hidden;
            }

            /* Container and layout */
            .container {
                max-width: 100%;
                padding: 0.5rem;
                margin: 0;
            }

            /* Header section */
            .header {
                padding: 1.5rem 1rem;
                text-align: center;
            }

            .header h1 {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }

            .header .subtitle {
                font-size: 0.875rem;
            }

            /* Theme toggle */
            .theme-toggle {
                position: fixed;
                top: 0.5rem;
                right: 0.5rem;
                padding: 0.5rem;
                font-size: 0.75rem;
                z-index: 1001;
            }

            /* Auth buttons */
            .auth-buttons {
                position: relative;
                top: auto;
                left: auto;
                transform: none;
                margin: 1rem auto;
                text-align: center;
                display: flex;
                gap: 0.5rem;
                justify-content: center;
                flex-wrap: wrap;
            }

            .auth-buttons button,
            .auth-buttons .user-info {
                font-size: 0.75rem;
                padding: 0.5rem 0.75rem;
            }

            /* Navigation tabs */
            .network-tabs {
                display: flex;
                flex-wrap: wrap;
                gap: 0.25rem;
                justify-content: center;
                padding: 0 0.5rem;
            }

            .tab-button {
                padding: 0.5rem 0.75rem;
                font-size: 0.75rem;
                flex: 1;
                min-width: auto;
                white-space: nowrap;
            }

            /* Tab content */
            .tab-content {
                padding: 1rem 0.5rem;
            }

            /* Commands section */
            .commands-section h2 {
                font-size: 1.25rem;
                margin-bottom: 1rem;
            }

            .commands-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .command-card {
                padding: 0.75rem;
            }

            .command-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .command-name {
                font-size: 0.875rem;
            }

            .copy-button {
                font-size: 0.75rem;
                padding: 0.25rem 0.5rem;
            }

            /* Tables */
            table {
                font-size: 0.75rem;
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }

            th, td {
                padding: 0.5rem;
                font-size: 0.75rem;
            }

            /* Game canvas and containers */
            #gameCanvas,
            canvas {
                max-width: 100%;
                height: auto !important;
                width: 100% !important;
                touch-action: none;
            }

            /* UNO and Pigs game specific */
            .leaderboard-table {
                font-size: 0.75rem;
                overflow-x: auto;
            }

            /* Breakout game container */
            .game-container {
                padding: 0.5rem;
                max-width: 100%;
            }

            /* Admin panel */
            #admin-panel-content {
                padding: 1rem 0.5rem;
            }

            .admin-section {
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .admin-section h3 {
                font-size: 1.1rem;
            }

            .admin-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .admin-actions {
                flex-direction: column;
                gap: 0.5rem;
            }

            .admin-actions button {
                width: 100%;
                font-size: 0.75rem;
                padding: 0.5rem;
            }

            /* Log viewer */
            .log-viewer {
                max-width: 100%;
                overflow-x: auto;
            }

            .log-viewer pre {
                font-size: 0.7rem;
                white-space: pre-wrap;
                word-wrap: break-word;
            }

            .log-controls {
                flex-direction: column;
                gap: 0.5rem;
            }

            .log-controls button,
            .log-controls select {
                width: 100%;
                font-size: 0.75rem;
                padding: 0.5rem;
            }

            /* Analytics */
            .analytics-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .analytics-card {
                padding: 1rem;
            }

            .analytics-value {
                font-size: 1.5rem;
            }

            /* Forms and inputs */
            input[type="text"],
            input[type="email"],
            input[type="password"],
            input[type="number"],
            select,
            textarea {
                width: 100%;
                font-size: 0.875rem;
                padding: 0.5rem;
            }

            /* Buttons */
            button {
                font-size: 0.875rem;
                padding: 0.75rem 1rem;
                touch-action: manipulation;
            }

            /* Modals */
            .modal-content {
                width: 95%;
                max-width: 400px;
                margin: 10% auto;
                padding: 1.5rem;
            }

            .modal h2 {
                font-size: 1.25rem;
            }

            /* Code blocks */
            pre, code {
                font-size: 0.75rem;
                overflow-x: auto;
            }

            /* Scrollable sections */
            .scrollable-content {
                max-height: 400px;
                overflow-y: auto;
            }

            /* Hide non-essential elements on mobile */
            .desktop-only {
                display: none;
            }

            /* Touch-friendly spacing */
            .clickable,
            a,
            button {
                min-height: 44px;
                min-width: 44px;
                display: inline-flex;
                align-items: center;
                justify-content: center;
            }
        }

        /* Extra small devices (phones in portrait) */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.25rem;
            }

            .tab-button {
                font-size: 0.7rem;
                padding: 0.4rem 0.5rem;
            }

            .network-tabs {
                gap: 0.1rem;
            }

            /* Stack auth buttons vertically */
            .auth-buttons {
                flex-direction: column;
                width: 100%;
                padding: 0 1rem;
            }

            .auth-buttons button,
            .auth-buttons .user-info {
                width: 100%;
            }

            /* Game adjustments */
            #gameCanvas {
                min-height: 300px;
                max-height: 500px;
            }
        }

        /* Landscape orientation adjustments */
        @media (max-width: 768px) and (orientation: landscape) {
            .header {
                padding: 1rem;
            }

            .header h1 {
                font-size: 1.25rem;
            }

            #gameCanvas {
                max-height: 80vh;
            }
        }

        /* Touch device adjustments */
        @media (hover: none) and (pointer: coarse) {
            /* Increase tap targets */
            button, a, .clickable {
                min-height: 48px;
                min-width: 48px;
            }

            /* Remove hover effects */
            button:hover,
            a:hover,
            .tab-button:hover {
                transform: none;
                box-shadow: none;
            }

            /* Add active states */
            button:active,
            a:active,
            .tab-button:active {
                opacity: 0.8;
                transform: scale(0.98);
            }
        }
    </style>
</head>
<body>
    <!-- User Authentication -->
    <div class="auth-container">
        <div id="auth-logged-out" style="display: flex;">
            <button class="auth-button" onclick="showLoginModal()">Login</button>
            <button class="auth-button secondary" onclick="showRegisterModal()">Register</button>
        </div>
        <div id="auth-logged-in" style="display: none;">
            <div class="user-info">
                <span id="user-greeting">
                    <img id="profile-picture" class="profile-picture" src="" alt="" style="display: none;">
                    <span class="fallback-emoji">👋</span>
                    <span id="username-display" class="username-clickable" onclick="toggleColorPicker()"></span>
                </span>
                <button class="auth-button secondary" onclick="logout()" style="margin-left: 0.5rem;">Logout</button>
                
                <!-- Color Picker Dropdown -->
                <div id="color-picker-dropdown" class="color-picker-dropdown">
                    <div class="color-picker-title">Choose your Hall of Fame color</div>
                    
                    <div class="color-wheel-container">
                        <canvas id="color-wheel" class="color-wheel" width="200" height="200"></canvas>
                        <div id="color-wheel-pointer" class="color-wheel-pointer"></div>
                    </div>
                    
                    <div class="hue-slider-container">
                        <div id="hue-slider" class="hue-slider">
                            <div id="hue-slider-thumb" class="hue-slider-thumb"></div>
                        </div>
                    </div>
                    
                    <div class="color-preview-section">
                        <div id="color-preview" class="color-preview"></div>
                        <div class="color-info">
                            <div id="color-hex">#6C5CE7</div>
                            <div style="font-size: 0.7rem; margin-top: 0.25rem;">This color will appear in Hall of Fame entries</div>
                        </div>
                    </div>
                    
                    <div class="color-picker-actions">
                        <button class="color-picker-btn secondary" onclick="closeColorPicker()">Cancel</button>
                        <button class="color-picker-btn primary" onclick="saveColor()">Save Color</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Theme Toggles -->
    <div class="theme-toggles-container" style="position: fixed; top: 20px; right: 20px; z-index: 1000; display: flex; flex-direction: column; gap: 5px;">
        <button class="theme-toggle theme-toggle-stacked" onclick="toggleTheme()" aria-label="Toggle dark mode">
            <i class="theme-toggle-icon fas fa-sun" id="theme-icon"></i>
            <span id="theme-text">Light</span>
        </button>
        <button class="theme-toggle theme-toggle-stacked terminal-toggle" onclick="toggleTerminalTheme()" aria-label="Toggle terminal mode">
            <i class="theme-toggle-icon fas fa-terminal"></i>
            <span id="terminal-text">Terminal</span>
        </button>
    </div>
    
    <style>
        .theme-toggle-stacked {
            position: relative !important;
            top: auto !important;
            right: auto !important;
            margin: 0 !important;
        }
        
        /* AGGRESSIVE TERMINAL THEME - INLINE */
        body.terminal-theme {
            background: #000000 !important;
            color: #00ff00 !important;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace !important;
            filter: brightness(0.9) contrast(1.2) saturate(1.3) !important;
            /* Removed debug border that was affecting layout */
            cursor: crosshair !important;
            text-shadow: 0 0 3px #00ff00, 0 0 6px #00ff00 !important;
        }
        
        /* Very selective text styling - avoid layout containers */
        body.terminal-theme p:not(.command-description),
        body.terminal-theme span:not(.command-prefix):not(.command-description):not([class*="col"]):not([class*="grid"]),
        body.terminal-theme li:not([class*="grid"]):not([class*="col"]) {
            color: #00ff00 !important;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace !important;
        }
        
        /* Only style text content, not structural elements */
        body.terminal-theme .text-content,
        body.terminal-theme .description:not([class*="grid"]),
        body.terminal-theme .content:not([class*="container"]):not([class*="grid"]) {
            color: #00ff00 !important;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace !important;
        }
        
        /* Ensure NO layout properties are overridden */
        body.terminal-theme * {
            /* Don't touch any width, height, display, flex, grid properties */
            box-sizing: inherit !important;
        }
        
        body.terminal-theme h1,
        body.terminal-theme h2,
        body.terminal-theme h3,
        body.terminal-theme h4,
        body.terminal-theme h5,
        body.terminal-theme h6 {
            color: #33ff33 !important;
            text-transform: uppercase !important;
            letter-spacing: 2px !important;
            border-left: 3px solid #00ff00 !important;
            padding-left: 12px !important;
            text-shadow: 0 0 8px #00ff00 !important;
        }
        
        body.terminal-theme button,
        body.terminal-theme input[type="submit"],
        body.terminal-theme input[type="button"],
        body.terminal-theme .btn {
            background: #050505 !important;
            border: 1px solid #006600 !important;
            color: #00ff00 !important;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace !important;
            text-transform: uppercase !important;
            letter-spacing: 1px !important;
            padding: 8px 16px !important;
            border-radius: 2px !important;
        }
        
        body.terminal-theme button:hover,
        body.terminal-theme input[type="submit"]:hover,
        body.terminal-theme input[type="button"]:hover,
        body.terminal-theme .btn:hover {
            background: #0a0a0a !important;
            border-color: #00ff00 !important;
            color: #33ff33 !important;
            box-shadow: 0 0 8px rgba(0, 255, 0, 0.4) !important;
            text-shadow: 0 0 3px #00ff00 !important;
        }
        
        body.terminal-theme a {
            color: #00ffff !important;
            text-decoration: none !important;
            border-bottom: 1px solid #00ffff !important;
        }
        
        body.terminal-theme a:hover {
            color: #33ff33 !important;
            border-bottom-color: #33ff33 !important;
            text-shadow: 0 0 8px #00ff00 !important;
        }
        
        body.terminal-theme input,
        body.terminal-theme textarea,
        body.terminal-theme select {
            background: #050505 !important;
            border: 1px solid #006600 !important;
            color: #00ff00 !important;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace !important;
            padding: 8px 12px !important;
            border-radius: 2px !important;
        }
        
        body.terminal-theme input:focus,
        body.terminal-theme textarea:focus,
        body.terminal-theme select:focus {
            border-color: #00ff00 !important;
            box-shadow: 0 0 8px rgba(0, 255, 0, 0.4) !important;
            outline: none !important;
        }
        
        /* Restore container styling with terminal theme - PRESERVE WIDTH CONSTRAINTS */
        body.terminal-theme .container,
        body.terminal-theme .card,
        body.terminal-theme .section {
            background: rgba(0, 0, 0, 0.8) !important;
            border: 1px solid #006600 !important;
            border-radius: 4px !important;
            /* CRITICAL: Don't override width constraints - keep original max-width, width, margins */
            max-width: inherit !important;
            width: inherit !important;
            margin: inherit !important;
            padding: inherit !important;
        }
        
        /* Style layout elements with terminal theme but preserve layout */
        body.terminal-theme .row,
        body.terminal-theme .col,
        body.terminal-theme [class*="col-"],
        body.terminal-theme .grid,
        body.terminal-theme .flex {
            background: rgba(0, 0, 0, 0.6) !important;
            border: 1px solid rgba(0, 102, 0, 0.3) !important;
            border-radius: 2px !important;
            /* PRESERVE ALL ORIGINAL SIZING AND FORCE VERTICAL STACKING */
            max-width: inherit !important;
            width: inherit !important;
            flex: inherit !important;
            display: block !important;  /* Force block display for vertical stacking */
            flex-direction: column !important;  /* If flex is used, stack vertically */
        }
        
        /* Style layout sections with terminal theme */
        body.terminal-theme .hero-section,
        body.terminal-theme .features-grid,
        body.terminal-theme .command-grid,
        body.terminal-theme .stats-grid {
            background: rgba(0, 0, 0, 0.7) !important;
            border: 1px solid rgba(0, 102, 0, 0.4) !important;
            border-radius: 4px !important;
            /* FORCE VERTICAL STACKING */
            max-width: inherit !important;
            width: inherit !important;
            display: block !important;  /* Override any grid/flex to force stacking */
            grid-template-columns: none !important;  /* Disable grid columns */
            flex-direction: column !important;
        }
        
        /* Style content elements */
        body.terminal-theme .command-example,
        body.terminal-theme .command-item {
            background: rgba(0, 0, 0, 0.5) !important;
            border: 1px solid rgba(0, 102, 0, 0.4) !important;
            border-radius: 2px !important;
            display: block !important;  /* Stack command items vertically */
            width: 100% !important;  /* Take full width of container */
            margin-bottom: 10px !important;  /* Add spacing between stacked items */
        }
        
        /* Remove any blue colors completely */
        body.terminal-theme .primary-color,
        body.terminal-theme [style*="blue"],
        body.terminal-theme [class*="blue"] {
            color: #00ff00 !important;
            background: #050505 !important;
            border-color: #006600 !important;
        }
    </style>
    
    <!-- Copy Notification -->
    <div id="copy-notification" class="copy-notification">
        <i class="fas fa-check"></i>
        <span>Command copied to clipboard!</span>
    </div>
    
    <div class="container">
        <div class="header">
            <h1><span class="bot-emoji">🤖</span> PyBorg</h1>
            <p class="subtitle">IRC Bot Command Documentation</p>
            <div class="network-tabs">
                <button class="tab-button active" onclick="showTab('rizon')">
                    🌐 Rizon Network
                </button>
                <button class="tab-button" onclick="showTab('libera')">
                    🌍 Libera Network
                </button>
                <button class="tab-button" onclick="showTab('leaderboard')">
                    🏆 UNO Leaderboard
                </button>
                <button class="tab-button" onclick="showTab('pigs-leaderboard')">
                    🐷 Pigs Leaderboard
                </button>
                <button class="tab-button" onclick="showTab('breakout')">
                    🎮 Breakout Game
                </button>
                <button class="tab-button" onclick="showTab('analytics')">
                    📊 Bot Analytics
                </button>
                <button class="tab-button" onclick="showTab('tools')">
                    🔧 Useful Tools
                </button>
            </div>
        </div>

        <div class="commands-container">
            <!-- Rizon Tab -->
            <div id="rizon" class="tab-content active">
                <div class="network-header">
                    <h2>🌐 Rizon Network</h2>
                    <p class="network-description">Commands available on the Rizon IRC network (prefix: !)</p>
                </div>
                <div class="commands-grid">
                    <div class="command-category">
                        <div class="category-header">
                            <i class="fas fa-gamepad"></i>
                            Games & Gambling
                        </div>
                        <div class="command-list">
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!bet7', event)">!bet7</code>
                                    <span class="command-description">Dice betting game</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!bet7</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Join or start a dice betting game</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!bet7.top', event)">!bet7.top</code>
                                    <span class="command-description">Show betting leaderboard</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!bet7.top</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Display top betting scores</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!bet7.owned', event)">!bet7.owned</code>
                                    <span class="command-description">Show your betting score</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!bet7.owned</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Show your current betting balance</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!roll7', event)">!roll7</code>
                                    <span class="command-description">Roll 7 dice</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!roll7</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Roll 7 dice and show total</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="command-category">
                        <div class="category-header">
                            <i class="fas fa-cards-blank"></i>
                            UNO Game
                        </div>
                        <div class="command-list">
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!uno', event)">!uno</code>
                                    <span class="command-description">Start UNO game</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!uno</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Start a new UNO game (auto-cancels in 30s if no one joins)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!join', event)">!join</code>
                                    <span class="command-description">Join UNO game</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!join</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Join a waiting UNO game</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!start', event)">!start</code>
                                    <span class="command-description">Start UNO round</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!start</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Begin the UNO game (starter only)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!play R5', event)">!play</code>
                                    <span class="command-description">Play UNO card</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!play R5, !play WD4 red, !play BS</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Play a card in UNO (R=Red, B=Blue, G=Green, Y=Yellow)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!draw', event)">!draw</code>
                                    <span class="command-description">Draw UNO card</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!draw</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Draw a card from the deck</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!cards', event)">!cards</code>
                                    <span class="command-description">View your cards</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!cards</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">See your cards (sent via private notice)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!status', event)">!status</code>
                                    <span class="command-description">Game status</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!status</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Show current game status and turn</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!quit', event)">!quit</code>
                                    <span class="command-description">Quit UNO game</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!quit</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Leave the current UNO game</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!unohelp', event)">!unohelp</code>
                                    <span class="command-description">UNO help</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!unohelp</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Show UNO game help and rules</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!unoleaderboard', event)">!unoleaderboard</code>
                                    <span class="command-description">UNO leaderboard</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!unoleaderboard</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Show UNO game leaderboard</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="command-category">
                        <div class="category-header">
                            <i class="fas fa-clock"></i>
                            Reminders & Utilities
                        </div>
                        <div class="command-list">
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!remind(5 minutes) check pizza', event)">!remind</code>
                                    <span class="command-description">Set reminder</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!remind(5 minutes) check pizza</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Examples:</span>
                                        <span class="detail-value">!remind(1h30m) meeting, !remind(tomorrow at 2pm) call dentist</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Set a reminder with flexible time format</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!reminders', event)">!reminders</code>
                                    <span class="command-description">List reminders</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!reminders</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">List your active reminders</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!cancelreminder 1', event)">!cancelreminder</code>
                                    <span class="command-description">Cancel reminder</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!cancelreminder 1</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Cancel a reminder by number</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="command-category">
                        <div class="category-header">
                            <i class="fas fa-info-circle"></i>
                            Information & Fun
                        </div>
                        <div class="command-list">
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!piss', event)">!piss</code>
                                    <span class="command-description">ISS urine tank level</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!piss</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Show ISS urine tank level</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!weather', event)">!weather</code>
                                    <span class="command-description">Weather information</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!weather</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Get random weather description</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!lenny', event)">!lenny</code>
                                    <span class="command-description">Lenny face</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!lenny</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Show Lenny face ( ͡° ͜ʖ ͡°)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!random red blue green', event)">!random</code>
                                    <span class="command-description">Random choice</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!random red blue green</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Choose randomly from options</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="command-category">
                        <div class="category-header">
                            <i class="fas fa-pig"></i>
                            Pass the Pigs Game
                        </div>
                        <div class="command-list">
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!pigs', event)">!pigs</code>
                                    <span class="command-description">Start/join/play Pass the Pigs</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!pigs</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Start a new game, join existing game, or roll the pigs</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Game Flow:</span>
                                        <span class="detail-value">30-second join timer → Roll pigs for points → Bank points or risk Pig Outs</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Win Condition:</span>
                                        <span class="detail-value">First player to bank 100+ points wins immediately</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!pigsquit', event)">!pigsquit</code>
                                    <span class="command-description">Quit Pass the Pigs game</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!pigsquit</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">End the current Pass the Pigs game (current player or admin only)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!pigshelp', event)">!pigshelp</code>
                                    <span class="command-description">Pass the Pigs help</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!pigshelp</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Show Pass the Pigs game rules and scoring information</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!pigstats', event)">!pigstats</code>
                                    <span class="command-description">View player statistics</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!pigstats or !pigstats username</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">View Pass the Pigs statistics for yourself or another player</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!bank', event)">!bank</code>
                                    <span class="command-description">View your point balance</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!bank</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Show your current point balance and recent transactions</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="command-category">
                        <div class="category-header">
                            <i class="fas fa-calculator"></i>
                            Tools & Calculators
                        </div>
                        <div class="command-list">
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!calc 2 + 2', event)">!calc</code>
                                    <span class="command-description">Calculator</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!calc 2 + 2</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Perform basic calculations</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!time', event)">!time</code>
                                    <span class="command-description">Current time</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!time</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Show current time</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!date 30', event)">!date</code>
                                    <span class="command-description">Date calculator</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!date 30</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Calculate date N days from now</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('!temp', event)">!temp</code>
                                    <span class="command-description">Temperature sensor</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">!temp</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Show sensor temperatures</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="stats-bar">
                    <div class="stats-item">
                        <div class="stats-number">50+</div>
                        <div class="stats-label">Commands</div>
                    </div>
                    <div class="stats-item">
                        <div class="stats-number">3</div>
                        <div class="stats-label">Channels</div>
                    </div>
                    <div class="stats-item">
                        <div class="stats-number">24/7</div>
                        <div class="stats-label">Online</div>
                    </div>
                </div>
            </div>

            <!-- Libera Tab -->
            <div id="libera" class="tab-content">
                <div class="network-header">
                    <h2>🌍 Libera Network</h2>
                    <p class="network-description">Commands available on the Libera IRC network (prefix: ~)</p>
                </div>
                <div class="commands-grid">
                    <div class="command-category">
                        <div class="category-header">
                            <i class="fas fa-robot"></i>
                            AI & Chat
                        </div>
                        <div class="command-list">
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~speak hello world', event)">~speak</code>
                                    <span class="command-description">Chat with AI</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~speak hello world</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Context:</span>
                                        <span class="detail-value">~speak (responds to recent chat)</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Chat with Gemini AI bot</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~speakclear', event)">~speakclear</code>
                                    <span class="command-description">Clear chat history</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~speakclear</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Clear your AI conversation history</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="command-category">
                        <div class="category-header">
                            <i class="fas fa-cards-blank"></i>
                            UNO Game
                        </div>
                        <div class="command-list">
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~uno', event)">~uno</code>
                                    <span class="command-description">Start UNO game</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~uno</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Start a new UNO game (auto-cancels in 30s if no one joins)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~join', event)">~join</code>
                                    <span class="command-description">Join UNO game</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~join</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Join a waiting UNO game</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~start', event)">~start</code>
                                    <span class="command-description">Start UNO round</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~start</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Begin the UNO game (starter only)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~play R5', event)">~play</code>
                                    <span class="command-description">Play UNO card</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~play R5, ~play WD4 red, ~play BS</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Play a card in UNO (R=Red, B=Blue, G=Green, Y=Yellow)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~draw', event)">~draw</code>
                                    <span class="command-description">Draw UNO card</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~draw</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Draw a card from the deck</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~pass', event)">~pass</code>
                                    <span class="command-description">Pass turn</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~pass</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Pass your turn (after drawing)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~cards', event)">~cards</code>
                                    <span class="command-description">View your cards</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~cards</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">See your cards (sent via private notice)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~status', event)">~status</code>
                                    <span class="command-description">Game status</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~status</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Show current game status and turn</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~quit', event)">~quit</code>
                                    <span class="command-description">Quit UNO game</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~quit</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Leave the current UNO game</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~unohelp', event)">~unohelp</code>
                                    <span class="command-description">UNO help</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~unohelp</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Show UNO game help and rules</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~unoleaderboard', event)">~unoleaderboard</code>
                                    <span class="command-description">UNO leaderboard</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~unoleaderboard</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Show UNO game leaderboard</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="command-category">
                        <div class="category-header">
                            <i class="fas fa-piggy-bank"></i>
                            Pass the Pigs
                        </div>
                        <div class="command-list">
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~pigs', event)">~pigs</code>
                                    <span class="command-description">Start/join/play Pass the Pigs</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~pigs</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Start a new game, join existing game, or roll the pigs</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Game Flow:</span>
                                        <span class="detail-value">30-second join timer → Roll pigs for points → Bank points or risk Pig Outs</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Win Condition:</span>
                                        <span class="detail-value">First player to bank 100+ points wins immediately</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~pigsquit', event)">~pigsquit</code>
                                    <span class="command-description">Quit Pass the Pigs game</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~pigsquit</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">End the current Pass the Pigs game (current player or admin only)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~pigshelp', event)">~pigshelp</code>
                                    <span class="command-description">Pass the Pigs help</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~pigshelp</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Show Pass the Pigs game rules and scoring information</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~pigstats', event)">~pigstats</code>
                                    <span class="command-description">View player statistics</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~pigstats or ~pigstats username</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">View Pass the Pigs statistics for yourself or another player</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~bank', event)">~bank</code>
                                    <span class="command-description">View your point balance</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~bank</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Show your current point balance and recent transactions</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="command-category">
                        <div class="category-header">
                            <i class="fas fa-clock"></i>
                            Reminders & Utilities
                        </div>
                        <div class="command-list">
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~remind(5 minutes) check pizza', event)">~remind</code>
                                    <span class="command-description">Set reminder</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~remind(5 minutes) check pizza</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Examples:</span>
                                        <span class="detail-value">~remind(1h30m) meeting, ~remind(tomorrow at 2pm) call dentist</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Set a reminder with flexible time format</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~reminders', event)">~reminders</code>
                                    <span class="command-description">List reminders</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~reminders</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">List your active reminders</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~cancelreminder 1', event)">~cancelreminder</code>
                                    <span class="command-description">Cancel reminder</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~cancelreminder 1</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Cancel a reminder by number</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="command-category">
                        <div class="category-header">
                            <i class="fas fa-info-circle"></i>
                            Information & Fun
                        </div>
                        <div class="command-list">
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~piss', event)">~piss</code>
                                    <span class="command-description">ISS urine tank level</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~piss</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Show ISS urine tank level</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~hats username', event)">~hats</code>
                                    <span class="command-description">Twitch stream status</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~hats username</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Check if Twitch user is streaming</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~dog', event)">~dog</code>
                                    <span class="command-description">Random dog image</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~dog</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Get a random dog image</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~cat', event)">~cat</code>
                                    <span class="command-description">Random cat image</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~cat</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Get a random cat image</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~lenny', event)">~lenny</code>
                                    <span class="command-description">Lenny face</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~lenny</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Show Lenny face ( ͡° ͜ʖ ͡°)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="command-category">
                        <div class="category-header">
                            <i class="fas fa-calculator"></i>
                            Tools & Calculators
                        </div>
                        <div class="command-list">
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~calc 2 + 2', event)">~calc</code>
                                    <span class="command-description">Calculator</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~calc 2 + 2</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Perform basic calculations</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~time', event)">~time</code>
                                    <span class="command-description">Current time</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~time</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Show current time</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="toggleCommand(this)">
                                <div class="command-header">
                                    <code class="command-name" onclick="copyCommand('~date 30', event)">~date</code>
                                    <span class="command-description">Date calculator</span>
                                    <i class="fas fa-chevron-down command-toggle"></i>
                                </div>
                                <div class="command-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Usage:</span>
                                        <span class="detail-value">~date 30</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Description:</span>
                                        <span class="detail-value">Calculate date N days from now</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="stats-bar">
                    <div class="stats-item">
                        <div class="stats-number">45+</div>
                        <div class="stats-label">Commands</div>
                    </div>
                    <div class="stats-item">
                        <div class="stats-number">24/7</div>
                        <div class="stats-label">Online</div>
                    </div>
                    <div class="stats-item">
                        <div class="stats-number">2</div>
                        <div class="stats-label">Channels</div>
                    </div>
                </div>
            </div>

            <!-- UNO Leaderboard Tab -->
            <div id="leaderboard" class="tab-content">
                <div class="network-header">
                    <h2><i class="fas fa-trophy"></i> UNO Leaderboard</h2>
                    <p class="network-description">Track your UNO game performance across networks</p>
                </div>
                <div style="padding: 1.5rem;">
                    <!-- Network Selector -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <div class="network-selector">
                            <button id="rizon-leaderboard-btn" class="network-btn active" onclick="showNetworkLeaderboard('Rizon')">
                                <i class="fas fa-server"></i> Rizon
                            </button>
                            <button id="libera-leaderboard-btn" class="network-btn" onclick="showNetworkLeaderboard('Libera')" style="background: var(--bg-tertiary); color: var(--text-secondary);">
                                <i class="fas fa-server"></i> Libera
                            </button>
                        </div>
                        <button onclick="refreshUnoLeaderboard()" style="background: var(--primary-color); color: white; border: none; padding: 0.5rem 1rem; border-radius: var(--radius-md); cursor: pointer; display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem;">
                            <i class="fas fa-sync-alt"></i> Refresh Data
                        </button>
                    </div>
                    
                    <div class="leaderboard-stats">
                        <div class="stat-box">
                            <div class="stat-number" id="total-players">0</div>
                            <div class="stat-label">Total Players</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="total-games">0</div>
                            <div class="stat-label">Games Played</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="top-player">-</div>
                            <div class="stat-label">Top Player</div>
                        </div>
                    </div>
                    
                    <div class="leaderboard-table">
                        <div style="background: var(--bg-tertiary); padding: 1rem 1.5rem; border-bottom: 1px solid var(--border-light); font-weight: 600; display: grid; grid-template-columns: 50px 1fr 80px 80px 80px 100px 100px 90px 60px; gap: 0.75rem; align-items: center; font-size: 0.875rem;">
                            <div>Rank</div>
                            <div>Player</div>
                            <div class="sortable-header" onclick="sortUnoLeaderboard('games_played')" style="cursor: pointer; user-select: none; display: flex; align-items: center; gap: 0.25rem;">
                                Games <span id="sort-games_played" class="sort-indicator"></span>
                            </div>
                            <div class="sortable-header" onclick="sortUnoLeaderboard('wins')" style="cursor: pointer; user-select: none; display: flex; align-items: center; gap: 0.25rem;">
                                Wins <span id="sort-wins" class="sort-indicator"></span>
                            </div>
                            <div class="sortable-header" onclick="sortUnoLeaderboard('win_rate')" style="cursor: pointer; user-select: none; display: flex; align-items: center; gap: 0.25rem;">
                                Win Rate <span id="sort-win_rate" class="sort-indicator">▼</span>
                            </div>
                            <div class="sortable-header" onclick="sortUnoLeaderboard('total_cards_played')" style="cursor: pointer; user-select: none; display: flex; align-items: center; gap: 0.25rem;">
                                Cards Played <span id="sort-total_cards_played" class="sort-indicator"></span>
                            </div>
                            <div class="sortable-header" onclick="sortUnoLeaderboard('current_win_streak')" style="cursor: pointer; user-select: none; display: flex; align-items: center; gap: 0.25rem;">
                                Streak <span id="sort-current_win_streak" class="sort-indicator"></span>
                            </div>
                            <div>Favorite Color</div>
                            <div>Details</div>
                        </div>
                        <div id="leaderboard-entries" style="min-height: 200px; display: flex; align-items: center; justify-content: center; color: var(--text-secondary); font-size: 1rem;">
                            Loading leaderboard...
                        </div>
                    </div>
                    
                    <div class="last-updated" style="text-align: center; color: var(--text-secondary); font-size: 0.875rem; margin-top: 1.5rem;" id="last-updated">
                        
                    </div>
                </div>
            </div>

            <!-- Pass the Pigs Leaderboard Tab -->
            <div id="pigs-leaderboard" class="tab-content">
                <div class="network-header">
                    <h2>🐷 Pass the Pigs Leaderboard</h2>
                    <p class="network-description">Roll the pigs and dominate the leaderboard!</p>
                </div>
                <div style="padding: 1.5rem;">
                    <!-- Network Selector -->
                    <div class="network-selector">
                        <button id="rizon-pigs-btn" class="network-btn active" onclick="showPigsNetworkLeaderboard('Rizon')">
                            <i class="fas fa-server"></i> Rizon
                        </button>
                        <button id="libera-pigs-btn" class="network-btn" onclick="showPigsNetworkLeaderboard('Libera')" style="background: var(--bg-tertiary); color: var(--text-secondary);">
                            <i class="fas fa-server"></i> Libera
                        </button>
                    </div>
                    
                    <div class="leaderboard-stats">
                        <div class="stat-box">
                            <div class="stat-number" id="pigs-total-players">0</div>
                            <div class="stat-label">Total Players</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="pigs-total-games">0</div>
                            <div class="stat-label">Games Played</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="pigs-highest-score">0</div>
                            <div class="stat-label">Highest Score</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="pigs-total-pig-outs">0</div>
                            <div class="stat-label">Total Pig Outs</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="pigs-total-oinkers">0</div>
                            <div class="stat-label">Total Oinkers</div>
                        </div>
                    </div>

                    <div class="leaderboard-container">
                        <div class="leaderboard-header">
                            <h3><i class="fas fa-crown"></i> Top Players</h3>
                            <div class="refresh-btn" onclick="refreshPigsLeaderboard()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </div>
                        </div>
                        
                        <div class="leaderboard-content">
                            <div class="loading-state" id="pigs-loading">
                                <div class="spinner"></div>
                                <span>Loading leaderboard...</span>
                            </div>
                            
                            <div class="error-state" id="pigs-error" style="display: none;">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>Failed to load leaderboard</span>
                                <button onclick="refreshPigsLeaderboard()">Try Again</button>
                            </div>
                            
                            <div class="leaderboard-table" id="pigs-leaderboard-table" style="display: none;">
                                <div style="background: var(--bg-tertiary); padding: 1rem 1.5rem; border-bottom: 1px solid var(--border-light); font-weight: 600; display: grid; grid-template-columns: 50px 1fr 60px 60px 60px 80px 70px 70px 80px 70px; gap: 0.5rem; align-items: center; font-size: 0.8rem;">
                                    <div>Rank</div>
                                    <div>Player</div>
                                    <div>Wins</div>
                                    <div>Games</div>
                                    <div>Rolls</div>
                                    <div>Best Score</div>
                                    <div>Win Streak</div>
                                    <div>Risk Score</div>
                                    <div>Avg Rolls</div>
                                    <div>Details</div>
                                </div>
                                <div id="pigs-leaderboard-data" style="min-height: 200px;">
                                    <!-- Leaderboard data will be inserted here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="game-info">
                            <h4><i class="fas fa-info-circle"></i> Game Rules</h4>
                            <div class="rules-grid">
                                <div class="rule-item">
                                    <i class="fas fa-dice"></i>
                                    <span><strong>Razorback/Trotter:</strong> 5 points each</span>
                                </div>
                                <div class="rule-item">
                                    <i class="fas fa-star"></i>
                                    <span><strong>Snouter:</strong> 10 points</span>
                                </div>
                                <div class="rule-item">
                                    <i class="fas fa-gem"></i>
                                    <span><strong>Leaning Jowler:</strong> 15 points</span>
                                </div>
                                <div class="rule-item">
                                    <i class="fas fa-fire"></i>
                                    <span><strong>Double Position:</strong> 4x points</span>
                                </div>
                                <div class="rule-item">
                                    <i class="fas fa-skull"></i>
                                    <span><strong>Pig Out:</strong> Lose turn score</span>
                                </div>
                                <div class="rule-item">
                                    <i class="fas fa-bomb"></i>
                                    <span><strong>Oinker:</strong> Lose ALL points</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="last-updated" style="text-align: center; color: var(--text-secondary); font-size: 0.875rem; margin-top: 1.5rem;" id="pigs-last-updated">
                            
                        </div>
                        
                    </div>
                </div>
            </div>

            <!-- Breakout Game Tab -->
            <div id="breakout" class="tab-content">
                <iframe id="breakout-iframe" data-src="breakout.html?v=2.8" width="100%" height="900" style="border: none; border-radius: var(--radius-lg);"></iframe>
            </div>


            <!-- Analytics Tab -->
            <div id="analytics" class="tab-content">
                <div class="network-header">
                    <h2>📊 Bot Analytics Dashboard</h2>
                    <p class="network-description">Comprehensive IRC bot usage statistics and performance metrics</p>
                </div>

                <!-- Network Selection for Analytics -->
                <div class="analytics-network-selector" style="padding: 1.5rem; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <button id="rizon-analytics-btn" class="network-btn active" onclick="loadAnalytics('rizon')" style="padding: 0.75rem 1.5rem; background: var(--primary-color); color: white; border: none; border-radius: var(--radius-md); cursor: pointer; font-weight: 600;">
                        📡 Rizon Network
                    </button>
                    <button id="libera-analytics-btn" class="network-btn" onclick="loadAnalytics('libera')" style="padding: 0.75rem 1.5rem; background: var(--bg-tertiary); color: var(--text-secondary); border: none; border-radius: var(--radius-md); cursor: pointer; font-weight: 600;">
                        🌍 Libera Network
                    </button>
                </div>

                <!-- Analytics Dashboard Content -->
                <div id="analytics-dashboard" style="padding: 0 1.5rem 1.5rem; position: relative;">
                    
                    <!-- Analytics Access Overlay (for non-registered users) -->
                    <div id="analytics-overlay" style="
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: rgba(255, 255, 255, 0.1);
                        backdrop-filter: blur(10px);
                        -webkit-backdrop-filter: blur(10px);
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        z-index: 1000;
                        border-radius: var(--radius-lg);
                        margin: 1.5rem;
                        padding: 2rem;
                        text-align: center;
                    ">
                        <div style="background: var(--bg-primary); padding: 2rem; border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); max-width: 500px;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">📊</div>
                            <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 1rem; font-size: 1.5rem;">Analytics Access Required</h3>
                            <p style="color: var(--text-secondary); margin-bottom: 2rem; line-height: 1.6;">
                                Bot analytics are available to registered users only. Please register or log in to view detailed bot usage statistics, user analytics, and performance metrics.
                            </p>
                            <button onclick="window.location.href='#'" style="
                                padding: 0.75rem 2rem;
                                background: var(--primary-color);
                                color: white;
                                border: none;
                                border-radius: var(--radius-md);
                                cursor: pointer;
                                font-weight: 600;
                                font-size: 1rem;
                                transition: all 0.2s;
                            " onmouseover="this.style.background='var(--primary-dark)'" onmouseout="this.style.background='var(--primary-color)'">
                                Register / Login
                            </button>
                        </div>
                    </div>
                    
                    <!-- Summary Cards -->
                    <div class="analytics-summary" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                        <div class="analytics-card" style="background: var(--bg-primary); border: 1px solid var(--border-light); border-radius: var(--radius-lg); padding: 1.5rem; box-shadow: var(--shadow-sm);">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="background: var(--accent-blue); padding: 0.75rem; border-radius: var(--radius-md); font-size: 1.25rem;">📝</div>
                                <div>
                                    <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.25rem;">Total Commands</h3>
                                    <p id="total-commands" style="font-size: 1.5rem; font-weight: 700; color: var(--primary-color);">Loading...</p>
                                </div>
                            </div>
                            <p style="color: var(--text-secondary); font-size: 0.875rem;">
                                <span id="commands-24h" style="color: var(--primary-color); font-weight: 600;">-</span> in last 24h
                            </p>
                        </div>

                        <div class="analytics-card" style="background: var(--bg-primary); border: 1px solid var(--border-light); border-radius: var(--radius-lg); padding: 1.5rem; box-shadow: var(--shadow-sm);">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="background: var(--accent-green); padding: 0.75rem; border-radius: var(--radius-md); font-size: 1.25rem;">👥</div>
                                <div>
                                    <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.25rem;">Active Users</h3>
                                    <p id="unique-users" style="font-size: 1.5rem; font-weight: 700; color: var(--primary-color);">Loading...</p>
                                </div>
                            </div>
                            <p style="color: var(--text-secondary); font-size: 0.875rem;">
                                <span id="users-24h" style="color: var(--primary-color); font-weight: 600;">-</span> in last 24h
                            </p>
                        </div>

                        <div class="analytics-card" style="background: var(--bg-primary); border: 1px solid var(--border-light); border-radius: var(--radius-lg); padding: 1.5rem; box-shadow: var(--shadow-sm);">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="background: var(--accent-blue); padding: 0.75rem; border-radius: var(--radius-md); font-size: 1.25rem;">⚡</div>
                                <div>
                                    <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.25rem;">Avg Response Time</h3>
                                    <p id="avg-execution-time" style="font-size: 1.5rem; font-weight: 700; color: var(--primary-color);">Loading...</p>
                                </div>
                            </div>
                            <p style="color: var(--text-secondary); font-size: 0.875rem;">
                                Error rate: <span id="error-rate" style="color: var(--primary-color); font-weight: 600;">-</span>%
                            </p>
                        </div>

                        <div class="analytics-card" style="background: var(--bg-primary); border: 1px solid var(--border-light); border-radius: var(--radius-lg); padding: 1.5rem; box-shadow: var(--shadow-sm);">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="background: var(--accent-green); padding: 0.75rem; border-radius: var(--radius-md); font-size: 1.25rem;">📊</div>
                                <div>
                                    <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.25rem;">Active Channels</h3>
                                    <p id="active-channels" style="font-size: 1.5rem; font-weight: 700; color: var(--primary-color);">Loading...</p>
                                </div>
                            </div>
                            <p style="color: var(--text-secondary); font-size: 0.875rem;">
                                Rate limits: <span id="rate-limit-hits" style="color: var(--primary-color); font-weight: 600;">-</span>
                            </p>
                        </div>
                    </div>

                    <!-- Analytics Sections -->
                    <div class="analytics-sections" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                        
                        <!-- Top Users -->
                        <div class="analytics-section" style="background: var(--bg-primary); border: 1px solid var(--border-light); border-radius: var(--radius-lg); padding: 1.5rem; box-shadow: var(--shadow-sm);">
                            <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.25rem;">🏆</span> Most Active Users
                            </h3>
                            <div id="top-users-list" style="space-y: 0.75rem;">
                                <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">Loading...</div>
                            </div>
                        </div>

                        <!-- Popular Commands -->
                        <div class="analytics-section" style="background: var(--bg-primary); border: 1px solid var(--border-light); border-radius: var(--radius-lg); padding: 1.5rem; box-shadow: var(--shadow-sm);">
                            <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.25rem;">⚡</span> Popular Commands
                            </h3>
                            <div id="top-commands-list" style="space-y: 0.75rem;">
                                <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">Loading...</div>
                            </div>
                        </div>
                    </div>

                    <!-- Channel Analytics -->
                    <div class="analytics-section" style="background: var(--bg-primary); border: 1px solid var(--border-light); border-radius: var(--radius-lg); padding: 1.5rem; box-shadow: var(--shadow-sm); margin-bottom: 2rem;">
                        <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span style="font-size: 1.25rem;">📺</span> Channel Activity
                        </h3>
                        <div id="channel-analytics" style="overflow-x: auto;">
                            <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">Loading...</div>
                        </div>
                    </div>

                    <!-- Game Analytics -->
                    <div class="analytics-section" style="background: var(--bg-primary); border: 1px solid var(--border-light); border-radius: var(--radius-lg); padding: 1.5rem; box-shadow: var(--shadow-sm); margin-bottom: 2rem;">
                        <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span style="font-size: 1.25rem;">🎮</span> Game Statistics
                        </h3>
                        <div id="game-analytics-content">
                            <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">Loading...</div>
                        </div>
                    </div>

                    <!-- Performance Metrics -->
                    <div class="analytics-section" style="background: var(--bg-primary); border: 1px solid var(--border-light); border-radius: var(--radius-lg); padding: 1.5rem; box-shadow: var(--shadow-sm);">
                        <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span style="font-size: 1.25rem;">🔧</span> Performance Metrics
                        </h3>
                        <div id="performance-metrics" style="overflow-x: auto;">
                            <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">Loading...</div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Tools Tab -->
            <div id="tools" class="tab-content">
                <div class="network-header">
                    <h2>🔧 Useful Tools</h2>
                    <p class="network-description">Collection of handy web tools and utilities</p>
                </div>

                <div style="padding: 2rem;">
                    <!-- Tools Grid -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                        
                        <!-- Text Tools -->
                        <div class="tool-card" style="background: var(--bg-primary); border: 1px solid var(--border-light); border-radius: var(--radius-lg); padding: 1.5rem; box-shadow: var(--shadow-sm);">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="background: var(--accent-blue); padding: 0.75rem; border-radius: var(--radius-md); font-size: 1.25rem;">📝</div>
                                <div>
                                    <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.25rem;">Text Tools</h3>
                                    <p style="color: var(--text-secondary); font-size: 0.875rem;">Text manipulation utilities</p>
                                </div>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <button onclick="openTool('base64')" style="padding: 0.75rem; background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: var(--radius-md); cursor: pointer; text-align: left; transition: all 0.2s;">
                                    <strong>Base64 Encoder/Decoder</strong><br>
                                    <small style="color: var(--text-secondary);">Encode and decode Base64 strings</small>
                                </button>
                                <button onclick="openTool('hash')" style="padding: 0.75rem; background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: var(--radius-md); cursor: pointer; text-align: left; transition: all 0.2s;">
                                    <strong>Hash Generator</strong><br>
                                    <small style="color: var(--text-secondary);">Generate MD5, SHA1, SHA256 hashes</small>
                                </button>
                                <button onclick="openTool('url')" style="padding: 0.75rem; background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: var(--radius-md); cursor: pointer; text-align: left; transition: all 0.2s;">
                                    <strong>URL Encoder/Decoder</strong><br>
                                    <small style="color: var(--text-secondary);">Encode and decode URLs</small>
                                </button>
                            </div>
                        </div>

                        <!-- Color Tools -->
                        <div class="tool-card" style="background: var(--bg-primary); border: 1px solid var(--border-light); border-radius: var(--radius-lg); padding: 1.5rem; box-shadow: var(--shadow-sm);">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="background: var(--accent-green); padding: 0.75rem; border-radius: var(--radius-md); font-size: 1.25rem;">🎨</div>
                                <div>
                                    <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.25rem;">Color Tools</h3>
                                    <p style="color: var(--text-secondary); font-size: 0.875rem;">Color conversion and palette tools</p>
                                </div>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <button onclick="openTool('color-picker')" style="padding: 0.75rem; background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: var(--radius-md); cursor: pointer; text-align: left; transition: all 0.2s;">
                                    <strong>Color Picker</strong><br>
                                    <small style="color: var(--text-secondary);">Pick colors and get HEX, RGB, HSL values</small>
                                </button>
                                <button onclick="openTool('gradient')" style="padding: 0.75rem; background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: var(--radius-md); cursor: pointer; text-align: left; transition: all 0.2s;">
                                    <strong>Gradient Generator</strong><br>
                                    <small style="color: var(--text-secondary);">Create CSS gradients</small>
                                </button>
                                <button onclick="openTool('palette')" style="padding: 0.75rem; background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: var(--radius-md); cursor: pointer; text-align: left; transition: all 0.2s;">
                                    <strong>Color Palette</strong><br>
                                    <small style="color: var(--text-secondary);">Generate color schemes</small>
                                </button>
                            </div>
                        </div>

                        <!-- Developer Tools -->
                        <div class="tool-card" style="background: var(--bg-primary); border: 1px solid var(--border-light); border-radius: var(--radius-lg); padding: 1.5rem; box-shadow: var(--shadow-sm);">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="background: var(--accent-blue); padding: 0.75rem; border-radius: var(--radius-md); font-size: 1.25rem;">💻</div>
                                <div>
                                    <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.25rem;">Developer Tools</h3>
                                    <p style="color: var(--text-secondary); font-size: 0.875rem;">Programming and development utilities</p>
                                </div>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <button onclick="openTool('json')" style="padding: 0.75rem; background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: var(--radius-md); cursor: pointer; text-align: left; transition: all 0.2s;">
                                    <strong>JSON Formatter</strong><br>
                                    <small style="color: var(--text-secondary);">Format and validate JSON</small>
                                </button>
                                <button onclick="openTool('regex')" style="padding: 0.75rem; background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: var(--radius-md); cursor: pointer; text-align: left; transition: all 0.2s;">
                                    <strong>Regex Tester</strong><br>
                                    <small style="color: var(--text-secondary);">Test regular expressions</small>
                                </button>
                                <button onclick="openTool('uuid')" style="padding: 0.75rem; background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: var(--radius-md); cursor: pointer; text-align: left; transition: all 0.2s;">
                                    <strong>UUID Generator</strong><br>
                                    <small style="color: var(--text-secondary);">Generate UUIDs and GUIDs</small>
                                </button>
                            </div>
                        </div>

                        <!-- Utility Tools -->
                        <div class="tool-card" style="background: var(--bg-primary); border: 1px solid var(--border-light); border-radius: var(--radius-lg); padding: 1.5rem; box-shadow: var(--shadow-sm);">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div style="background: var(--accent-green); padding: 0.75rem; border-radius: var(--radius-md); font-size: 1.25rem;">⚡</div>
                                <div>
                                    <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.25rem;">Utilities</h3>
                                    <p style="color: var(--text-secondary); font-size: 0.875rem;">General purpose tools</p>
                                </div>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <button onclick="openTool('timestamp')" style="padding: 0.75rem; background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: var(--radius-md); cursor: pointer; text-align: left; transition: all 0.2s;">
                                    <strong>Timestamp Converter</strong><br>
                                    <small style="color: var(--text-secondary);">Convert between timestamps and dates</small>
                                </button>
                                <button onclick="openTool('password')" style="padding: 0.75rem; background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: var(--radius-md); cursor: pointer; text-align: left; transition: all 0.2s;">
                                    <strong>Password Generator</strong><br>
                                    <small style="color: var(--text-secondary);">Generate secure passwords</small>
                                </button>
                                <button onclick="openTool('calculator')" style="padding: 0.75rem; background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: var(--radius-md); cursor: pointer; text-align: left; transition: all 0.2s;">
                                    <strong>Calculator</strong><br>
                                    <small style="color: var(--text-secondary);">Advanced calculator with programming functions</small>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Tool Interface Container -->
                    <div id="tool-interface" style="display: none; background: var(--bg-primary); border: 1px solid var(--border-light); border-radius: var(--radius-lg); padding: 2rem; box-shadow: var(--shadow-sm);">
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 1.5rem;">
                            <h3 id="tool-title" style="color: var(--text-primary); font-weight: 600; margin: 0;"></h3>
                            <button onclick="closeTool()" style="background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: var(--radius-md); padding: 0.5rem 1rem; cursor: pointer; color: var(--text-primary);">Close</button>
                        </div>
                        <div id="tool-content"></div>
                    </div>
                </div>
            </div>

            <!-- Admin Panel Tab -->

        <div class="footer">
            <p>&copy; 2021 cr0sis | IRC Bot Documentation</p>
            <div>
                <a href="https://github.com/cr0sis" target="_blank"><i class="fab fa-github"></i> GitHub</a>
                <span style="margin: 0 10px;">|</span>
                <a href="privacy.html">Privacy Policy</a>
            </div>
        </div>
    </div>

    <!-- Bot Status Manager Module -->
    <script src="js/bot_status_manager.js"></script>
    <script src="js/secure-game.min.js"></script>

    <script>
        // Copy to clipboard functionality
        function copyCommand(command, event) {
            event.stopPropagation(); // Prevent command details from toggling
            
            navigator.clipboard.writeText(command).then(function() {
                showCopyNotification();
            }).catch(function(err) {
                console.error('Failed to copy text: ', err);
                // Fallback for older browsers
                const textArea = document.createElement("textarea");
                textArea.value = command;
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    showCopyNotification();
                } catch (err) {
                    console.error('Fallback: Oops, unable to copy', err);
                }
                document.body.removeChild(textArea);
            });
        }

        function showCopyNotification() {
            const notification = document.getElementById('copy-notification');
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2000);
        }

        function showTab(tabName, saveToStorage = true) {
            // Preserve current scroll position
            const currentScrollY = window.scrollY;
            
            // Hide all tab contents
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Remove active class from all buttons
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to the corresponding button
            const targetButton = document.querySelector(`[onclick="showTab('${tabName}')"]`);
            if (targetButton) {
                targetButton.classList.add('active');
            }
            
            // Save current tab to localStorage for persistence and update URL hash
            if (saveToStorage) {
                localStorage.setItem('mainSiteActiveTab', tabName);
                // Update URL hash without triggering page reload
                history.replaceState(null, null, '#' + tabName);
            }
            
            // Restore scroll position after DOM updates
            setTimeout(() => {
                window.scrollTo(0, currentScrollY);
            }, 0);
            
            // Load leaderboard data if leaderboard tab is selected
            if (tabName === 'leaderboard') {
                loadLeaderboard();
            }
            
            // Load analytics data if analytics tab is selected
            if (tabName === 'analytics') {
                loadAnalytics('rizon');
            }
            
            // Load pigs leaderboard data if pigs leaderboard tab is selected
            if (tabName === 'pigs-leaderboard') {
                loadPigsLeaderboard();
            }
            
            
            // Load analytics if analytics tab is selected
            if (tabName === 'analytics') {
                loadAnalytics(currentAnalyticsNetwork);
            }
        }
        
        let currentNetwork = 'Rizon';
        let leaderboardData = null;
        
        function loadLeaderboard() {
            // Show loading state (if there's a loading element)
            const loadingElement = document.getElementById('uno-loading');
            const errorElement = document.getElementById('uno-error');
            const tableElement = document.getElementById('leaderboard-table');
            
            if (loadingElement) loadingElement.style.display = 'flex';
            if (errorElement) errorElement.style.display = 'none';
            if (tableElement) tableElement.style.display = 'none';
            
            fetch(`api/uno_leaderboard.php?network=${currentNetwork.toLowerCase()}`)
                .then(response => response.json())
                .then(data => {
                    leaderboardData = data;
                    
                    
                    showNetworkLeaderboard(currentNetwork);
                })
                .catch(error => {
                    console.error('Error loading leaderboard:', error);
                    if (loadingElement) loadingElement.style.display = 'none';
                    if (errorElement) {
                        errorElement.style.display = 'flex';
                    } else {
                        document.getElementById('leaderboard-entries').innerHTML = 
                            '<div style="padding: 2.5rem; text-align: center; color: #dc2626;">Error loading leaderboard data</div>';
                    }
                });
        }
        
        // Global variables for sorting
        let currentSortColumn = 'win_rate';
        let currentSortDirection = 'desc';
        
        function sortUnoLeaderboard(column) {
            // Toggle direction if clicking the same column
            if (currentSortColumn === column) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortColumn = column;
                // Set default direction based on column type
                currentSortDirection = ['games_played', 'wins', 'total_cards_played', 'current_win_streak'].includes(column) ? 'desc' : 'desc';
            }
            
            // Update sort indicators
            document.querySelectorAll('.sort-indicator').forEach(indicator => {
                indicator.textContent = '';
            });
            const currentIndicator = document.getElementById(`sort-${column}`) || document.getElementById(`sort-games_played`);
            if (currentIndicator) {
                currentIndicator.textContent = currentSortDirection === 'asc' ? '▲' : '▼';
            }
            
            // Re-display the leaderboard with new sorting
            showNetworkLeaderboard(currentNetwork);
        }
        
        function sortPlayerData(players, column, direction) {
            return [...players].sort((a, b) => {
                let valueA = a[column];
                let valueB = b[column];
                
                // Handle different data types
                if (typeof valueA === 'string') {
                    valueA = valueA.toLowerCase();
                    valueB = valueB.toLowerCase();
                }
                
                // Handle numerical comparisons
                if (typeof valueA === 'number' && typeof valueB === 'number') {
                    return direction === 'asc' ? valueA - valueB : valueB - valueA;
                }
                
                // Handle string comparisons
                if (direction === 'asc') {
                    return valueA < valueB ? -1 : valueA > valueB ? 1 : 0;
                } else {
                    return valueA > valueB ? -1 : valueA < valueB ? 1 : 0;
                }
            });
        }

        function showNetworkLeaderboard(network) {
            currentNetwork = network;
            
            // Update button styles
            document.querySelectorAll('.network-btn').forEach(btn => {
                btn.style.background = 'var(--bg-tertiary)';
                btn.style.color = 'var(--text-secondary)';
                btn.classList.remove('active');
            });
            document.getElementById(`${network.toLowerCase()}-leaderboard-btn`).style.background = 'var(--primary-color)';
            document.getElementById(`${network.toLowerCase()}-leaderboard-btn`).style.color = 'white';
            document.getElementById(`${network.toLowerCase()}-leaderboard-btn`).classList.add('active');
            
            if (!leaderboardData) {
                loadLeaderboard();
                return;
            }
            
            const entriesContainer = document.getElementById('leaderboard-entries');
            const totalPlayersElement = document.getElementById('total-players');
            const totalGamesElement = document.getElementById('total-games');
            const topPlayerElement = document.getElementById('top-player');
            const lastUpdatedElement = document.getElementById('last-updated');
            
            const networkInfo = leaderboardData.networks && leaderboardData.networks[network];
            const networkData = networkInfo && networkInfo.players ? networkInfo.players : (networkInfo && Array.isArray(networkInfo) ? networkInfo : []);
            
            if (networkData && networkData.length > 0) {
                // Sort the data based on current sort settings
                const sortedData = sortPlayerData(networkData, currentSortColumn, currentSortDirection);
                
                // Update stats
                const totalGames = networkInfo && networkInfo.total_games !== undefined ? networkInfo.total_games : 0;
                const totalPlayers = sortedData.length;
                const topPlayer = sortedData[0];
                
                console.log('UNO Leaderboard - Network:', network, 'Total Games:', totalGames, 'From API:', networkInfo);
                
                totalPlayersElement.textContent = totalPlayers;
                totalGamesElement.textContent = totalGames;
                topPlayerElement.textContent = topPlayer.player;
                
                // Display comprehensive leaderboard
                entriesContainer.innerHTML = '';
                entriesContainer.style.display = 'block';
                entriesContainer.style.alignItems = 'stretch';
                entriesContainer.style.justifyContent = 'stretch';
                
                sortedData.forEach((player, index) => {
                    // Main row container
                    const rowContainer = document.createElement('div');
                    rowContainer.style.cssText = 'border-bottom: 1px solid var(--border-light);';
                    
                    // Main row
                    const row = document.createElement('div');
                    row.style.cssText = 'display: grid; grid-template-columns: 50px 1fr 80px 80px 80px 100px 100px 90px 60px; gap: 0.75rem; align-items: center; padding: 0.75rem 1.5rem; transition: background-color 0.2s ease; font-size: 0.875rem; cursor: pointer;';
                    
                    const rankEmoji = index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : `${index + 1}`;
                    const winRate = player.games_played > 0 ? player.win_rate : 0;
                    
                    // Get favorite color with appropriate emoji
                    const colorEmojis = { 'Red': '🔴', 'Blue': '🔵', 'Green': '🟢', 'Yellow': '🟡', 'None': '⚫' };
                    const favoriteColorEmoji = colorEmojis[player.favorite_color] || '❓';
                    
                    row.innerHTML = `
                        <div style="font-size: 1rem; ${index < 3 ? 'font-weight: 700;' : 'font-weight: 500;'}">${rankEmoji}</div>
                        <div style="font-weight: 600; color: var(--text-primary);">${player.player}</div>
                        <div style="font-family: var(--font-mono); color: var(--text-secondary);">${player.games_played}</div>
                        <div style="font-family: var(--font-mono); color: #059669; font-weight: 600;">${player.wins}</div>
                        <div style="font-family: var(--font-mono); color: var(--text-secondary);">${winRate}%</div>
                        <div style="font-family: var(--font-mono); color: var(--primary-color); font-weight: 600;">${player.total_cards_played}</div>
                        <div style="font-family: var(--font-mono); color: #dc2626; font-weight: 600;">${player.current_win_streak}</div>
                        <div style="font-size: 1rem; text-align: center;">${favoriteColorEmoji}</div>
                        <div style="text-align: center;"><button class="details-btn" style="background: var(--primary-color); color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.75rem;">📊</button></div>
                    `;
                    
                    // Details panel (initially hidden)
                    const detailsPanel = document.createElement('div');
                    detailsPanel.className = 'player-details-panel';
                    detailsPanel.style.cssText = 'display: none; padding: 1.5rem; background: var(--bg-secondary); border-top: 1px solid var(--border-light);';
                    detailsPanel.innerHTML = createPlayerDetailsHTML(player);
                    
                    // Add hover effect to main row
                    row.addEventListener('mouseenter', () => {
                        row.style.backgroundColor = 'var(--bg-secondary)';
                    });
                    row.addEventListener('mouseleave', () => {
                        row.style.backgroundColor = '';
                    });
                    
                    // Add click handler to toggle details
                    row.addEventListener('click', (e) => {
                        togglePlayerDetailsForContainer(rowContainer);
                    });
                    
                    // Add specific event listener for the details button
                    const detailsButton = row.querySelector('.details-btn');
                    if (detailsButton) {
                        detailsButton.addEventListener('click', (e) => {
                            e.stopPropagation(); // Prevent row click
                            togglePlayerDetailsForContainer(rowContainer);
                        });
                    }
                    
                    rowContainer.appendChild(row);
                    rowContainer.appendChild(detailsPanel);
                    entriesContainer.appendChild(rowContainer);
                });
                
                // Update last updated time
                if (leaderboardData.last_updated) {
                    const date = new Date(leaderboardData.last_updated);
                    lastUpdatedElement.textContent = `Last updated: ${date.toLocaleString()}`;
                }
            } else {
                entriesContainer.innerHTML = `<div style="padding: 2.5rem; text-align: center; color: var(--text-secondary);">No ${network} games played yet!</div>`;
                totalPlayersElement.textContent = '0';
                totalGamesElement.textContent = '0';
                topPlayerElement.textContent = '-';
            }
        }
        
        function createPlayerDetailsHTML(player) {
            // Helper function to format time
            const formatTime = (seconds) => {
                if (!seconds) return 'N/A';
                if (seconds < 60) return `${seconds}s`;
                if (seconds < 3600) return `${Math.floor(seconds/60)}m ${seconds%60}s`;
                return `${Math.floor(seconds/3600)}h ${Math.floor((seconds%3600)/60)}m`;
            };
            
            return `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                    <!-- Performance Stats -->
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-chart-line"></i> Performance
                        </h4>
                        <div style="display: grid; gap: 0.5rem; font-size: 0.875rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>Win Rate:</span>
                                <strong style="color: #059669;">${player.win_rate}%</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Current Streak:</span>
                                <strong style="color: ${player.current_win_streak > 0 ? '#059669' : '#dc2626'};">${player.current_win_streak}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Longest Streak:</span>
                                <strong style="color: var(--primary-color);">${player.longest_win_streak}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Comeback Wins:</span>
                                <strong style="color: #f59e0b;">${player.comeback_wins}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>UNO Wins:</span>
                                <strong style="color: var(--primary-color);">${player.uno_wins}</strong>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Card Statistics -->
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-playing-card"></i> Cards
                        </h4>
                        <div style="display: grid; gap: 0.5rem; font-size: 0.875rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>Cards per Game:</span>
                                <strong>${player.avg_cards_per_game}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Wild Cards:</span>
                                <strong style="color: #6b46c1;">${player.wild_cards_played}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>+4 Cards:</span>
                                <strong style="color: #dc2626;">${player.plus4_cards_played}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>+2 Cards:</span>
                                <strong style="color: #f59e0b;">${player.plus2_cards_played}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Skip Cards:</span>
                                <strong style="color: #06b6d4;">${player.skip_cards_played}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Reverse Cards:</span>
                                <strong style="color: #8b5cf6;">${player.reverse_cards_played}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Largest Hand:</span>
                                <strong style="color: #dc2626;">${player.largest_hand_size}</strong>
                            </div>
                        </div>
                    </div>
                    
                    <!-- UNO Mechanics -->
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-exclamation"></i> UNO Mechanics
                        </h4>
                        <div style="display: grid; gap: 0.5rem; font-size: 0.875rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>Successful UNO Calls:</span>
                                <strong style="color: #059669;">${player.successful_uno_calls}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Caught No UNO:</span>
                                <strong style="color: #dc2626;">${player.caught_no_uno}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>UNO Success Rate:</span>
                                <strong style="color: ${player.uno_call_success_rate > 50 ? '#059669' : '#dc2626'};">${player.uno_call_success_rate}%</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Challenges Won:</span>
                                <strong style="color: #059669;">${player.successful_challenges}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Challenges Failed:</span>
                                <strong style="color: #dc2626;">${player.failed_challenges}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Times Challenged:</span>
                                <strong>${player.times_challenged}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Challenge Success:</span>
                                <strong style="color: ${player.challenge_success_rate > 50 ? '#059669' : '#dc2626'};">${player.challenge_success_rate}%</strong>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Timing & Colors -->
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-palette"></i> Colors & Timing
                        </h4>
                        <div style="display: grid; gap: 0.5rem; font-size: 0.875rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>🔴 Red Cards:</span>
                                <strong>${player.red_cards_played}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>🔵 Blue Cards:</span>
                                <strong>${player.blue_cards_played}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>🟢 Green Cards:</span>
                                <strong>${player.green_cards_played}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>🟡 Yellow Cards:</span>
                                <strong>${player.yellow_cards_played}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Fastest Game:</span>
                                <strong style="color: #059669;">${formatTime(player.fastest_game_seconds)}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Longest Game:</span>
                                <strong style="color: #dc2626;">${formatTime(player.longest_game_seconds)}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Avg Game Time:</span>
                                <strong>${formatTime(player.avg_game_time_seconds)}</strong>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Temporal Patterns -->
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-calendar"></i> Playing Patterns
                        </h4>
                        <div style="display: grid; gap: 0.5rem; font-size: 0.875rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>Games This Week:</span>
                                <strong style="color: var(--primary-color);">${player.games_this_week}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Games This Month:</span>
                                <strong style="color: var(--primary-color);">${player.games_this_month}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Weekend Games:</span>
                                <strong style="color: #f59e0b;">${player.weekend_games}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Weekday Games:</span>
                                <strong style="color: #06b6d4;">${player.weekday_games}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Last Game:</span>
                                <strong style="color: var(--text-secondary); font-size: 0.75rem;">${new Date(player.last_game).toLocaleDateString()}</strong>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function togglePlayerDetails(element, playerName) {
            // Find the row container from the clicked row
            const rowContainer = element.parentNode;
            togglePlayerDetailsForContainer(rowContainer);
        }
        
        function togglePlayerDetailsForContainer(rowContainer) {
            const detailsPanel = rowContainer.querySelector('.player-details-panel');
            const button = rowContainer.querySelector('.details-btn');
            
            if (detailsPanel && detailsPanel.style.display === 'none') {
                detailsPanel.style.display = 'block';
                if (button) button.textContent = '📈';
            } else {
                if (detailsPanel) detailsPanel.style.display = 'none';
                if (button) button.textContent = '📊';
            }
        }
        
        function refreshUnoLeaderboard() {
            // Clear cached data and reload
            leaderboardData = null;
            loadLeaderboard();
        }
        
        // Pass the Pigs Leaderboard Functions
        
        // Pigs-specific togglePlayerDetails function (different from UNO version above)
        function togglePlayerDetails(playerName, index) {
            const detailsRow = document.getElementById(`details-${index}`);
            const isVisible = detailsRow.style.display !== 'none';
            
            // Hide all other detail rows first
            document.querySelectorAll('[id^="details-"]').forEach(row => {
                row.style.display = 'none';
            });
            
            // Toggle current row
            if (!isVisible) {
                detailsRow.style.display = 'block';
            }
        }
        
        let pigsLeaderboardData = null;
        let currentPigsNetwork = 'Rizon';
        
        function loadPigsLeaderboard() {
            // Show loading state
            document.getElementById('pigs-loading').style.display = 'flex';
            document.getElementById('pigs-error').style.display = 'none';
            document.getElementById('pigs-leaderboard-table').style.display = 'none';
            
            fetch(`api/pigs_leaderboard.php?network=${currentPigsNetwork.toLowerCase()}`)
                .then(response => response.json())
                .then(data => {
                    pigsLeaderboardData = data;
                    
                    
                    showPigsNetworkLeaderboard(currentPigsNetwork);
                })
                .catch(error => {
                    console.error('Error loading pigs leaderboard:', error);
                    document.getElementById('pigs-loading').style.display = 'none';
                    document.getElementById('pigs-error').style.display = 'flex';
                });
        }
        
        function showPigsNetworkLeaderboard(network) {
            currentPigsNetwork = network;
            
            // Update button styles
            document.querySelectorAll('#rizon-pigs-btn, #libera-pigs-btn').forEach(btn => {
                btn.style.background = 'var(--bg-tertiary)';
                btn.style.color = 'var(--text-secondary)';
                btn.classList.remove('active');
            });
            document.getElementById(`${network.toLowerCase()}-pigs-btn`).style.background = 'var(--primary-color)';
            document.getElementById(`${network.toLowerCase()}-pigs-btn`).style.color = 'white';
            document.getElementById(`${network.toLowerCase()}-pigs-btn`).classList.add('active');
            
            if (!pigsLeaderboardData) {
                loadPigsLeaderboard();
                return;
            }
            
            // Load data for the selected network
            document.getElementById('pigs-loading').style.display = 'flex';
            document.getElementById('pigs-error').style.display = 'none';
            document.getElementById('pigs-leaderboard-table').style.display = 'none';
            
            fetch(`api/pigs_leaderboard.php?network=${network.toLowerCase()}`)
                .then(response => response.json())
                .then(data => {
                    pigsLeaderboardData = data;
                    displayPigsLeaderboard(data);
                })
                .catch(error => {
                    console.error('Error loading pigs leaderboard:', error);
                    document.getElementById('pigs-loading').style.display = 'none';
                    document.getElementById('pigs-error').style.display = 'flex';
                });
        }
        
        function displayPigsLeaderboard(data) {
            document.getElementById('pigs-loading').style.display = 'none';
            document.getElementById('pigs-error').style.display = 'none';
            
            const tableContainer = document.getElementById('pigs-leaderboard-table');
            const dataContainer = document.getElementById('pigs-leaderboard-data');
            
            if (data.players && data.players.length > 0) {
                // Update stats
                document.getElementById('pigs-total-players').textContent = data.total_players || data.players.length;
                document.getElementById('pigs-total-games').textContent = data.total_games || 0;
                document.getElementById('pigs-highest-score').textContent = data.highest_score || 0;
                document.getElementById('pigs-total-pig-outs').textContent = data.total_pig_outs || 0;
                document.getElementById('pigs-total-oinkers').textContent = data.total_oinkers || 0;
                
                // Clear and populate table
                dataContainer.innerHTML = '';
                
                data.players.forEach((player, index) => {
                    const rowContainer = document.createElement('div');
                    rowContainer.style.cssText = 'border-bottom: 1px solid var(--border-light);';
                    
                    // Main row
                    const row = document.createElement('div');
                    row.style.cssText = 'display: grid; grid-template-columns: 50px 1fr 60px 60px 60px 80px 70px 70px 80px 70px; gap: 0.5rem; align-items: center; padding: 0.75rem 1.5rem; transition: background-color 0.2s ease; font-size: 0.8rem; cursor: pointer;';
                    
                    const rankEmoji = index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : `${index + 1}`;
                    const riskScore = Math.round(player.risk_tolerance_score || 0);
                    const avgRolls = player.avg_rolls_before_bank ? parseFloat(player.avg_rolls_before_bank).toFixed(1) : '0.0';
                    
                    row.innerHTML = `
                        <div style="font-weight: 600; color: var(--primary-color);">${rankEmoji}</div>
                        <div style="font-weight: 600; color: var(--text-primary);">${player.user}</div>
                        <div style="color: var(--text-primary);">${player.wins}</div>
                        <div style="color: var(--text-secondary);">${player.games_played}</div>
                        <div style="color: var(--text-secondary);">${player.total_rolls}</div>
                        <div style="color: var(--text-primary); font-weight: 600;">${player.highest_game_score}</div>
                        <div style="color: var(--text-primary);">${player.current_win_streak || 0}</div>
                        <div style="color: ${riskScore >= 60 ? 'var(--accent-color)' : riskScore >= 30 ? 'var(--text-primary)' : 'var(--text-secondary)'};">${riskScore}</div>
                        <div style="color: var(--text-secondary);">${avgRolls}</div>
                        <button onclick="togglePlayerDetails('${player.user}', ${index})" style="background: var(--primary-color); color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.7rem; cursor: pointer;">📊</button>
                    `;
                    
                    // Detailed stats row (initially hidden)
                    const detailsRow = document.createElement('div');
                    detailsRow.id = `details-${index}`;
                    detailsRow.style.cssText = 'display: none; background: var(--bg-secondary); padding: 1rem 1.5rem; grid-column: 1 / -1;';
                    
                    const bankingStats = `
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-top: 0.5rem;">
                            <div style="text-align: center; background: var(--bg-primary); padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border-light);">
                                <div style="font-weight: 600; color: var(--primary-color); font-size: 0.9rem;">${player.banks_under_10 || 0}</div>
                                <div style="font-size: 0.7rem; color: var(--text-secondary);">Banks < 10</div>
                            </div>
                            <div style="text-align: center; background: var(--bg-primary); padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border-light);">
                                <div style="font-weight: 600; color: var(--primary-color); font-size: 0.9rem;">${player.banks_10_to_20 || 0}</div>
                                <div style="font-size: 0.7rem; color: var(--text-secondary);">Banks 10-20</div>
                            </div>
                            <div style="text-align: center; background: var(--bg-primary); padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border-light);">
                                <div style="font-weight: 600; color: var(--primary-color); font-size: 0.9rem;">${player.banks_20_to_30 || 0}</div>
                                <div style="font-size: 0.7rem; color: var(--text-secondary);">Banks 20-30</div>
                            </div>
                            <div style="text-align: center; background: var(--bg-primary); padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border-light);">
                                <div style="font-weight: 600; color: var(--primary-color); font-size: 0.9rem;">${player.banks_over_30 || 0}</div>
                                <div style="font-size: 0.7rem; color: var(--text-secondary);">Banks > 30</div>
                            </div>
                        </div>
                    `;
                    
                    detailsRow.innerHTML = `
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <div>
                                <h4 style="margin: 0 0 0.75rem 0; color: var(--text-primary); font-size: 0.9rem;">🏆 Performance Stats</h4>
                                <div style="font-size: 0.8rem; color: var(--text-secondary); line-height: 1.4;">
                                    <div><strong>Longest Win Streak:</strong> ${player.longest_win_streak || 0}</div>
                                    <div><strong>Longest No-Pigout Streak:</strong> ${player.longest_no_pigout_streak || 0}</div>
                                    <div><strong>Comeback Wins:</strong> ${player.comeback_wins || 0}</div>
                                    <div><strong>Close Wins:</strong> ${player.close_wins || 0}</div>
                                    <div><strong>Total Banks:</strong> ${player.total_banks || 0}</div>
                                    <div><strong>Successful Turns:</strong> ${player.successful_turns || 0}/${player.total_turns || 0}</div>
                                </div>
                            </div>
                            <div>
                                <h4 style="margin: 0 0 0.75rem 0; color: var(--text-primary); font-size: 0.9rem;">🎲 Position Stats</h4>
                                <div style="font-size: 0.8rem; color: var(--text-secondary); line-height: 1.4;">
                                    <div><strong>Sides (+Pig Outs):</strong> ${player.sides_rolled || 0}</div>
                                    <div><strong>Pig Outs:</strong> ${player.pig_outs || 0}</div>
                                    <div><strong>Razorbacks (5pt):</strong> ${player.razorbacks_rolled || 0}</div>
                                    <div><strong>Trotters (5pt):</strong> ${player.trotters_rolled || 0}</div>
                                    <div><strong>Snouters (10pt):</strong> ${player.snouters_rolled || 0}</div>
                                    <div><strong>Leaning Jowlers (15pt):</strong> ${player.leaning_jowlers_rolled || 0}</div>
                                    <div><strong>🔥 Double Razorback (20pt):</strong> ${player.double_razorback || 0}</div>
                                    <div><strong>🔥 Double Trotter (20pt):</strong> ${player.double_trotter || 0}</div>
                                    <div><strong>🔥 Double Snouter (40pt):</strong> ${player.double_snouter || 0}</div>
                                    <div><strong>🔥 Double Leaning Jowler (60pt):</strong> ${player.double_leaning_jowler || 0}</div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h4 style="margin: 1rem 0 0.5rem 0; color: var(--text-primary); font-size: 0.9rem;">💰 Banking Patterns</h4>
                            ${bankingStats}
                        </div>
                    `;
                    
                    rowContainer.appendChild(row);
                    rowContainer.appendChild(detailsRow);
                    
                    // Add hover effect
                    row.addEventListener('mouseenter', () => {
                        row.style.backgroundColor = 'var(--bg-secondary)';
                    });
                    row.addEventListener('mouseleave', () => {
                        row.style.backgroundColor = 'transparent';
                    });
                    
                    dataContainer.appendChild(rowContainer);
                });
                
                // Update last updated time
                if (data.last_updated) {
                    const date = new Date(data.last_updated);
                    document.getElementById('pigs-last-updated').textContent = `Last updated: ${date.toLocaleString()}`;
                }
                
                tableContainer.style.display = 'block';
            } else {
                // No data available
                document.getElementById('pigs-total-players').textContent = '0';
                document.getElementById('pigs-total-games').textContent = '0';
                document.getElementById('pigs-highest-score').textContent = '0';
                document.getElementById('pigs-total-pig-outs').textContent = '0';
                
                dataContainer.innerHTML = `
                    <div style="padding: 2rem; text-align: center; color: var(--text-secondary); grid-column: 1 / -1;">
                        <i class="fas fa-pig" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                        <p>No ${currentPigsNetwork} Pass the Pigs games played yet!</p>
                        <p style="font-size: 0.875rem; margin-top: 0.5rem;">Be the first to play and claim the leaderboard!</p>
                    </div>
                `;
                
                tableContainer.style.display = 'block';
            }
        }
        
        function refreshPigsLeaderboard() {
            loadPigsLeaderboard();
        }
        
        // Analytics System
        let currentAnalyticsNetwork = 'rizon';
        let analyticsData = {};
        
        function loadAnalytics(network) {
            if (!network) network = 'rizon';
            currentAnalyticsNetwork = network;
            
            // Update button styles
            document.querySelectorAll('.analytics-network-selector .network-btn').forEach(btn => {
                btn.style.background = 'var(--bg-tertiary)';
                btn.style.color = 'var(--text-secondary)';
                btn.classList.remove('active');
            });
            
            const activeBtn = document.getElementById(`${network}-analytics-btn`);
            if (activeBtn) {
                activeBtn.style.background = 'var(--primary-color)';
                activeBtn.style.color = 'white';
                activeBtn.classList.add('active');
                console.log('✅ Updated active button for:', network);
            } else {
                console.error('❌ Could not find analytics button for:', network);
            }
            
            // Load all analytics data
            loadAnalyticsSummary(network);
            loadUserAnalytics(network);
            loadChannelAnalytics(network);
            loadPerformanceMetrics(network);
            loadGameAnalytics(network);
        }
        
        function loadAnalyticsSummary(network) {
            fetch(`api/bot_analytics.php?network=${network}&action=summary&days=30`)
                .then(response => {
                    return response.json();
                })
                .then(data => {
                    if (data.error) {
                        console.error('❌ Analytics error:', data.error);
                        return;
                    }
                    
                    // Update summary cards
                    const overview = data.overview;
                    document.getElementById('total-commands').textContent = overview.total_commands || '0';
                    document.getElementById('unique-users').textContent = overview.unique_users || '0';
                    document.getElementById('active-channels').textContent = overview.active_channels || '0';
                    document.getElementById('avg-execution-time').textContent = overview.avg_execution_time ? `${overview.avg_execution_time}ms` : '-';
                    document.getElementById('error-rate').textContent = overview.error_rate_percent || '0';
                    document.getElementById('rate-limit-hits').textContent = overview.rate_limit_hits || '0';
                    
                    // Recent activity
                    const recent = data.recent_activity;
                    document.getElementById('commands-24h').textContent = recent.commands_24h || '0';
                    document.getElementById('users-24h').textContent = recent.users_24h || '0';
                    
                    // Top users
                    displayTopUsers(data.top_users || []);
                    
                    // Top commands
                    displayTopCommands(data.top_commands || []);
                })
                .catch(error => {
                    console.error('❌ Error loading analytics summary:', error);
                    // Show error in UI
                    document.getElementById('total-commands').textContent = 'Error';
                    document.getElementById('unique-users').textContent = 'Error';
                    document.getElementById('avg-execution-time').textContent = 'Error';
                });
        }
        
        function displayTopUsers(users) {
            const container = document.getElementById('top-users-list');
            if (!users.length) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 2rem;">No user data available</div>';
                return;
            }
            
            container.innerHTML = users.map((user, index) => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: var(--bg-secondary); border-radius: var(--radius-md); margin-bottom: 0.5rem;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <span style="font-weight: 600; color: var(--primary-color); width: 24px;">#${index + 1}</span>
                        <span style="font-weight: 500; color: var(--text-primary);">${user.user}</span>
                    </div>
                    <span style="font-family: var(--font-mono); color: var(--text-secondary); font-size: 0.875rem;">${user.command_count} commands</span>
                </div>
            `).join('');
        }
        
        function displayTopCommands(commands) {
            const container = document.getElementById('top-commands-list');
            if (!commands.length) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 2rem;">No command data available</div>';
                return;
            }
            
            container.innerHTML = commands.map((cmd, index) => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: var(--bg-secondary); border-radius: var(--radius-md); margin-bottom: 0.5rem;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <span style="font-weight: 600; color: var(--primary-color); width: 24px;">#${index + 1}</span>
                        <code style="background: var(--bg-tertiary); padding: 0.25rem 0.5rem; border-radius: var(--radius-sm); font-size: 0.875rem;">${cmd.command}</code>
                    </div>
                    <span style="font-family: var(--font-mono); color: var(--text-secondary); font-size: 0.875rem;">${cmd.usage_count} uses</span>
                </div>
            `).join('');
        }
        
        function loadUserAnalytics(network) {
            fetch(`api/bot_analytics.php?network=${network}&action=user_analytics&days=30`)
                .then(response => response.json())
                .then(data => {
                    displayUserAnalytics(data.user_analytics || []);
                })
                .catch(error => {
                    console.error('❌ Error loading user analytics:', error);
                    // Since there's no specific user analytics section, we'll skip this for now
                });
        }
        
        function displayUserAnalytics(users) {
            // This function can be used for future user analytics display
        }
        
        function loadChannelAnalytics(network) {
            fetch(`api/bot_analytics.php?network=${network}&action=channel_analytics&days=30`)
                .then(response => response.json())
                .then(data => {
                    displayChannelAnalytics(data);
                })
                .catch(error => {
                    console.error('Error loading channel analytics:', error);
                    document.getElementById('channel-analytics').innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 2rem;">Error loading channel data</div>';
                });
        }
        
        function displayChannelAnalytics(channels) {
            const container = document.getElementById('channel-analytics');
            if (!channels.length) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 2rem;">No channel data available</div>';
                return;
            }
            
            container.innerHTML = `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: var(--bg-secondary); text-align: left;">
                            <th style="padding: 0.75rem; font-weight: 600; color: var(--text-primary);">Channel</th>
                            <th style="padding: 0.75rem; font-weight: 600; color: var(--text-primary);">Commands</th>
                            <th style="padding: 0.75rem; font-weight: 600; color: var(--text-primary);">Users</th>
                            <th style="padding: 0.75rem; font-weight: 600; color: var(--text-primary);">Avg Time</th>
                            <th style="padding: 0.75rem; font-weight: 600; color: var(--text-primary);">Errors</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${channels.map(channel => `
                            <tr style="border-bottom: 1px solid var(--border-light);">
                                <td style="padding: 0.75rem; font-family: var(--font-mono); color: var(--primary-color);">${channel.channel}</td>
                                <td style="padding: 0.75rem; color: var(--text-primary);">${channel.total_commands}</td>
                                <td style="padding: 0.75rem; color: var(--text-primary);">${channel.unique_users}</td>
                                <td style="padding: 0.75rem; color: var(--text-secondary);">${channel.avg_command_time || 0}ms</td>
                                <td style="padding: 0.75rem; color: ${channel.error_count > 0 ? '#dc2626' : 'var(--text-secondary)'};">${channel.error_count}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }
        
        function loadPerformanceMetrics(network) {
            fetch(`api/bot_analytics.php?network=${network}&action=performance&hours=24`)
                .then(response => response.json())
                .then(data => {
                    displayPerformanceMetrics(data);
                })
                .catch(error => {
                    console.error('Error loading performance metrics:', error);
                    document.getElementById('performance-metrics').innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 2rem;">Error loading performance data</div>';
                });
        }
        
        function displayPerformanceMetrics(performance) {
            const container = document.getElementById('performance-metrics');
            if (!performance || Object.keys(performance).length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 2rem;">No performance data available</div>';
                return;
            }
            
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div style="background: var(--bg-secondary); padding: 1rem; border-radius: var(--radius-md); text-align: center;">
                        <div style="font-size: 1.25rem; font-weight: 700; color: var(--primary-color);">${performance.avg_execution_time}ms</div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">Avg Response Time</div>
                    </div>
                    <div style="background: var(--bg-secondary); padding: 1rem; border-radius: var(--radius-md); text-align: center;">
                        <div style="font-size: 1.25rem; font-weight: 700; color: var(--primary-color);">${performance.peak_memory_usage || 0}MB</div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">Peak Memory</div>
                    </div>
                    <div style="background: var(--bg-secondary); padding: 1rem; border-radius: var(--radius-md); text-align: center;">
                        <div style="font-size: 1.25rem; font-weight: 700; color: var(--primary-color);">${performance.commands_per_hour}</div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">Commands/Hour</div>
                    </div>
                    <div style="background: var(--bg-secondary); padding: 1rem; border-radius: var(--radius-md); text-align: center;">
                        <div style="font-size: 1.25rem; font-weight: 700; color: ${performance.error_rate_percent > 5 ? '#dc2626' : 'var(--primary-color)'};">${performance.error_rate_percent}%</div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">Error Rate</div>
                    </div>
                </div>
            `;
        }
        
        
        function loadGameAnalytics(network) {
            // Load analytics from both networks and combine the totals
            Promise.all([
                fetch(`api/bot_analytics.php?network=rizon&action=game_analytics&days=30`).then(r => r.json()),
                fetch(`api/bot_analytics.php?network=libera&action=game_analytics&days=30`).then(r => r.json())
            ])
                .then(([rizonData, liberaData]) => {
                    // Combine the data from both networks
                    const combinedData = {
                        uno: {
                            total_uno_players: (rizonData.uno?.total_uno_players || 0) + (liberaData.uno?.total_uno_players || 0),
                            total_uno_games: (rizonData.uno?.total_uno_games || 0) + (liberaData.uno?.total_uno_games || 0),
                            avg_games_per_player: ((rizonData.uno?.avg_games_per_player || 0) + (liberaData.uno?.avg_games_per_player || 0)) / 2,
                            avg_cards_per_game: ((rizonData.uno?.avg_cards_per_game || 0) + (liberaData.uno?.avg_cards_per_game || 0)) / 2,
                            longest_win_streak: Math.max(rizonData.uno?.longest_win_streak || 0, liberaData.uno?.longest_win_streak || 0),
                            total_comeback_wins: (rizonData.uno?.total_comeback_wins || 0) + (liberaData.uno?.total_comeback_wins || 0)
                        },
                        pigs: {
                            total_pigs_players: (rizonData.pigs?.total_pigs_players || 0) + (liberaData.pigs?.total_pigs_players || 0),
                            total_pigs_games: (rizonData.pigs?.total_pigs_games || 0) + (liberaData.pigs?.total_pigs_games || 0),
                            avg_games_per_player: ((rizonData.pigs?.avg_games_per_player || 0) + (liberaData.pigs?.avg_games_per_player || 0)) / 2,
                            highest_score: Math.max(rizonData.pigs?.highest_score || 0, liberaData.pigs?.highest_score || 0),
                            total_pig_outs: (rizonData.pigs?.total_pig_outs || 0) + (liberaData.pigs?.total_pig_outs || 0),
                            total_oinkers: (rizonData.pigs?.total_oinkers || 0) + (liberaData.pigs?.total_oinkers || 0),
                            avg_rolls_per_game: ((rizonData.pigs?.avg_rolls_per_game || 0) + (liberaData.pigs?.avg_rolls_per_game || 0)) / 2
                        }
                    };
                    displayGameAnalytics(combinedData);
                })
                .catch(error => {
                    console.error('Error loading game analytics:', error);
                    document.getElementById('game-analytics-content').innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 2rem;">Error loading game data</div>';
                });
        }
        
        function displayGameAnalytics(games) {
            const container = document.getElementById('game-analytics-content');
            if (!games || ((!games.uno || Object.keys(games.uno).length === 0) && (!games.pigs || Object.keys(games.pigs).length === 0))) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 2rem;">No game data available</div>';
                return;
            }
            
            let html = '';
            
            if (games.uno && Object.keys(games.uno).length > 0) {
                html += `
                    <div style="margin-bottom: 1rem;">
                        <h4 style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.5rem;">🃏 UNO Statistics</h4>
                        <div style="background: var(--bg-secondary); padding: 0.75rem; border-radius: var(--radius-md); font-size: 0.875rem;">
                            Games: <span style="font-weight: 600;">${games.uno.total_uno_games || 0}</span> •
                            Players: <span style="font-weight: 600;">${games.uno.total_uno_players || 0}</span> •
                            Longest Streak: <span style="font-weight: 600;">${games.uno.longest_win_streak || 0}</span>
                        </div>
                    </div>
                `;
            }
            
            if (games.pigs && Object.keys(games.pigs).length > 0) {
                html += `
                    <div>
                        <h4 style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.5rem;">🐷 Pass the Pigs</h4>
                        <div style="background: var(--bg-secondary); padding: 0.75rem; border-radius: var(--radius-md); font-size: 0.875rem;">
                            Games: <span style="font-weight: 600;">${games.pigs.total_pigs_games || 0}</span> •
                            Players: <span style="font-weight: 600;">${games.pigs.total_pigs_players || 0}</span> •
                            High Score: <span style="font-weight: 600;">${games.pigs.highest_score || 0}</span>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        function toggleCommand(element) {
            const details = element.querySelector('.command-details');
            const isExpanded = element.classList.contains('expanded');
            
            if (isExpanded) {
                element.classList.remove('expanded');
                details.classList.remove('active');
            } else {
                element.classList.add('expanded');
                details.classList.add('active');
            }
        }
        
        // Close command details when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.command-item')) {
                document.querySelectorAll('.command-item.expanded').forEach(item => {
                    item.classList.remove('expanded');
                    item.querySelector('.command-details').classList.remove('active');
                });
            }
        });

        // Override the showTab function to initialize breakout when needed
        const originalShowTab = showTab;
        showTab = function(tabName, saveToStorage = true) {
            originalShowTab(tabName, saveToStorage);
            
            // Load and initialize breakout iframe when tab is clicked
            if (tabName === 'breakout') {
                const breakoutIframe = document.getElementById('breakout-iframe');
                if (breakoutIframe && !breakoutIframe.src) {
                    // Load the iframe for the first time
                    breakoutIframe.src = breakoutIframe.getAttribute('data-src');
                }
                
                setTimeout(() => {
                    const breakoutIframes = document.querySelectorAll('iframe[src*="breakout.html"]');
                    const currentTheme = document.body.getAttribute('data-theme') || 'light';
                    breakoutIframes.forEach(iframe => {
                        try {
                            iframe.contentWindow.postMessage({
                                type: 'themeChange',
                                theme: currentTheme
                            }, '*');
                        } catch (e) {
                            console.log('Could not send initial theme to iframe:', e);
                        }
                    });
                }, 1000); // Give iframe time to load
            }
        };

        // Dark Mode Toggle Functionality
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('theme-icon');
            const themeText = document.getElementById('theme-text');
            
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            // Update the theme
            if (newTheme === 'dark') {
                body.setAttribute('data-theme', 'dark');
                themeIcon.className = 'theme-toggle-icon fas fa-moon';
                themeText.textContent = 'Use light theme';
            } else {
                body.removeAttribute('data-theme');
                themeIcon.className = 'theme-toggle-icon fas fa-sun';
                themeText.textContent = 'Use dark theme';
            }
            
            // Save preference to localStorage
            localStorage.setItem('theme', newTheme);
            
            // Notify any breakout iframes about theme change
            const breakoutIframes = document.querySelectorAll('iframe[src*="breakout.html"]');
            breakoutIframes.forEach(iframe => {
                try {
                    iframe.contentWindow.postMessage({
                        type: 'themeChange',
                        theme: newTheme
                    }, '*');
                } catch (e) {
                    console.log('Could not send theme change to iframe:', e);
                }
            });
        }

        // Terminal Theme Toggle Functionality
        function toggleTerminalTheme() {
            const body = document.body;
            const terminalText = document.getElementById('terminal-text');
            
            // Toggle terminal theme class
            body.classList.toggle('terminal-theme');
            
            const isTerminal = body.classList.contains('terminal-theme');
            
            // Debug: Log the terminal theme state
            console.log('Terminal theme toggled:', isTerminal);
            console.log('Body classes:', body.className);
            
            // Update button text
            terminalText.textContent = isTerminal ? 'Normal' : 'Terminal';
            
            // Save preference to localStorage
            localStorage.setItem('terminal-theme', isTerminal ? 'enabled' : 'disabled');
        }

        // Initialize terminal theme on page load
        function initializeTerminalTheme() {
            const savedTerminalTheme = localStorage.getItem('terminal-theme');
            const terminalText = document.getElementById('terminal-text');
            
            if (savedTerminalTheme === 'enabled') {
                document.body.classList.add('terminal-theme');
                terminalText.textContent = 'Normal';
            } else {
                terminalText.textContent = 'Terminal';
            }
        }

        // Initialize theme on page load
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const themeIcon = document.getElementById('theme-icon');
            const themeText = document.getElementById('theme-text');
            
            // Use saved theme or system preference
            const theme = savedTheme || (prefersDark ? 'dark' : 'light');
            
            if (theme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                themeIcon.className = 'theme-toggle-icon fas fa-moon';
                themeText.textContent = 'Dark';
            } else {
                document.body.removeAttribute('data-theme');
                themeIcon.className = 'theme-toggle-icon fas fa-sun';
                themeText.textContent = 'Light';
            }
        }

        // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            if (!localStorage.getItem('theme')) {
                // Only auto-switch if user hasn't manually set a preference
                if (e.matches) {
                    document.body.setAttribute('data-theme', 'dark');
                    document.getElementById('theme-icon').className = 'theme-toggle-icon fas fa-moon';
                    document.getElementById('theme-text').textContent = 'Dark';
                } else {
                    document.body.removeAttribute('data-theme');
                    document.getElementById('theme-icon').className = 'theme-toggle-icon fas fa-sun';
                    document.getElementById('theme-text').textContent = 'Light';
                }
            }
        });

        // Initialize theme and restore saved tab when DOM is loaded

        // Admin session keepalive

        // Notification system for SSO messages
        function showNotification(title, message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <h4>${title}</h4>
                    <p>${message}</p>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">&times;</button>
            `;
            
            // Style the notification
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10000;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
                color: white;
                padding: 1rem;
                border-radius: 8px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                max-width: 400px;
                animation: slideIn 0.3s ease-out;
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }
        
        // Handle post-login redirects (especially after 2FA and SSO)
        function handlePostLoginRedirect() {
            const urlParams = new URLSearchParams(window.location.search);
            const loginSuccess = urlParams.get('login_success');
            const ssoLogin = urlParams.get('sso_login');
            const ssoError = urlParams.get('sso_error');
            const focusTarget = urlParams.get('focus');
            
            // Handle SSO login success
            if (ssoLogin === 'success') {
                console.log('SSO login successful, updating UI...');
                checkAuthStatus();
                showNotification('SSO Login Successful', 'You have been successfully logged in via Single Sign-On.', 'success');
                
                // Clean up URL
                const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
                window.history.replaceState({path: newUrl}, '', newUrl);
                return;
            }
            
            // Handle SSO errors
            if (ssoError) {
                console.error('SSO login error:', ssoError);
                showNotification('SSO Login Failed', decodeURIComponent(ssoError), 'error');
                
                // Clean up URL
                const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
                window.history.replaceState({path: newUrl}, '', newUrl);
                return;
            }
            
            if (loginSuccess === '2fa') {
                console.log('2FA login successful, updating UI...');
                
                // Update authentication status
                checkAuthStatus();
                
                // Close any open modals
                closeModal('login-modal');
                
                // Show success notification
                showNotification('2FA Successful', 'Two-factor authentication completed successfully.', 'success');
                
                // Focus on the specified network button or default to rizon
                if (focusTarget === 'rizon') {
                    setTimeout(() => {
                        // Click the rizon network tab to focus on it
                        const rizonBtn = document.querySelector('[data-network="rizon"]');
                        if (rizonBtn) {
                            rizonBtn.click();
                            console.log('Focused on Rizon network after 2FA login');
                        }
                    }, 500);
                }
                
                // Clean up URL parameters
                const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
                window.history.replaceState({path: newUrl}, '', newUrl);
                
                // Show a subtle success message
                setTimeout(() => {
                    const statusArea = document.querySelector('.status-area') || document.body;
                    const successMsg = document.createElement('div');
                    successMsg.style.cssText = `
                        position: fixed; top: 20px; right: 20px; z-index: 10000;
                        background: rgba(0, 255, 0, 0.9); color: black; padding: 15px 20px;
                        border-radius: 5px; font-family: monospace; font-weight: bold;
                        box-shadow: 0 4px 12px rgba(0, 255, 0, 0.3);
                    `;
                    successMsg.textContent = '✅ 2FA Login Successful';
                    statusArea.appendChild(successMsg);
                    
                    // Remove message after 3 seconds
                    setTimeout(() => successMsg.remove(), 3000);
                }, 1000);
            }
        }

        // Form handlers - wrapped in DOMContentLoaded to ensure elements exist
        function initializeFormHandlers() {
            const loginForm = document.getElementById('login-form');
            if (!loginForm) {
                console.error('Login form not found!');
                return;
            }
            
            loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const messageDiv = document.getElementById('login-message');
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;

            messageDiv.innerHTML = '';
            
            const result = await login(username, password);
            
            if (result.success) {
                messageDiv.innerHTML = `<div class="success-message">${result.message}</div>`;
                setTimeout(() => {
                    closeModal('login-modal');
                    checkAuthStatus();
                }, 1000);
            } else {
                messageDiv.innerHTML = `<div class="error-message">${result.message}</div>`;
            }
            });

            const registerForm = document.getElementById('register-form');
            if (!registerForm) {
                console.error('Register form not found!');
                return;
            }
            
            registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const messageDiv = document.getElementById('register-message');
            const username = document.getElementById('register-username').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;

            messageDiv.innerHTML = '';
            
            const result = await register(username, email, password);
            
            if (result.success) {
                messageDiv.innerHTML = `<div class="success-message">${result.message}</div>`;
                setTimeout(() => {
                    closeModal('register-modal');
                    // Automatically show login modal
                    showLoginModal();
                }, 1500);
            } else {
                messageDiv.innerHTML = `<div class="error-message">${result.message}</div>`;
            }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            initializeTerminalTheme();
            initializeFormHandlers();
            initializeManualCommands();
            initializeLogsManualCommands();
            checkCookieConsent();
            // Initialize theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                if (document.getElementById('theme-icon')) {
                    document.getElementById('theme-icon').className = 'theme-toggle-icon fas fa-moon';
                    document.getElementById('theme-text').textContent = 'Use light theme';
                }
            }
        });
        
        function initializeManualCommands() {
            // Set up input event listener for real-time preview updates
            const commandInput = document.getElementById('manual-command');
            if (commandInput) {
                commandInput.addEventListener('input', updateCommandPreview);
                commandInput.addEventListener('keyup', updateCommandPreview);
                
                // Add Enter key handler to send command
                commandInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && commandInput.value.trim()) {
                        e.preventDefault();
                        sendManualCommand();
                    }
                });
            }
            
            // Initialize default network and channel selection
            selectNetwork('rizon'); // This will also set up the default channel
        }
        
        function initializeLogsManualCommands() {
            // Set up input event listener for real-time preview updates for logs section
            const logsCommandInput = document.getElementById('logs-manual-command');
            if (logsCommandInput) {
                logsCommandInput.addEventListener('input', updateLogsCommandPreview);
                logsCommandInput.addEventListener('keyup', updateLogsCommandPreview);
                
                // Add Enter key handler to send command
                logsCommandInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && logsCommandInput.value.trim()) {
                        e.preventDefault();
                        sendLogsManualCommand();
                    }
                });
            }
            
            // Initialize default network and channel selection for logs section
            selectLogsNetwork('rizon'); // This will also set up the default channel
            selectLogsChannel('#8bitvape'); // Set default channel
        }
    </script>

    <!-- GDPR Cookie Consent -->
    <div id="cookie-consent" class="cookie-consent" style="display: none;">
        <div class="cookie-content">
            <div class="cookie-text">
                <h4>🍪 We use cookies</h4>
                <p>We use essential cookies to remember your login session and game preferences. No tracking or analytics cookies are used. You can decline and still play as a guest.</p>
            </div>
            <div class="cookie-actions">
                <button class="auth-button" onclick="acceptCookies()">Accept</button>
                <button class="auth-button secondary" onclick="declineCookies()">Decline</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Login to Your Account</h2>
                <p style="color: var(--text-secondary); font-size: 0.875rem;">Access your saved scores and play without entering your name each time</p>
            </div>
            
            <!-- SSO Login Options -->
            <div id="sso-options" style="margin-bottom: 1.5rem;">
                <!-- SSO providers will be loaded here -->
            </div>
            
            <!-- Email Login Toggle -->
            <div style="text-align: center; margin: 1rem 0;">
                <button type="button" id="show-email-login-btn" onclick="toggleEmailLoginForm()" 
                        style="background: none; border: 1px solid var(--border-medium); color: var(--text-secondary); 
                               padding: 0.75rem 1.5rem; border-radius: var(--radius-md); cursor: pointer; 
                               font-size: 0.875rem; transition: all 0.2s; width: 100%;">
                    <i class="fas fa-envelope" style="margin-right: 0.5rem;"></i>
                    Login with email/password instead
                    <i class="fas fa-chevron-down" style="margin-left: 0.5rem; transition: transform 0.2s;" id="email-login-chevron"></i>
                </button>
            </div>
            
            <!-- Collapsible Email Login Form -->
            <div id="email-login-form" style="display: none; margin-top: 1rem;">
                <div style="text-align: center; margin: 1rem 0; color: var(--text-secondary); font-size: 0.875rem;">
                    <hr style="border: none; border-top: 1px solid var(--border-light); margin: 1rem 0;">
                </div>
                
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-username">Username or Email</label>
                        <input type="text" id="login-username" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" class="form-input" required>
                    </div>
                    <div id="login-message"></div>
                    <div class="form-actions">
                        <button type="button" class="auth-button secondary" onclick="closeModal('login-modal')">Cancel</button>
                        <button type="submit" class="auth-button">Login</button>
                    </div>
                </form>
            </div>
            <p style="text-align: center; margin-top: 1rem; color: var(--text-secondary); font-size: 0.875rem;">
                Don't have an account? <a href="#" onclick="showRegisterModal(); closeModal('login-modal')" style="color: var(--primary-color);">Register here</a>
            </p>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="register-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create Account</h2>
                <p style="color: var(--text-secondary); font-size: 0.875rem;">Join to save your high scores and play seamlessly</p>
            </div>
            
            <!-- SSO Register Options -->
            <div id="sso-register-options" style="margin-bottom: 1.5rem;">
                <!-- SSO providers will be loaded here -->
            </div>
            
            <!-- Email Registration Toggle -->
            <div style="text-align: center; margin: 1rem 0;">
                <button type="button" id="show-email-register-btn" onclick="toggleEmailRegisterForm()" 
                        style="background: none; border: 1px solid var(--border-medium); color: var(--text-secondary); 
                               padding: 0.75rem 1.5rem; border-radius: var(--radius-md); cursor: pointer; 
                               font-size: 0.875rem; transition: all 0.2s; width: 100%;">
                    <i class="fas fa-envelope" style="margin-right: 0.5rem;"></i>
                    Create account with email instead
                    <i class="fas fa-chevron-down" style="margin-left: 0.5rem; transition: transform 0.2s;" id="email-register-chevron"></i>
                </button>
            </div>
            
            <!-- Collapsible Email Registration Form -->
            <div id="email-register-form" style="display: none; margin-top: 1rem;">
                <div style="text-align: center; margin: 1rem 0; color: var(--text-secondary); font-size: 0.875rem;">
                    <hr style="border: none; border-top: 1px solid var(--border-light); margin: 1rem 0;">
                </div>
                
                <form id="register-form">
                    <div class="form-group">
                        <label for="register-username">Username</label>
                        <input type="text" id="register-username" class="form-input" required minlength="3" maxlength="20">
                        <small style="color: var(--text-secondary); font-size: 0.75rem;">3-20 characters, will be shown on leaderboards</small>
                    </div>
                    <div class="form-group">
                        <label for="register-email">Email</label>
                        <input type="email" id="register-email" class="form-input" required>
                        <small style="color: var(--text-secondary); font-size: 0.75rem;">Used for login only, never shared</small>
                    </div>
                    <div class="form-group">
                        <label for="register-password">Password</label>
                        <input type="password" id="register-password" class="form-input" required minlength="6">
                        <small style="color: var(--text-secondary); font-size: 0.75rem;">Minimum 6 characters</small>
                    </div>
                    <div id="register-message"></div>
                    <div class="form-actions">
                        <button type="button" class="auth-button secondary" onclick="closeModal('register-modal')">Cancel</button>
                        <button type="submit" class="auth-button">Create Account</button>
                    </div>
                </form>
            </div>
            <p style="text-align: center; margin-top: 1rem; color: var(--text-secondary); font-size: 0.875rem;">
                Already have an account? <a href="#" onclick="showLoginModal(); closeModal('register-modal')" style="color: var(--primary-color);">Login here</a>
            </p>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="admin-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>⚙️ Admin Panel</h2>
                <p style="color: var(--text-secondary); font-size: 0.875rem;">Manage user accounts and permissions</p>
            </div>
            <div id="admin-loading" style="text-align: center; padding: 2rem; display: none;">
                <div style="color: var(--text-secondary);">Loading users...</div>
            </div>
            <div id="admin-content">
                <table class="admin-table" id="users-table">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Admin</th>
                            <th>Created</th>
                            <th>Last Login</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="users-tbody">
                        <!-- Users will be loaded here -->
                    </tbody>
                </table>
            </div>
            <div class="form-actions" style="margin-top: 1.5rem;">
                <button type="button" class="auth-button secondary" onclick="closeModal('admin-modal')">Close</button>
                <button type="button" class="auth-button" onclick="loadUsers()">Refresh</button>
            </div>
            <div id="admin-message"></div>
        </div>
    </div>

    <!-- Authentication JavaScript -->
    <script>
        // Dark Mode Toggle Functionality
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('theme-icon');
            const themeText = document.getElementById('theme-text');
            
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            // Update the theme
            if (newTheme === 'dark') {
                body.setAttribute('data-theme', 'dark');
                themeIcon.className = 'theme-toggle-icon fas fa-moon';
                themeText.textContent = 'Use light theme';
            } else {
                body.removeAttribute('data-theme');
                themeIcon.className = 'theme-toggle-icon fas fa-sun';
                themeText.textContent = 'Use dark theme';
            }
            
            // Save preference to localStorage
            localStorage.setItem('theme', newTheme);
        }

        // GDPR Cookie Consent
        let cookiesAccepted = false;

        function checkCookieConsent() {
            const consent = localStorage.getItem('cookie_consent');
            if (!consent) {
                document.getElementById('cookie-consent').style.display = 'block';
            } else {
                cookiesAccepted = consent === 'accepted';
                // Always check auth status regardless of cookie consent
                checkAuthStatus();
            }
        }

        function acceptCookies() {
            localStorage.setItem('cookie_consent', 'accepted');
            cookiesAccepted = true;
            document.getElementById('cookie-consent').style.display = 'none';
            // Check authentication after accepting cookies
            checkAuthStatus();
        }

        function declineCookies() {
            localStorage.setItem('cookie_consent', 'declined');
            cookiesAccepted = false;
            document.getElementById('cookie-consent').style.display = 'none';
            // Keep login/register buttons visible for guest accounts
            updateAuthUI(false);
        }

        // Authentication functions
        let currentUser = null;

        async function checkAuthStatus() {
            try {
                const response = await fetch('auth.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'check_auth' })
                });
                const data = await response.json();
                
                currentUser = data.logged_in ? data.user : null;
                updateAuthUI(data.logged_in, data.user);
            } catch (error) {
                console.error('Auth check failed:', error);
                updateAuthUI(false);
            }
        }

        function updateAuthUI(loggedIn, user = null) {
            const loggedOutDiv = document.getElementById('auth-logged-out');
            const loggedInDiv = document.getElementById('auth-logged-in');
            const usernameDisplay = document.getElementById('username-display');
            const profilePicture = document.getElementById('profile-picture');
            const fallbackEmoji = document.querySelector('.fallback-emoji');

            if (loggedIn && user) {
                loggedOutDiv.style.display = 'none';
                loggedInDiv.style.display = 'block';
                usernameDisplay.textContent = user.username;
                
                // Handle profile picture display
                if (user.profile_picture && user.profile_picture.trim() !== '') {
                    profilePicture.src = user.profile_picture;
                    profilePicture.alt = user.username + '\'s profile picture';
                    profilePicture.style.display = 'inline';
                    if (fallbackEmoji) fallbackEmoji.style.display = 'none';
                } else {
                    profilePicture.style.display = 'none';
                    if (fallbackEmoji) fallbackEmoji.style.display = 'inline';
                }
            } else {
                loggedOutDiv.style.display = 'flex';
                loggedInDiv.style.display = 'none';
            }
        }

        async function showLoginModal() {
            // Add warning if cookies were declined
            if (!cookiesAccepted) {
                const messageDiv = document.getElementById('login-message');
                messageDiv.innerHTML = '<div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 0.375rem; padding: 0.75rem; margin-bottom: 1rem; color: #92400e; font-size: 0.875rem;">⚠️ You declined cookies. Login will work but you\'ll need to log in again on your next visit.</div>';
            }
            
            // Load SSO providers
            await loadSSOProviders();
            
            document.getElementById('login-modal').style.display = 'flex';
        }

        async function loadSSOProviders() {
            try {
                const response = await fetch('sso_providers_api.php');
                const data = await response.json();
                
                const ssoOptionsDiv = document.getElementById('sso-options');
                const ssoRegisterOptionsDiv = document.getElementById('sso-register-options');
                
                if (data.success && data.providers && data.providers.length > 0) {
                    let ssoHtml = '';
                    
                    data.providers.forEach(provider => {
                        let iconHtml;
                        
                        // Use actual logos for major providers
                        if (provider.name === 'google') {
                            // Google logo as inline SVG (CSP-compliant)
                            iconHtml = `<svg width="20" height="20" viewBox="0 0 48 48" style="display: inline-block;">
                                <path fill="#ffc107" d="M43.611 20.083H42V20H24v8h11.303c-1.649 4.657-6.08 8-11.303 8-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4 12.955 4 4 12.955 4 24s8.955 20 20 20 20-8.955 20-20c0-1.341-.138-2.65-.389-3.917z"/>
                                <path fill="#ff3d00" d="M6.306 14.691l6.571 4.819C14.655 15.108 18.961 12 24 12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4 16.318 4 9.656 8.337 6.306 14.691z"/>
                                <path fill="#4caf50" d="M24 44c5.166 0 9.86-1.977 13.409-5.192l-6.19-5.238A11.91 11.91 0 0 1 24 36c-5.202 0-9.619-3.317-11.283-7.946l-6.522 5.025C9.505 39.556 16.227 44 24 44z"/>
                                <path fill="#1976d2" d="M43.611 20.083L43.595 20H24v8h11.303a12.04 12.04 0 0 1-4.087 5.571l.003-.002 6.19 5.238C36.971 39.205 44 34 44 24c0-1.341-.138-2.650-.389-3.917z"/>
                            </svg>`;
                        } else if (provider.name === 'microsoft') {
                            // Microsoft logo as FontAwesome (fallback)
                            iconHtml = `<div class="sso-icon"><i class="fab fa-microsoft" style="color: #0078d4;"></i></div>`;
                        } else if (provider.icon_url) {
                            iconHtml = `<img src="${escapeHtml(provider.icon_url)}" alt="${escapeHtml(provider.display_name)}" style="width: 20px; height: 20px;">`;
                        } else {
                            iconHtml = `<div class="sso-icon"><i class="fas fa-${provider.type === 'saml' ? 'certificate' : 'id-card'}"></i></div>`;
                        }
                        
                        const adminBadge = provider.admin_only ? ' <span style="font-size: 0.75rem; background: var(--accent-blue); color: var(--primary-color); padding: 0.125rem 0.375rem; border-radius: 0.25rem;">Admin</span>' : '';
                        
                        ssoHtml += `
                            <a href="/sso_auth.php?provider=${provider.id}" class="sso-button">
                                ${iconHtml}
                                <span>Continue with ${escapeHtml(provider.display_name)}${adminBadge}</span>
                            </a>
                        `;
                    });
                    
                    // Populate both login and register modals
                    if (ssoOptionsDiv) ssoOptionsDiv.innerHTML = ssoHtml;
                    if (ssoRegisterOptionsDiv) ssoRegisterOptionsDiv.innerHTML = ssoHtml;
                } else {
                    if (ssoOptionsDiv) ssoOptionsDiv.innerHTML = '';
                    if (ssoRegisterOptionsDiv) ssoRegisterOptionsDiv.innerHTML = '';
                }
            } catch (error) {
                console.error('Failed to load SSO providers:', error);
                document.getElementById('sso-options').innerHTML = '';
            }
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        async function showRegisterModal() {
            // Add info if cookies were declined
            if (!cookiesAccepted) {
                const messageDiv = document.getElementById('register-message');
                messageDiv.innerHTML = '<div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 0.375rem; padding: 0.75rem; margin-bottom: 1rem; color: #92400e; font-size: 0.875rem;">ℹ️ You declined cookies. Your account will be created but you\'ll need to log in again on each visit.</div>';
            }
            
            // Load SSO providers
            await loadSSOProviders();
            
            document.getElementById('register-modal').style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            // Clear form messages
            const messageDiv = document.querySelector(`#${modalId} [id$="-message"]`);
            if (messageDiv) messageDiv.innerHTML = '';
        }

        // Toggle Email Login Form
        function toggleEmailLoginForm() {
            const form = document.getElementById('email-login-form');
            const btn = document.getElementById('show-email-login-btn');
            const chevron = document.getElementById('email-login-chevron');
            
            if (form.style.display === 'none') {
                form.style.display = 'block';
                btn.innerHTML = '<i class="fas fa-envelope" style="margin-right: 0.5rem;"></i>Hide email/password login<i class="fas fa-chevron-up" style="margin-left: 0.5rem;" id="email-login-chevron"></i>';
                chevron.style.transform = 'rotate(180deg)';
            } else {
                form.style.display = 'none';
                btn.innerHTML = '<i class="fas fa-envelope" style="margin-right: 0.5rem;"></i>Login with email/password instead<i class="fas fa-chevron-down" style="margin-left: 0.5rem;" id="email-login-chevron"></i>';
                chevron.style.transform = 'rotate(0deg)';
            }
        }

        // Toggle Email Registration Form
        function toggleEmailRegisterForm() {
            const form = document.getElementById('email-register-form');
            const btn = document.getElementById('show-email-register-btn');
            const chevron = document.getElementById('email-register-chevron');
            
            if (form.style.display === 'none') {
                form.style.display = 'block';
                btn.innerHTML = '<i class="fas fa-envelope" style="margin-right: 0.5rem;"></i>Hide email registration<i class="fas fa-chevron-up" style="margin-left: 0.5rem;" id="email-register-chevron"></i>';
                chevron.style.transform = 'rotate(180deg)';
            } else {
                form.style.display = 'none';
                btn.innerHTML = '<i class="fas fa-envelope" style="margin-right: 0.5rem;"></i>Create account with email instead<i class="fas fa-chevron-down" style="margin-left: 0.5rem;" id="email-register-chevron"></i>';
                chevron.style.transform = 'rotate(0deg)';
            }
        }

        // CSRF Token Management
        let csrfToken = null;
        
        async function getCSRFToken() {
            if (!csrfToken) {
                try {
                    const response = await fetch('auth.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action: 'check_auth' })
                    });
                    const data = await response.json();
                    if (data.success && data.csrf_token) {
                        csrfToken = data.csrf_token;
                    }
                } catch (error) {
                    console.error('Failed to get CSRF token:', error);
                }
            }
            return csrfToken;
        }
        
        function addCSRFToken(requestBody) {
            if (csrfToken) {
                requestBody.csrf_token = csrfToken;
            }
            return requestBody;
        }

        async function login(username, password) {
            try {
                const response = await fetch('auth.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'login',
                        username: username,
                        password: password
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                // Handle 2FA requirement
                if (data.success && data.requires_2fa && data.redirect_url) {
                    // Redirect to 2FA verification page
                    window.location.href = data.redirect_url;
                    return data;
                }
                
                // Update CSRF token on successful login
                if (data.success && data.csrf_token) {
                    csrfToken = data.csrf_token;
                }
                
                return data;
            } catch (error) {
                console.error('Login error:', error);
                return { success: false, message: `Login failed: ${error.message}` };
            }
        }

        async function register(username, email, password) {
            try {
                await getCSRFToken(); // Ensure we have a CSRF token
                const requestBody = addCSRFToken({
                    action: 'register',
                    username: username,
                    email: email,
                    password: password
                });
                
                const response = await fetch('auth.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                const data = await response.json();
                return data;
            } catch (error) {
                return { success: false, message: 'Network error. Please try again.' };
            }
        }

        async function logout() {
            try {
                const response = await fetch('auth.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'logout' })
                });
                const data = await response.json();
                
                if (data.success) {
                    currentUser = null;
                    updateAuthUI(false);
                    
                    // Close admin panel tab if open
                    const adminTab = document.querySelector('[onclick="showTab(\'admin-panel\')"]');
                    if (adminTab && adminTab.classList.contains('active')) {
                        showTab('home');
                    }
                    
                    // Show logout success message
                    alert('You have been logged out successfully.');
                    
                    // Force reload page to ensure clean state
                    window.location.href = window.location.pathname;
                }
                return data;
            } catch (error) {
                return { success: false, message: 'Network error. Please try again.' };
            }
        }

        // Color Picker Functions
        let colorPickerData = {
            hue: 0,
            saturation: 1,
            lightness: 0.5,
            currentColor: '#6C5CE7'
        };

        function toggleColorPicker() {
            const dropdown = document.getElementById('color-picker-dropdown');
            const isVisible = dropdown.classList.contains('active');
            
            if (isVisible) {
                closeColorPicker();
            } else {
                openColorPicker();
            }
        }

        function openColorPicker() {
            const dropdown = document.getElementById('color-picker-dropdown');
            dropdown.classList.add('active');
            
            // Load current user color
            loadCurrentUserColor();
            
            // Initialize color wheel
            initColorWheel();
            
            // Add click outside listener
            setTimeout(() => {
                document.addEventListener('click', handleColorPickerClickOutside);
            }, 100);
        }

        function closeColorPicker() {
            const dropdown = document.getElementById('color-picker-dropdown');
            dropdown.classList.remove('active');
            
            // Remove click outside listener
            document.removeEventListener('click', handleColorPickerClickOutside);
        }

        function handleColorPickerClickOutside(event) {
            const dropdown = document.getElementById('color-picker-dropdown');
            const usernameDisplay = document.getElementById('username-display');
            
            if (!dropdown.contains(event.target) && !usernameDisplay.contains(event.target)) {
                closeColorPicker();
            }
        }

        async function loadCurrentUserColor() {
            try {
                const response = await fetch('user_color_api.php?action=get_current');
                const data = await response.json();
                
                if (data.success && data.color) {
                    colorPickerData.currentColor = data.color;
                    updateColorPreview(data.color);
                    setColorFromHex(data.color);
                }
            } catch (error) {
                console.error('Failed to load current color:', error);
            }
        }

        function initColorWheel() {
            const canvas = document.getElementById('color-wheel');
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = canvas.width / 2 - 10;

            // Draw color wheel
            for (let angle = 0; angle < 360; angle++) {
                const startAngle = (angle - 1) * Math.PI / 180;
                const endAngle = angle * Math.PI / 180;
                
                for (let r = 0; r < radius; r += 1) {
                    const saturation = r / radius;
                    const hsl = `hsl(${angle}, ${saturation * 100}%, 50%)`;
                    
                    ctx.beginPath();
                    ctx.strokeStyle = hsl;
                    ctx.lineWidth = 1;
                    ctx.arc(centerX, centerY, r, startAngle, endAngle);
                    ctx.stroke();
                }
            }

            // Add event listeners
            canvas.addEventListener('click', handleColorWheelClick);
            
            const hueSlider = document.getElementById('hue-slider');
            hueSlider.addEventListener('click', handleHueSliderClick);
            
            // Set initial position
            updateColorWheelPointer();
            updateHueSliderThumb();
        }

        function handleColorWheelClick(event) {
            const canvas = document.getElementById('color-wheel');
            const rect = canvas.getBoundingClientRect();
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const x = event.clientX - rect.left - centerX;
            const y = event.clientY - rect.top - centerY;
            
            const distance = Math.sqrt(x * x + y * y);
            const radius = canvas.width / 2 - 10;
            
            if (distance <= radius) {
                const angle = Math.atan2(y, x) * 180 / Math.PI;
                const hue = (angle + 360) % 360;
                const saturation = Math.min(distance / radius, 1);
                
                colorPickerData.hue = hue;
                colorPickerData.saturation = saturation;
                
                updateColorFromHSL();
            }
        }

        function handleHueSliderClick(event) {
            const slider = document.getElementById('hue-slider');
            const rect = slider.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const percentage = x / rect.width;
            
            colorPickerData.lightness = Math.max(0, Math.min(1, percentage));
            updateColorFromHSL();
        }

        function updateColorFromHSL() {
            const { hue, saturation, lightness } = colorPickerData;
            const color = hslToHex(hue, saturation * 100, lightness * 100);
            colorPickerData.currentColor = color;
            
            updateColorPreview(color);
            updateColorWheelPointer();
            updateHueSliderThumb();
        }

        function updateColorPreview(color) {
            const preview = document.getElementById('color-preview');
            const hexDisplay = document.getElementById('color-hex');
            
            preview.style.backgroundColor = color;
            hexDisplay.textContent = color.toUpperCase();
        }

        function updateColorWheelPointer() {
            const pointer = document.getElementById('color-wheel-pointer');
            const canvas = document.getElementById('color-wheel');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = (canvas.width / 2 - 10) * colorPickerData.saturation;
            
            const angle = colorPickerData.hue * Math.PI / 180;
            const x = centerX + radius * Math.cos(angle);
            const y = centerY + radius * Math.sin(angle);
            
            pointer.style.left = x + 'px';
            pointer.style.top = y + 'px';
        }

        function updateHueSliderThumb() {
            const thumb = document.getElementById('hue-slider-thumb');
            const percentage = colorPickerData.lightness * 100;
            
            thumb.style.left = percentage + '%';
        }

        function setColorFromHex(hex) {
            const hsl = hexToHsl(hex);
            colorPickerData.hue = hsl.h;
            colorPickerData.saturation = hsl.s / 100;
            colorPickerData.lightness = hsl.l / 100;
            colorPickerData.currentColor = hex;
            
            updateColorPreview(hex);
            
            if (document.getElementById('color-wheel').getContext) {
                updateColorWheelPointer();
                updateHueSliderThumb();
            }
        }

        async function saveColor() {
            try {
                const response = await fetch('user_color_api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'update_color',
                        color: colorPickerData.currentColor
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    closeColorPicker();
                    // Show success message
                    alert('Color saved successfully! Your new color will appear when you submit new scores to the Hall of Fame. Existing entries will keep their original colors.');
                } else {
                    alert('Failed to save color: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Failed to save color:', error);
                alert('Failed to save color. Please try again.');
            }
        }

        // Color conversion utilities
        function hslToHex(h, s, l) {
            l /= 100;
            const a = s * Math.min(l, 1 - l) / 100;
            const f = n => {
                const k = (n + h / 30) % 12;
                const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
                return Math.round(255 * color).toString(16).padStart(2, '0');
            };
            return `#${f(0)}${f(8)}${f(4)}`;
        }

        function hexToHsl(hex) {
            const r = parseInt(hex.slice(1, 3), 16) / 255;
            const g = parseInt(hex.slice(3, 5), 16) / 255;
            const b = parseInt(hex.slice(5, 7), 16) / 255;

            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;

            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }

            return { h: h * 360, s: s * 100, l: l * 100 };
        }

        // Open admin panel as tab

        // Setup real-time status updates for admin panel
        function setupStatusEventListeners() {
            console.log('Setting up status event listeners...');
            console.log('BotStatusManager available:', !!window.BotStatusManager);
            console.log('BotStatusManager.events available:', !!(window.BotStatusManager && window.BotStatusManager.events));
            
            // Check if BotStatusManager is available
            if (!window.BotStatusManager || !window.BotStatusManager.events) {
                console.warn('BotStatusManager not available, skipping event listeners');
                return;
            }
            
            // Temporary bypass - disable BotStatusManager setup
            console.warn('BotStatusManager setup temporarily disabled for debugging');
            return;
            
            try {
                console.log('About to setup BotStatusManager listeners...');
                
                // Listen for bot status changes
                BotStatusManager.on(BotStatusManager.events.STATUS_CHANGED, (status) => {
                    // Update any components that show overall status
                    updateOverallStatusIndicators(status);
                });
                
                BotStatusManager.on(BotStatusManager.events.BOT_ONLINE, (data) => {
                    console.log(`${data.network} bot came online`);
                    // Show notification or update specific UI elements
                    showStatusNotification(`${data.network.charAt(0).toUpperCase() + data.network.slice(1)} bot is now online`, 'success');
                });
                
                BotStatusManager.on(BotStatusManager.events.BOT_OFFLINE, (data) => {
                    console.log(`${data.network} bot went offline`);
                    showStatusNotification(`${data.network.charAt(0).toUpperCase() + data.network.slice(1)} bot went offline`, 'warning');
                });
                
                BotStatusManager.on(BotStatusManager.events.ERROR, (data) => {
                    console.error('Bot status error:', data.error);
                });
                
                console.log('BotStatusManager listeners setup complete');
            } catch (error) {
                console.error('Error setting up status event listeners:', error);
                console.error('BotStatusManager at error time:', window.BotStatusManager);
            }
        }
        
        function updateOverallStatusIndicators(status) {
            // Update any global status indicators
            const indicators = document.querySelectorAll('[data-bot-status-indicator]');
            indicators.forEach(indicator => {
                const network = indicator.dataset.botStatusIndicator;
                if (network && status.networks[network]) {
                    const networkStatus = status.networks[network];
                    indicator.style.color = networkStatus.status_color;
                    indicator.textContent = networkStatus.online ? '🟢' : '🔴';
                }
            });
        }
        
        function showStatusNotification(message, type = 'info') {
            // Create a simple notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10000;
                padding: 12px 16px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                max-width: 300px;
                box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
                transition: all 0.3s ease;
                background: ${type === 'success' ? '#059669' : type === 'warning' ? '#f59e0b' : '#2563eb'};
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        // Initialize admin panel when tab is shown (handles F5 refresh)
        async function initializeAdminPanel() {
            try {
                // Show authentication check screen
                document.getElementById('admin-auth-check').style.display = 'block';
                document.getElementById('admin-panel-content').style.display = 'none';
                
                // Attempt auto-authentication
                const authResult = await autoAuthenticateAdmin();
                
                if (authResult.success) {
                    // Authentication successful, show admin panel content
                    document.getElementById('admin-auth-check').style.display = 'none';
                    document.getElementById('admin-panel-content').style.display = 'block';
                    
                    // Restore saved section or default to overview
                    console.log('Admin authenticated successfully');
                    const savedAdminSection = localStorage.getItem('activeAdminSection') || 'overview';
                    showAdminSection(savedAdminSection, false);
                } else {
                    // Authentication failed - show error message in the auth check screen
                    document.getElementById('admin-auth-check').innerHTML = `
                        <div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 2rem; max-width: 500px; margin: 0 auto;">
                            <i class="fas fa-exclamation-triangle fa-3x" style="color: #ff6b6b; margin-bottom: 1rem;"></i>
                            <h3>Access Denied</h3>
                            <p style="color: #ccc; margin-bottom: 1.5rem;">You need to be logged in as an admin user to access this panel.</p>
                            <div style="display: flex; gap: 1rem; justify-content: center;">
                                <a href="/auth.php" style="background: var(--primary-color); color: white; padding: 0.75rem 1.5rem; border-radius: 5px; text-decoration: none; font-weight: bold;">
                                    <i class="fas fa-sign-in-alt"></i> Login
                                </a>
                                <button onclick="showTab('rizon')" style="background: rgba(255,255,255,0.1); color: white; padding: 0.75rem 1.5rem; border: 1px solid rgba(255,255,255,0.3); border-radius: 5px; cursor: pointer;">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error initializing admin panel:', error);
                // Fallback to show alert and redirect
                alert('Admin panel access error. Please log in as an admin user.');
                showTab('rizon');
            }
        }

        // Try to automatically authenticate website admin to admin panel
        async function autoAuthenticateAdmin() {
            try {
                const response = await fetch('admin_bridge.php', {
                    method: 'POST',
                    credentials: 'same-origin'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    return result;
                } else {
                    return { success: false, message: 'Auto-authentication failed' };
                }
            } catch (error) {
                console.error('Auto-auth error:', error);
                return { success: false, message: 'Auto-authentication error' };
            }
        }

        // Admin section navigation
        function showAdminSection(sectionId, saveToStorage = true) {
            // Preserve current scroll position
            const currentScrollY = window.scrollY;
            
            // Create a more robust scroll restoration system
            let restoreAttempts = 0;
            const maxAttempts = 10;
            const restoreInterval = setInterval(() => {
                if (restoreAttempts >= maxAttempts) {
                    clearInterval(restoreInterval);
                    return;
                }
                window.scrollTo(0, currentScrollY);
                restoreAttempts++;
            }, 50);
            
            // Initialize status monitoring on first admin panel access
            if (!window.statusMonitoringInitialized) {
                setupStatusEventListeners();
                window.statusMonitoringInitialized = true;
            }
            
            // Initialize security monitoring if security monitor section is opened
            if (sectionId === 'security-monitor' && !window.securityMonitoringInitialized) {
                initializeSecurityMonitoring();
                window.securityMonitoringInitialized = true;
            }
            
            // Save current admin section to localStorage
            if (saveToStorage) {
                localStorage.setItem('activeAdminSection', sectionId);
            }
            
            // Hide all admin sections
            document.querySelectorAll('.admin-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all admin nav tabs
            document.querySelectorAll('.admin-nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected section
            const targetSection = document.getElementById('admin-' + sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Activate corresponding tab
            const targetTab = document.querySelector(`[onclick="showAdminSection('${sectionId}')"]`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            // Load section-specific data
            loadAdminSectionData(sectionId);
            
            // Stop the scroll restoration after enough time has passed
            setTimeout(() => {
                clearInterval(restoreInterval);
            }, 1000);
        }

        function loadAdminSectionData(sectionId) {
            // Close any active log streams when switching sections
            if (activeLogStream) {
                clearInterval(activeLogStream);
                activeLogStream = null;
            }
            
            // Sync status interval removed - no longer needed
            
            switch(sectionId) {
                case 'overview':
                    loadAdminOverview();
                    break;
                case 'breakout':
                    loadHighScores();
                    break;
                case 'bot-status':
                    loadBotStatus();
                    break;
                case 'bot-control':
                    loadBotControlStatus();
                    break;
                case 'user-management':
                    loadWebsiteUsers();
                    loadUserStats();
                    break;
                case 'logs':
                    loadSystemMonitoring();
                    // Auto-load last selected bot logs or default to Rizon
                    setTimeout(() => {
                        autoLoadLastSelectedBotLogs();
                    }, 500);
                    // Sync status functions removed - bot now writes directly to centralized location
                    break;
                case 'database':
                    loadDatabaseStatus();
                    break;
                case 'settings':
                    loadBotConfig();
                    break;
            }
        }

        // Admin API helper function - with automatic authentication
        async function adminApiCall(action, data = null) {
            // Admin API calls disabled - admin panel has been removed
            console.warn(`Admin API call attempted but disabled: ${action}`);
            return { success: false, message: 'Admin panel has been removed' };
            
            /* Original code disabled
            try {
                console.log(`Making admin API call: ${action}`, data);
                
                // Get CSRF token
                await getCSRFToken();
                
                // Prepare request body with CSRF token for secure admin proxy
                const requestBody = addCSRFToken({
                    op: action,
                    ...data
                });
                
                const options = {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'same-origin',
                    body: JSON.stringify(requestBody)
                };
                
                const url = `/api/secure/admin-proxy.php`;
                console.log(`Admin API URL: ${url}`);
                const response = await fetch(url, options);
                console.log(`Admin API response status: ${response.status}`);
                
                if (!response.ok) {
                    console.error(`Admin API response not ok: ${response.status} ${response.statusText}`);
                }
                
                if (!response.ok) {
                    if (response.status === 401) {
                        return { error: 'Admin authentication required. Please <a href="/auth.php" style="color: var(--primary-color);">log in as an admin user</a> to access admin functions.' };
                    }
                    const responseText = await response.text();
                    throw new Error(`HTTP error! status: ${response.status} - ${responseText}`);
                }
                
                const result = await response.json();
                console.log(`Admin API result for ${action}:`, result);
                return result;
            } catch (error) {
                console.error('Admin API call failed:', error);
                return { error: 'API call failed: ' + error.message };
            }
            */
        }

        // Admin Overview Functions
        async function loadAdminOverview() {
            loadBotStatusOverview();
            loadBreakoutStatsOverview();
            loadPigsStatsOverview();
            loadRecentActivity();
            loadSystemHealth();
        }

        async function loadBotStatusOverview() {
            const statusDiv = document.getElementById('bot-status-overview');
            statusDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            
            try {
                if (!window.BotStatusManager || !window.BotStatusManager.getStatus) {
                    throw new Error('BotStatusManager not available');
                }
                const status = await BotStatusManager.getStatus();
                const rizonStatus = status.networks.rizon;
                const liberaStatus = status.networks.libera;
                
                statusDiv.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div style="padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-md); border: 1px solid var(--border-light);">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <span style="font-size: 1.2rem;">${rizonStatus.status_icon}</span>
                                <strong>Rizon Bot</strong>
                            </div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary);">
                                Status: <span style="color: ${rizonStatus.status_color}; font-weight: 500;">${rizonStatus.status_text}</span><br>
                                Uptime: ${rizonStatus.uptime || 'N/A'}<br>
                                ${rizonStatus.pid ? `PID: ${rizonStatus.pid}<br>` : ''}
                                ${rizonStatus.last_activity ? `Last Activity: ${rizonStatus.last_activity.human}` : ''}
                            </div>
                        </div>
                        <div style="padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-md); border: 1px solid var(--border-light);">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <span style="font-size: 1.2rem;">${liberaStatus.status_icon}</span>
                                <strong>Libera Bot</strong>
                            </div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary);">
                                Status: <span style="color: ${liberaStatus.status_color}; font-weight: 500;">${liberaStatus.status_text}</span><br>
                                Uptime: ${liberaStatus.uptime || 'N/A'}<br>
                                ${liberaStatus.pid ? `PID: ${liberaStatus.pid}<br>` : ''}
                                ${liberaStatus.last_activity ? `Last Activity: ${liberaStatus.last_activity.human}` : ''}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Overall Status Summary -->
                    <div style="margin-top: 1rem; padding: 0.75rem; background: var(--accent-blue); border-radius: var(--radius-md); border: 1px solid var(--border-light); text-align: center;">
                        <div style="font-weight: 600; color: ${status.overall.status_color};">
                            ${status.overall.status_text} (${status.overall.bots_online}/${status.overall.total_bots})
                        </div>
                        ${status.system.screen_sessions.length > 0 ? 
                            `<div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.25rem;">
                                Screen Sessions: ${status.system.screen_sessions.map(s => s.name).join(', ')}
                            </div>` : ''
                        }
                    </div>
                `;
            } catch (error) {
                console.error('Error loading bot status overview:', error);
                // Fallback to public API
                try {
                    const response = await fetch('public_bot_status.php?action=bot_status');
                    const result = await response.json();
                    if (result.error) {
                        statusDiv.innerHTML = `<div style="color: #dc2626; font-weight: 500;">Error: ${result.error}</div>`;
                    } else {
                        const networks = result.networks || {};
                        statusDiv.innerHTML = `
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                ${Object.entries(networks).map(([network, status]) => `
                                    <div style="padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-md); border: 1px solid var(--border-light);">
                                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                            <span style="font-size: 1.2rem;">${status.online ? '🟢' : '🔴'}</span>
                                            <strong>${network.charAt(0).toUpperCase() + network.slice(1)} Bot</strong>
                                        </div>
                                        <div style="font-size: 0.875rem; color: var(--text-secondary);">
                                            Status: <span style="color: ${status.online ? '#059669' : '#dc2626'}; font-weight: 500;">${status.online ? 'Online' : 'Offline'}</span><br>
                                            ${status.uptime ? `Uptime: ${status.uptime}<br>` : ''}
                                            ${status.channels ? `Channels: ${status.channels.length}<br>` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    }
                } catch (fallbackError) {
                    statusDiv.innerHTML = `<div style="color: #dc2626; font-weight: 500;">Error loading bot status: ${error.message}</div>`;
                }
            }
        }

        async function loadBreakoutStatsOverview() {
            const statsDiv = document.getElementById('breakout-stats-overview');
            statsDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            
            try {
                const result = await adminApiCall('breakout_stats');
                if (result.error) {
                    statsDiv.innerHTML = `<p style="color: #dc2626;">Error: ${result.error}</p>`;
                } else {
                    statsDiv.innerHTML = `
                    <div style="display: grid; gap: 0.5rem;">
                        <div><strong>Total Scores:</strong> ${result.total_scores || 0}</div>
                        <div><strong>High Score:</strong> ${result.top_score || 0}</div>
                        <div><strong>Unique Players:</strong> ${result.unique_players || 0}</div>
                        <div><strong>Today's Games:</strong> ${result.today_games || 0}</div>
                    </div>
                `;
                }
            } catch (error) {
                console.error('Error loading breakout stats:', error);
                statsDiv.innerHTML = `<p style="color: #dc2626;">Error loading stats: ${error.message}</p>`;
            }
        }

        async function loadPigsStatsOverview() {
            const statsDiv = document.getElementById('pigs-stats-overview');
            statsDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            
            // Temporary: use public endpoint until admin API auth is fixed
            const response = await fetch('public_bot_status.php?action=pigs_stats');
            const result = await response.json();
            if (result.error) {
                statsDiv.innerHTML = `<p style="color: #dc2626;">Error: ${result.error}</p>`;
            } else {
                const rizonStats = result.rizon || {};
                const liberaStats = result.libera || {};
                const totalPlayers = (rizonStats.total_players || 0) + (liberaStats.total_players || 0);
                const totalGames = (rizonStats.total_games || 0) + (liberaStats.total_games || 0);
                const highestScore = Math.max(rizonStats.highest_score || 0, liberaStats.highest_score || 0);
                const totalPigOuts = (rizonStats.total_pig_outs || 0) + (liberaStats.total_pig_outs || 0);
                
                statsDiv.innerHTML = `
                    <div style="display: grid; gap: 0.5rem;">
                        <div><strong>Total Players:</strong> ${totalPlayers}</div>
                        <div><strong>Total Games:</strong> ${totalGames}</div>
                        <div><strong>Highest Score:</strong> ${highestScore}</div>
                        <div><strong>Total Pig Outs:</strong> ${totalPigOuts}</div>
                        <div style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid var(--border-light); font-size: 0.875rem; color: var(--text-muted);">
                            <div>Rizon: ${rizonStats.total_players || 0} players, ${rizonStats.total_games || 0} games</div>
                            <div>Libera: ${liberaStats.total_players || 0} players, ${liberaStats.total_games || 0} games</div>
                        </div>
                    </div>
                `;
            }
        }

        async function loadRecentActivity() {
            const activityDiv = document.getElementById('recent-activity');
            activityDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            
            // Show recent activity based on bot status and logs
            const response = await fetch('public_bot_status.php?action=bot_status');
            const botStatus = await response.json();
            
            let activities = [];
            if (botStatus && !botStatus.error) {
                Object.entries(botStatus.networks || {}).forEach(([network, status]) => {
                    if (status.online) {
                        activities.push({
                            type: 'Bot Status',
                            description: `${network.charAt(0).toUpperCase() + network.slice(1)} bot is online`,
                            time: 'Current',
                            color: '#059669'
                        });
                    } else {
                        activities.push({
                            type: 'Bot Status',
                            description: `${network.charAt(0).toUpperCase() + network.slice(1)} bot is offline`,
                            time: 'Current',
                            color: '#dc2626'
                        });
                    }
                });
            }
            
            // Add some sample activities
            activities.push({
                type: 'System',
                description: 'Admin panel accessed',
                time: new Date().toLocaleTimeString(),
                color: '#3b82f6'
            });
            
            activityDiv.innerHTML = `
                <div style="display: grid; gap: 0.5rem; font-size: 0.875rem;">
                    ${activities.map(activity => `
                        <div style="padding: 0.5rem; background: var(--bg-secondary); border-radius: var(--radius-sm); border-left: 3px solid ${activity.color || '#666'};">
                            <strong>${activity.type}:</strong> ${activity.description}
                            <div style="color: var(--text-secondary); font-size: 0.75rem;">${activity.time}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        async function loadSystemHealth() {
            const healthDiv = document.getElementById('system-health');
            if (!healthDiv) {
                console.error('system-health div not found');
                return;
            }
            
            healthDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            
            try {
                // Temporary: use public endpoint until admin API auth is fixed
                const response = await fetch('public_bot_status.php?action=system_health');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const result = await response.json();
            if (result.error) {
                healthDiv.innerHTML = `<p style="color: #dc2626;">Error: ${result.error}</p>`;
            } else {
                const metrics = result.metrics || {};
                const breakdown = result.health_breakdown || {};
                
                let breakdownHtml = '';
                if (breakdown && Object.keys(breakdown).length > 0) {
                    breakdownHtml = '<div style="margin-top: 1rem;"><h4 style="margin: 0 0 0.5rem 0; color: var(--text-primary);">Health Score Breakdown:</h4>';
                    
                    Object.entries(breakdown).forEach(([key, category]) => {
                        const percentage = category.max_points > 0 ? Math.round((category.earned_points / category.max_points) * 100) : 0;
                        const barColor = percentage >= 70 ? '#059669' : percentage >= 50 ? '#f59e0b' : '#dc2626';
                        
                        breakdownHtml += `
                            <div style="margin-bottom: 0.75rem; padding: 0.5rem; background: var(--bg-secondary); border-radius: var(--radius-md);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem;">
                                    <span style="font-weight: 500;">${category.category}</span>
                                    <span style="color: ${barColor}; font-weight: bold;">${category.earned_points}/${category.max_points} pts</span>
                                </div>
                                <div style="background: var(--border-light); height: 6px; border-radius: 3px; overflow: hidden;">
                                    <div style="background: ${barColor}; height: 100%; width: ${percentage}%; transition: width 0.3s ease;"></div>
                                </div>`;
                        
                        // Show details for each category
                        if (category.details) {
                            Object.entries(category.details).forEach(([detailKey, detail]) => {
                                let statusColor = '#666';
                                if (detail.status) {
                                    if (detail.status.includes('Online') || detail.status.includes('Active') || detail.status.includes('Healthy') || detail.status.includes('Normal')) {
                                        statusColor = '#059669';
                                    } else if (detail.status.includes('High') || detail.status.includes('Moderate') || detail.status.includes('Warning')) {
                                        statusColor = '#f59e0b';
                                    } else {
                                        statusColor = '#dc2626';
                                    }
                                }
                                
                                const extraInfo = detail.usage ? ` (${detail.usage})` : detail.value !== undefined ? ` (${detail.value})` : '';
                                breakdownHtml += `
                                    <div style="font-size: 0.875rem; color: var(--text-secondary); margin-left: 0.5rem; margin-top: 0.25rem;">
                                        ${detailKey.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}: 
                                        <span style="color: ${statusColor};">${detail.status}${extraInfo}</span>
                                        <span style="color: #666;"> (${detail.points}/${detail.max} pts)</span>
                                    </div>`;
                            });
                        }
                        
                        breakdownHtml += '</div>';
                    });
                    
                    breakdownHtml += '</div>';
                }
                
                healthDiv.innerHTML = `
                    <div style="display: grid; gap: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span><strong>Overall Health Score:</strong></span>
                            <span style="color: ${result.status_color || '#666'}; font-size: 1.25rem; font-weight: bold;">${result.health_score || 0}%</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span><strong>Status:</strong></span>
                            <span style="color: ${result.status_color || '#666'};">${result.status_icon || ''} ${result.status || 'Unknown'}</span>
                        </div>
                        <div style="background: var(--border-light); height: 8px; border-radius: 4px; overflow: hidden; margin: 0.5rem 0;">
                            <div style="background: ${result.status_color || '#666'}; height: 100%; width: ${result.health_score || 0}%; transition: width 0.5s ease;"></div>
                        </div>
                        ${breakdownHtml}
                    </div>
                `;
                }
            } catch (error) {
                console.error('System health load error:', error);
                healthDiv.innerHTML = `<p style="color: #dc2626;">Failed to load system health: ${error.message}</p>`;
            }
        }

        // Bot Management Functions
        async function startBot() {
            const result = await adminApiCall('start_bot');
            if (result.error) {
                alert('Error starting bot: ' + result.error);
            } else {
                alert('Bot start command sent successfully');
                loadBotStatus();
            }
        }

        async function restartBot() {
            const result = await adminApiCall('restart_bot');
            if (result.error) {
                alert('Error restarting bot: ' + result.error);
            } else {
                alert('Bot restart command sent successfully');
                loadBotStatus();
            }
        }

        async function stopBot() {
            const result = await adminApiCall('stop_bot');
            if (result.error) {
                alert('Error stopping bot: ' + result.error);
            } else {
                alert('Bot stop command sent successfully');
                loadBotStatus();
            }
        }

        let selectedChannel = '#8BitVape'; // Default channel
        let selectedNetwork = 'rizon'; // Default network
        
        function selectNetwork(network) {
            selectedNetwork = network;
            
            // Update visual selection state for network buttons
            document.querySelectorAll('.network-btn').forEach(btn => {
                if (btn.dataset.network === network) {
                    btn.style.background = 'var(--primary-color)';
                    btn.style.color = 'white';
                    btn.style.borderColor = 'var(--primary-color)';
                } else {
                    btn.style.background = 'var(--bg-secondary)';
                    btn.style.color = 'var(--text-secondary)';
                    btn.style.borderColor = 'var(--border-light)';
                }
            });
            
            // Filter channels based on network selection
            filterChannelsByNetwork(network);
            
            // Update preview
            updateCommandPreview();
        }
        
        function filterChannelsByNetwork(network) {
            document.querySelectorAll('.channel-btn').forEach(btn => {
                const channelNetwork = btn.dataset.network;
                if (network === 'both' || channelNetwork === network) {
                    btn.style.display = 'inline-block';
                } else {
                    btn.style.display = 'none';
                }
            });
            
            // Auto-select appropriate default channel based on network
            if (network === 'rizon') {
                selectChannel('#8BitVape');
            } else if (network === 'libera') {
                selectChannel('#bakedbeans');
            } else if (network === 'both') {
                selectChannel('#8BitVape'); // Default to Rizon channel
            }
        }
        
        function selectChannel(channel) {
            selectedChannel = channel;
            
            // Update visual selection state
            document.querySelectorAll('.channel-btn').forEach(btn => {
                if (btn.dataset.channel === channel) {
                    btn.style.background = 'var(--primary-color)';
                    btn.style.color = 'white';
                    btn.style.borderColor = 'var(--primary-color)';
                } else {
                    btn.style.background = 'var(--bg-secondary)';
                    btn.style.color = 'var(--text-secondary)';
                    btn.style.borderColor = 'var(--border-light)';
                }
            });
            
            // Update preview
            updateCommandPreview();
        }
        
        function updateCommandPreview() {
            const input = document.getElementById('manual-command');
            const preview = document.getElementById('command-preview');
            if (!input || !preview) return; // Elements don't exist yet
            
            let message;
            try {
                message = input.value.trim();
            } catch (e) {
                console.warn('Error accessing input.value:', e);
                return;
            }
            
            const networkText = selectedNetwork === 'both' ? 'Both networks' : 
                               selectedNetwork === 'rizon' ? '🔴 Rizon' : '🔵 Libera';
            
            if (message) {
                // Check if it's already a raw IRC command (starts with uppercase command)
                if (/^[A-Z]+\s/.test(message)) {
                    preview.textContent = `[${networkText}] Raw command: ${message}`;
                } else {
                    preview.textContent = `[${networkText}] PRIVMSG ${selectedChannel} :${message}`;
                }
            } else {
                preview.textContent = `[${networkText}] Will send: PRIVMSG ${selectedChannel} :your message here`;
            }
        }

        async function sendManualCommand() {
            console.log('sendManualCommand called');
            const input = document.getElementById('manual-command');
            const message = input.value.trim();
            console.log('Message:', message);
            if (!message) {
                alert('Please enter a message');
                return;
            }
            
            let command;
            // Check if it's already a raw IRC command (starts with uppercase command)
            if (/^[A-Z]+\s/.test(message)) {
                command = message;
            } else {
                command = `PRIVMSG ${selectedChannel} :${message}`;
            }
            
            console.log('Sending command:', command, 'to network:', selectedNetwork);
            const result = await adminApiCall('send_command', { command, network: selectedNetwork });
            console.log('Send command result:', result);
            if (result.error) {
                alert('Error sending command: ' + result.error);
            } else {
                alert('Command sent successfully');
                input.value = '';
                updateCommandPreview();
            }
        }

        // Logs section manual commands - separate state variables
        let logsSelectedChannel = '#8BitVape'; // Default channel for logs section
        let logsSelectedNetwork = 'rizon'; // Default network for logs section
        
        function selectLogsNetwork(network) {
            logsSelectedNetwork = network;
            
            // Update visual selection state for logs network buttons
            document.querySelectorAll('.logs-network-btn').forEach(btn => {
                if (btn.getAttribute('data-network') === network) {
                    btn.style.background = 'var(--primary-color)';
                    btn.style.color = '#fff';
                    btn.style.borderColor = 'var(--primary-color)';
                } else {
                    btn.style.background = 'var(--bg-secondary)';
                    btn.style.color = 'var(--text-secondary)';
                    btn.style.borderColor = 'var(--border-light)';
                }
            });
            
            // Filter channels based on network selection
            filterLogsChannelsByNetwork(network);
            
            // Update preview
            updateLogsCommandPreview();
        }
        
        function filterLogsChannelsByNetwork(network) {
            document.querySelectorAll('.logs-channel-btn').forEach(btn => {
                const channelNetwork = btn.dataset.network;
                if (network === 'both' || channelNetwork === network) {
                    btn.style.display = 'inline-block';
                } else {
                    btn.style.display = 'none';
                }
            });
            
            // Clear selected channel if it's no longer visible
            if (logsSelectedChannel) {
                const selectedChannelBtn = document.querySelector(`.logs-channel-btn[data-channel="${logsSelectedChannel}"]`);
                if (selectedChannelBtn && selectedChannelBtn.style.display === 'none') {
                    logsSelectedChannel = '';
                    updateLogsCommandPreview();
                }
            }
        }
        
        function selectLogsChannel(channel) {
            logsSelectedChannel = channel;
            
            // Update visual selection state for logs channel buttons
            document.querySelectorAll('.logs-channel-btn').forEach(btn => {
                if (btn.getAttribute('data-channel') === channel) {
                    btn.style.background = 'var(--primary-color)';
                    btn.style.color = '#fff';
                    btn.style.borderColor = 'var(--primary-color)';
                } else {
                    btn.style.background = 'var(--bg-secondary)';
                    btn.style.color = 'var(--text-secondary)';
                    btn.style.borderColor = 'var(--border-light)';
                }
            });
            
            // Update preview
            updateLogsCommandPreview();
        }
        
        function updateLogsCommandPreview() {
            const input = document.getElementById('logs-manual-command');
            const preview = document.getElementById('logs-command-preview');
            const message = input ? input.value.trim() : '';
            
            const networkText = logsSelectedNetwork === 'both' ? 'Both networks' : 
                               logsSelectedNetwork === 'rizon' ? '🔴 Rizon' : '🔵 Libera';
            
            if (message) {
                // Check if it's already a raw IRC command (starts with uppercase command)
                if (message.match(/^[A-Z]+\s/)) {
                    preview.textContent = `[${networkText}] Will send raw command: ${message}`;
                } else {
                    preview.textContent = `[${networkText}] Will send: PRIVMSG ${logsSelectedChannel} :${message}`;
                }
            } else {
                preview.textContent = `[${networkText}] Will send: PRIVMSG ${logsSelectedChannel} :your message here`;
            }
        }

        async function sendLogsManualCommand() {
            console.log('sendLogsManualCommand called');
            const input = document.getElementById('logs-manual-command');
            const message = input.value.trim();
            console.log('Logs message:', message);
            if (!message) {
                alert('Please enter a message');
                return;
            }
            
            let command;
            if (message.match(/^[A-Z]+\s/)) {
                // Already a raw IRC command
                command = message;
            } else {
                command = `PRIVMSG ${logsSelectedChannel} :${message}`;
            }
            
            console.log('Sending logs command:', command, 'to network:', logsSelectedNetwork);
            const result = await adminApiCall('send_command', { command, network: logsSelectedNetwork });
            console.log('Send logs command result:', result);
            if (result.error) {
                alert('Error sending command: ' + result.error);
            } else {
                alert('Command sent successfully');
                input.value = '';
                updateLogsCommandPreview();
            }
        }

        // Bot Control Status Loading
        async function loadBotControlStatus() {
            loadIndividualBotStatuses();
        }

        async function loadIndividualBotStatuses() {
            // Temporary: use public endpoint until admin API auth is fixed
            const response = await fetch('public_bot_status.php?action=bot_status');
            const result = await response.json();
            if (result.error) {
                document.getElementById('rizon-bot-status').innerHTML = `Status: <span style="color: #dc2626;">Error loading</span>`;
                document.getElementById('libera-bot-status').innerHTML = `Status: <span style="color: #dc2626;">Error loading</span>`;
            } else {
                const networks = result.networks || {};
                
                // Update Rizon status
                const rizonStatus = networks.rizon || {};
                const rizonStatusDiv = document.getElementById('rizon-bot-status');
                rizonStatusDiv.innerHTML = `
                    Status: <span style="color: ${rizonStatus.online ? '#059669' : '#dc2626'};">
                        ${rizonStatus.online ? 'Online' : 'Offline'}
                    </span>
                    ${rizonStatus.uptime ? ` • Uptime: ${rizonStatus.uptime}` : ''}
                    ${rizonStatus.pid ? ` • PID: ${rizonStatus.pid}` : ''}
                `;
                
                // Update Libera status
                const liberaStatus = networks.libera || {};
                const liberaStatusDiv = document.getElementById('libera-bot-status');
                liberaStatusDiv.innerHTML = `
                    Status: <span style="color: ${liberaStatus.online ? '#059669' : '#dc2626'};">
                        ${liberaStatus.online ? 'Online' : 'Offline'}
                    </span>
                    ${liberaStatus.uptime ? ` • Uptime: ${liberaStatus.uptime}` : ''}
                    ${liberaStatus.pid ? ` • PID: ${liberaStatus.pid}` : ''}
                `;
            }
        }

        // Individual Network Bot Control Functions
        async function startRizonBot() {
            const result = await adminApiCall('start_rizon');
            if (result.error) {
                alert('Error starting Rizon bot: ' + result.error);
            } else {
                alert(result.message || 'Rizon bot start initiated');
                setTimeout(loadIndividualBotStatuses, 3000);
            }
        }

        async function restartRizonBot() {
            console.log('Attempting to restart Rizon bot...');
            const result = await adminApiCall('restart_rizon');
            console.log('Rizon restart result:', result);
            
            if (result.error) {
                alert('Error restarting Rizon bot: ' + result.error);
                console.error('Rizon restart error:', result.error);
            } else {
                alert(result.message || 'Rizon bot restart initiated');
                if (result.output) {
                    console.log('Rizon restart output:', result.output);
                }
                setTimeout(loadIndividualBotStatuses, 5000); // Longer wait for restart
            }
        }

        async function stopRizonBot() {
            const result = await adminApiCall('stop_rizon');
            if (result.error) {
                alert('Error stopping Rizon bot: ' + result.error);
            } else {
                alert(result.message || 'Rizon bot stop initiated');
                setTimeout(loadIndividualBotStatuses, 2000);
            }
        }

        async function startLiberaBot() {
            const result = await adminApiCall('start_libera');
            if (result.error) {
                alert('Error starting Libera bot: ' + result.error);
            } else {
                alert(result.message || 'Libera bot start initiated');
                setTimeout(loadIndividualBotStatuses, 3000);
            }
        }

        async function restartLiberaBot() {
            console.log('Attempting to restart Libera bot...');
            const result = await adminApiCall('restart_libera');
            console.log('Libera restart result:', result);
            
            if (result.error) {
                alert('Error restarting Libera bot: ' + result.error);
                console.error('Libera restart error:', result.error);
            } else {
                alert(result.message || 'Libera bot restart initiated');
                if (result.output) {
                    console.log('Libera restart output:', result.output);
                }
                setTimeout(loadIndividualBotStatuses, 5000); // Longer wait for restart
            }
        }

        async function stopLiberaBot() {
            const result = await adminApiCall('stop_libera');
            if (result.error) {
                alert('Error stopping Libera bot: ' + result.error);
            } else {
                alert(result.message || 'Libera bot stop initiated');
                setTimeout(loadIndividualBotStatuses, 2000);
            }
        }

        // Game Management Functions
        async function loadHighScores() {
            const tableDiv = document.getElementById('high-scores-table');
            tableDiv.innerHTML = '<div style="text-align: center; padding: 2rem;"><i class="fas fa-spinner fa-spin"></i> Loading high scores...</div>';
            
            const result = await adminApiCall('get_high_scores');
            if (result.error) {
                tableDiv.innerHTML = `<p style="color: #dc2626;">Error loading scores: ${result.error}</p>`;
            } else {
                displayHighScoresTable(result || []);
            }
        }

        function displayHighScoresTable(scores) {
            const tableDiv = document.getElementById('high-scores-table');
            
            if (scores.length === 0) {
                tableDiv.innerHTML = '<p style="color: var(--text-secondary);">No high scores found</p>';
                return;
            }
            
            const table = document.createElement('table');
            table.className = 'admin-table';
            table.style.width = '100%';
            
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Player</th>
                        <th>Score</th>
                        <th>Level</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    ${scores.map((score, index) => `
                        <tr>
                            <td><strong>#${index + 1}</strong></td>
                            <td>${escapeHtml(score.player_name)}</td>
                            <td>${score.score.toLocaleString()}</td>
                            <td>${score.level_reached || 1}</td>
                            <td>${formatDate(score.date_played)}</td>
                            <td>
                                <button class="auth-button" onclick="deleteScore(${score.id})" style="background: #dc2626; padding: 0.25rem 0.5rem; font-size: 0.75rem;">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            `;
            
            tableDiv.innerHTML = '<h4 style="margin-bottom: 1rem; color: var(--text-primary);">High Scores</h4>';
            tableDiv.appendChild(table);
        }

        async function resetAllScores() {
            if (!confirm('Are you sure you want to reset ALL high scores? This action cannot be undone!')) return;
            
            const result = await adminApiCall('reset_scores');
            if (result.error) {
                alert('Error resetting scores: ' + result.error);
            } else {
                alert('All scores have been reset successfully');
                loadHighScores();
            }
        }

        async function banPlayer() {
            const playerName = document.getElementById('ban-player-name').value.trim();
            if (!playerName) {
                alert('Please enter a player name');
                return;
            }
            
            if (!confirm(`Ban player "${playerName}"? This will remove all their scores.`)) return;
            
            const result = await adminApiCall('ban_player', { player_name: playerName });
            if (result.error) {
                alert('Error banning player: ' + result.error);
            } else {
                alert(`Player "${playerName}" has been banned successfully`);
                document.getElementById('ban-player-name').value = '';
                loadHighScores();
            }
        }

        // Bot Status Section Functions
        async function loadBotStatus() {
            loadNetworkStatus();
            loadBotPerformance();
            loadCommandUsage();
            loadUptimeInfo();
        }

        async function loadNetworkStatus() {
            const statusDiv = document.getElementById('network-status');
            statusDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            
            // Temporary: use public endpoint until admin API auth is fixed
            const response = await fetch('public_bot_status.php?action=bot_status');
            const result = await response.json();
            if (result.error) {
                statusDiv.innerHTML = `<p style="color: #dc2626;">Error: ${result.error}</p>`;
            } else {
                const networks = result.networks || {};
                statusDiv.innerHTML = `
                    <div style="display: grid; gap: 1rem;">
                        ${Object.entries(networks).map(([network, status]) => `
                            <div style="border: 1px solid var(--border-light); padding: 1rem; border-radius: var(--radius-md);">
                                <h5 style="color: var(--primary-color); margin-bottom: 0.5rem;">${network.charAt(0).toUpperCase() + network.slice(1)} Network</h5>
                                <div><strong>Status:</strong> <span style="color: ${status.online ? '#059669' : '#dc2626'};">${status.online ? 'Online' : 'Offline'}</span></div>
                                <div><strong>PID:</strong> ${status.pid || 'N/A'}</div>
                                <div><strong>Method:</strong> ${status.method || 'Unknown'}</div>
                                <div><strong>Uptime:</strong> ${status.uptime || 'Unknown'}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        }

        async function loadBotPerformance() {
            const perfDiv = document.getElementById('bot-performance');
            perfDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            
            // Get both system health and bot status
            const [healthResponse, botResponse] = await Promise.all([
                fetch('public_bot_status.php?action=system_health'),
                fetch('public_bot_status.php?action=bot_status')
            ]);
            const healthResult = await healthResponse.json();
            const botResult = await botResponse.json();
            if (healthResult.error || botResult.error) {
                perfDiv.innerHTML = `<p style="color: #dc2626;">Error: ${healthResult.error || botResult.error}</p>`;
            } else {
                const load = healthResult.metrics?.load || {};
                const memory = healthResult.metrics?.memory || {};
                const networks = botResult.networks || {};
                
                perfDiv.innerHTML = `
                    <div style="display: grid; gap: 0.5rem;">
                        <div><strong>System Load:</strong> ${load['1min'] || 'Unknown'}</div>
                        <div><strong>Memory Usage:</strong> ${memory.usage_percent || 'Unknown'}%</div>
                        <div><strong>Bot Health Score:</strong> <span style="color: ${Object.values(networks).every(s => s.online) ? '#059669' : '#dc2626'};">${Object.values(networks).every(s => s.online) ? '100' : '50'}%</span></div>
                        <div><strong>Rizon Bot:</strong> <span style="color: ${networks.rizon?.online ? '#059669' : '#dc2626'};">${networks.rizon?.online ? 'Running' : 'Stopped'}</span></div>
                        <div><strong>Libera Bot:</strong> <span style="color: ${networks.libera?.online ? '#059669' : '#dc2626'};">${networks.libera?.online ? 'Running' : 'Stopped'}</span></div>
                    </div>
                `;
            }
        }

        async function loadCommandUsage() {
            const usageDiv = document.getElementById('command-usage');
            usageDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            
            // Temporary: use public endpoint until admin API auth is fixed
            const response = await fetch('public_bot_status.php?action=user_stats');
            const result = await response.json();
            if (result.error) {
                usageDiv.innerHTML = `<p style="color: #dc2626;">Error: ${result.error}</p>`;
            } else {
                let usageHtml = '<div style="display: grid; gap: 0.5rem;">';
                
                Object.entries(result).forEach(([network, stats]) => {
                    usageHtml += `
                        <div><strong>${network.charAt(0).toUpperCase() + network.slice(1)}:</strong></div>
                        <div style="margin-left: 1rem; font-size: 0.875rem;">
                            <div>UNO Players: ${stats.uno_players || 0}</div>
                            <div>UNO Games: ${stats.uno_games || 0}</div>
                        </div>
                    `;
                });
                
                usageHtml += '</div>';
                usageDiv.innerHTML = usageHtml || '<p style="color: var(--text-secondary);">No usage statistics available</p>';
            }
        }

        async function loadUptimeInfo() {
            const uptimeDiv = document.getElementById('uptime-info');
            uptimeDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            
            // Temporary: use public endpoint until admin API auth is fixed
            const response = await fetch('public_bot_status.php?action=bot_status');
            const result = await response.json();
            if (result.error) {
                uptimeDiv.innerHTML = `<p style="color: #dc2626;">Error: ${result.error}</p>`;
            } else {
                const networks = result.networks || {};
                uptimeDiv.innerHTML = `
                    <div style="display: grid; gap: 0.5rem;">
                        ${Object.entries(networks).map(([network, status]) => `
                            <div><strong>${network.charAt(0).toUpperCase() + network.slice(1)} Uptime:</strong> ${status.uptime || 'Unknown'}</div>
                        `).join('')}
                        <div><strong>Last Check:</strong> ${new Date().toLocaleTimeString()}</div>
                        <div><strong>Overall Status:</strong> <span style="color: ${Object.values(networks).every(status => status.online) ? '#059669' : '#dc2626'};">${Object.values(networks).every(status => status.online) ? 'Healthy' : 'Issues Detected'}</span></div>
                    </div>
                `;
            }
        }

        async function loadUserStats() {
            const statsDiv = document.getElementById('user-stats');
            statsDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading IRC user statistics...';
            
            const result = await adminApiCall('get_user_stats');
            if (result.error) {
                statsDiv.innerHTML = `<p style="color: #dc2626;">Error: ${result.error}</p>`;
            } else {
                let statsHtml = '<div style="display: grid; gap: 1rem;">';
                
                Object.entries(result).forEach(([network, stats]) => {
                    if (stats.week_stats) {
                        statsHtml += `
                            <div style="border: 1px solid var(--border-light); padding: 1rem; border-radius: var(--radius-md);">
                                <h5 style="color: var(--primary-color); margin-bottom: 0.5rem;">${network.toUpperCase()} Network</h5>
                                <div><strong>Unique Users (7 days):</strong> ${stats.week_stats.unique_users || 0}</div>
                                <div><strong>Total Commands (7 days):</strong> ${stats.week_stats.total_commands || 0}</div>
                                ${stats.top_users && stats.top_users.length > 0 ? `
                                    <div style="margin-top: 0.5rem;"><strong>Top Users:</strong></div>
                                    <div style="font-size: 0.875rem; color: var(--text-secondary);">
                                        ${stats.top_users.slice(0, 3).map(user => `${user.user}: ${user.command_count} commands`).join('<br>')}
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    }
                });
                
                statsHtml += '</div>';
                statsDiv.innerHTML = statsHtml || '<p style="color: var(--text-secondary);">No statistics available</p>';
            }
        }

        async function addTrustedUser() {
            const hostmask = document.getElementById('new-admin').value.trim();
            if (!hostmask) {
                alert('Please enter a username!hostmask');
                return;
            }
            
            if (!confirm(`Add trusted user: ${hostmask}`)) return;
            
            alert('Trusted user functionality would be implemented here');
            document.getElementById('new-admin').value = '';
        }

        async function loadSystemMonitoring() {
            const monitoringDiv = document.getElementById('system-monitoring');
            monitoringDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading system monitoring...';
            
            setTimeout(() => {
                monitoringDiv.innerHTML = `
                    <div style="display: grid; gap: 0.5rem;">
                        <div><strong>Bot Processes:</strong> 2 running</div>
                        <div><strong>Last Restart:</strong> 2 hours ago</div>
                        <div><strong>Error Count:</strong> 0 today</div>
                    </div>
                `;
            }, 1000);
        }

        // Database sync status function removed - no longer needed

        // Log sync status function removed - no longer needed

        // Real implementations for admin features
        async function resetLocalStorageScores() {
            if (!confirm('Reset localStorage scores for all users?')) return;
            
            const result = await adminApiCall('reset_local_scores');
            if (result.error) {
                alert('Error: ' + result.error);
            } else {
                alert(result.message || 'Local storage reset flag created');
            }
        }
        
        function viewLocalStorageScores() {
            // This shows current page's localStorage scores
            const scores = localStorage.getItem('breakoutHighScores');
            if (scores) {
                const parsedScores = JSON.parse(scores);
                alert('Local Scores:\n' + parsedScores.map((s, i) => `${i+1}. ${s.name}: ${s.score}`).join('\n'));
            } else {
                alert('No local scores found');
            }
        }
        
        // Real-time log streaming functionality
        let activeLogStream = null;
        
        // Auto-load last selected bot logs
        function autoLoadLastSelectedBotLogs() {
            try {
                const savedSelection = localStorage.getItem('lastSelectedBotLogs');
                if (savedSelection) {
                    const selection = JSON.parse(savedSelection);
                    // Auto-load the saved selection
                    showLiveLogViewer(selection.title, selection.network, selection.logType);
                } else {
                    // Default to Rizon Bot Logs for first-time visitors
                    loadRizonLogs();
                }
            } catch (error) {
                console.error('Error loading saved bot logs selection:', error);
                // Fallback to default
                loadRizonLogs();
            }
        }

        async function loadRizonLogs() {
            // Save selection to localStorage
            localStorage.setItem('lastSelectedBotLogs', JSON.stringify({
                network: 'rizon',
                logType: 'bot',
                title: 'Rizon Bot Logs'
            }));
            
            showLiveLogViewer('Rizon Bot Logs', 'rizon', 'bot');
        }
        
        async function loadRizonErrors() {
            // Save selection to localStorage
            localStorage.setItem('lastSelectedBotLogs', JSON.stringify({
                network: 'rizon',
                logType: 'errors',
                title: 'Rizon Error Logs'
            }));
            
            showLiveLogViewer('Rizon Error Logs', 'rizon', 'errors');
        }
        
        async function loadLiberaLogs() {
            // Save selection to localStorage
            localStorage.setItem('lastSelectedBotLogs', JSON.stringify({
                network: 'libera',
                logType: 'bot',
                title: 'Libera Bot Logs'
            }));
            
            showLiveLogViewer('Libera Bot Logs', 'libera', 'bot');
        }
        
        async function loadLiberaErrors() {
            // Save selection to localStorage
            localStorage.setItem('lastSelectedBotLogs', JSON.stringify({
                network: 'libera',
                logType: 'errors',
                title: 'Libera Error Logs'
            }));
            
            showLiveLogViewer('Libera Error Logs', 'libera', 'errors');
        }
        
        function showLogViewer(title, content) {
            const container = document.getElementById('log-viewer-container');
            // Create elements instead of using innerHTML to preserve angle brackets
            const wrapperDiv = document.createElement('div');
            wrapperDiv.style.cssText = 'background: var(--bg-primary); border: 1px solid var(--border-light); border-radius: var(--radius-lg); padding: 1.5rem; margin-top: 1rem;';
            
            const titleH4 = document.createElement('h4');
            titleH4.style.cssText = 'color: var(--text-primary); margin-bottom: 1rem;';
            titleH4.textContent = title;
            
            const contentDiv = document.createElement('div');
            contentDiv.style.cssText = 'background: #000; color: #00ff00; padding: 1rem; border-radius: var(--radius-md); font-family: "Courier New", monospace; font-size: 0.75rem; height: 400px; overflow-y: auto; white-space: pre-wrap;';
            contentDiv.textContent = content; // This preserves all characters including < and >
            
            wrapperDiv.appendChild(titleH4);
            wrapperDiv.appendChild(contentDiv);
            container.innerHTML = '';
            container.appendChild(wrapperDiv);
        }

        function showLiveLogViewer(title, network, logType) {
            console.log('showLiveLogViewer called with:', title, network, logType);
            
            // Close any existing stream
            if (activeLogStream) {
                clearInterval(activeLogStream);
                activeLogStream = null;
            }

            const container = document.getElementById('log-viewer-container');
            
            // Create main wrapper
            const wrapperDiv = document.createElement('div');
            wrapperDiv.style.cssText = 'background: var(--bg-primary); border: 1px solid var(--border-light); border-radius: var(--radius-lg); padding: 1.5rem; margin-top: 1rem;';
            
            // Create title with connection status
            const titleDiv = document.createElement('div');
            titleDiv.style.cssText = 'display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;';
            
            const titleH4 = document.createElement('h4');
            titleH4.style.cssText = 'color: var(--text-primary); margin: 0;';
            titleH4.textContent = title;
            
            const statusSpan = document.createElement('span');
            statusSpan.id = 'log-connection-status';
            statusSpan.style.cssText = 'font-size: 0.8rem; padding: 0.25rem 0.5rem; border-radius: 4px; background: #ffc107; color: #000;';
            statusSpan.textContent = 'Connecting...';
            
            titleDiv.appendChild(titleH4);
            titleDiv.appendChild(statusSpan);
            
            // Create log content area
            const contentDiv = document.createElement('div');
            contentDiv.id = 'live-log-content';
            contentDiv.style.cssText = 'background: #000; color: #00ff00; padding: 1rem; border-radius: var(--radius-md); font-family: "Courier New", monospace; font-size: 0.75rem; height: 400px; overflow-y: auto; white-space: pre-wrap; position: relative;';
            contentDiv.textContent = 'Connecting to live log stream...';
            
            // Create control buttons
            const controlsDiv = document.createElement('div');
            controlsDiv.style.cssText = 'margin-top: 1rem; display: flex; gap: 0.5rem;';
            
            const pauseBtn = document.createElement('button');
            pauseBtn.textContent = '⏸️ Pause';
            pauseBtn.style.cssText = 'padding: 0.5rem 1rem; background: var(--warning-color); color: white; border: none; border-radius: 4px; cursor: pointer;';
            pauseBtn.onclick = () => toggleLogStream(pauseBtn);
            
            const clearBtn = document.createElement('button');
            clearBtn.textContent = '🗑️ Clear';
            clearBtn.style.cssText = 'padding: 0.5rem 1rem; background: var(--danger-color); color: white; border: none; border-radius: 4px; cursor: pointer;';
            clearBtn.onclick = () => clearLogContent();
            
            const scrollBtn = document.createElement('button');
            scrollBtn.textContent = '⬇️ Auto-scroll: ON';
            scrollBtn.id = 'auto-scroll-btn';
            scrollBtn.style.cssText = 'padding: 0.5rem 1rem; background: var(--success-color); color: white; border: none; border-radius: 4px; cursor: pointer;';
            scrollBtn.onclick = () => toggleAutoScroll(scrollBtn);
            
            controlsDiv.appendChild(pauseBtn);
            controlsDiv.appendChild(clearBtn);
            controlsDiv.appendChild(scrollBtn);
            
            // Assemble the viewer
            wrapperDiv.appendChild(titleDiv);
            wrapperDiv.appendChild(contentDiv);
            wrapperDiv.appendChild(controlsDiv);
            container.innerHTML = '';
            container.appendChild(wrapperDiv);
            
            // Start the live stream
            console.log('Starting log stream for:', network, logType);
            startLogStream(network, logType);
        }

        let autoScroll = true;
        let streamPaused = false;

        function startLogStream(network, logType) {
            console.log('startLogStream function called with:', network, logType);
            const contentDiv = document.getElementById('live-log-content');
            const statusSpan = document.getElementById('log-connection-status');
            
            console.log('Elements found - contentDiv:', !!contentDiv, 'statusSpan:', !!statusSpan);
            if (!contentDiv || !statusSpan) {
                console.error('Required elements not found for live log stream');
                return;
            }
            
            let lastModified = 0;
            
            function pollForUpdates() {
                if (streamPaused) {
                    console.log('Stream is paused, skipping poll');
                    return;
                }
                
                console.log('Polling for updates...');
                const requestBody = {
                    op: 'get_live_logs',
                    network: network,
                    log_type: logType,
                    last_modified: lastModified
                };
                
                console.log('Making request with body:', requestBody);
                console.log('Fetch URL:', `/api/secure/admin-proxy.php`);
                console.log('Current page URL:', window.location.href);
                
                fetch(`/api/secure/admin-proxy.php`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(addCSRFToken({
                        op: requestBody.op,
                        ...requestBody
                    }))
                })
                .then(response => {
                    console.log('Response status:', response.status);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Live logs response:', data); // Debug output
                    console.log('Data type:', typeof data);
                    console.log('Data keys:', Object.keys(data));
                    if (data.success) {
                        if (data.content !== undefined) {
                            if (lastModified === 0) {
                                // Initial load - get last 50 lines
                                const lines = data.content.split('\\n');
                                const lastLines = lines.slice(-50).join('\\n');
                                contentDiv.textContent = lastLines;
                                lastModified = data.last_modified || Date.now();
                            } else if (data.has_new_content && data.content) {
                                // For simplicity, we'll show the last 50 lines on updates
                                // In production, you'd want to track position and only show new lines
                                const lines = data.content.split('\\n');
                                const lastLines = lines.slice(-50).join('\\n');
                                contentDiv.textContent = lastLines;
                                
                                // Visual indicator for new content
                                contentDiv.style.borderLeft = '3px solid #00ff00';
                                setTimeout(() => {
                                    contentDiv.style.borderLeft = 'none';
                                }, 500);
                                
                                lastModified = data.last_modified || Date.now();
                            }
                            
                            if (autoScroll) {
                                contentDiv.scrollTop = contentDiv.scrollHeight;
                            }
                        }
                        
                        statusSpan.textContent = 'Connected';
                        statusSpan.style.background = '#28a745';
                        statusSpan.style.color = '#fff';
                    } else {
                        statusSpan.textContent = 'Error';
                        statusSpan.style.background = '#dc3545';
                        statusSpan.style.color = '#fff';
                    }
                })
                .catch(error => {
                    console.error('Poll error:', error);
                    console.error('Request failed for:', { network, logType, lastModified });
                    console.error('Error details:', error.message, error.stack);
                    
                    statusSpan.textContent = 'Connection Error';
                    statusSpan.style.background = '#dc3545';
                    statusSpan.style.color = '#fff';
                });
            }
            
            // Initial poll
            pollForUpdates();
            
            // Set up polling interval (2 seconds to reduce load while debugging)
            activeLogStream = setInterval(pollForUpdates, 2000);
            
            statusSpan.textContent = 'Connecting...';
            statusSpan.style.background = '#ffc107';
            statusSpan.style.color = '#000';
        }

        function toggleLogStream(button) {
            streamPaused = !streamPaused;
            if (streamPaused) {
                button.textContent = '▶️ Resume';
                button.style.background = 'var(--success-color)';
                document.getElementById('log-connection-status').textContent = 'Paused';
                document.getElementById('log-connection-status').style.background = '#ffc107';
                document.getElementById('log-connection-status').style.color = '#000';
            } else {
                button.textContent = '⏸️ Pause';
                button.style.background = 'var(--warning-color)';
                document.getElementById('log-connection-status').textContent = 'Connected';
                document.getElementById('log-connection-status').style.background = '#28a745';
                document.getElementById('log-connection-status').style.color = '#fff';
            }
        }

        function clearLogContent() {
            const contentDiv = document.getElementById('live-log-content');
            if (contentDiv) {
                contentDiv.textContent = '[Log cleared by user]\\n';
            }
        }

        function toggleAutoScroll(button) {
            autoScroll = !autoScroll;
            if (autoScroll) {
                button.textContent = '⬇️ Auto-scroll: ON';
                button.style.background = 'var(--success-color)';
                // Scroll to bottom immediately
                const contentDiv = document.getElementById('live-log-content');
                if (contentDiv) {
                    contentDiv.scrollTop = contentDiv.scrollHeight;
                }
            } else {
                button.textContent = '⬇️ Auto-scroll: OFF';
                button.style.background = 'var(--secondary-color)';
            }
        }

        // Clean up stream when leaving page or switching sections
        window.addEventListener('beforeunload', function() {
            if (activeLogStream) {
                clearInterval(activeLogStream);
            }
        });
        
        async function backupDatabase() {
            if (!confirm('Create a backup of the database?')) return;
            
            const result = await adminApiCall('backup_database');
            if (result.error) {
                alert('Error creating backup: ' + result.error);
            } else {
                alert(result.message || 'Backup created successfully');
            }
        }
        
        async function optimizeDatabase() {
            if (!confirm('Optimize and clean up databases?')) return;
            
            const result = await adminApiCall('cleanup_database');
            if (result.error) {
                alert('Error optimizing database: ' + result.error);
            } else {
                alert('Database optimization completed:\n' + Object.values(result.details || {}).join('\n'));
            }
        }
        
        async function viewDatabaseStats() {
            const result = await adminApiCall('get_user_stats');
            if (result.error) {
                alert('Error getting database stats: ' + result.error);
            } else {
                let statsText = 'Database Statistics:\n\n';
                Object.entries(result).forEach(([network, stats]) => {
                    if (stats.week_stats) {
                        statsText += `${network.toUpperCase()}:\n`;
                        statsText += `- Unique users (7 days): ${stats.week_stats.unique_users}\n`;
                        statsText += `- Total commands (7 days): ${stats.week_stats.total_commands}\n\n`;
                    }
                });
                alert(statsText || 'No statistics available');
            }
        }
        
        // Bot Configuration Functions
        async function loadBotConfig() {
            try {
                const response = await fetch('/api/bot_config.php');
                const data = await response.json();
                
                if (data.status === 'success') {
                    // Populate Rizon settings (preserve existing user input)
                    if (data.config.rizon) {
                        const rizonConfig = data.config.rizon;
                        
                        // Only load from database if fields are empty (preserve user input)
                        const rateMessagesField = document.getElementById('rizon-rate-messages');
                        if (!rateMessagesField.value) {
                            rateMessagesField.value = rizonConfig.rate_limit_messages?.value || 4;
                        }
                        
                        const ratePeriodField = document.getElementById('rizon-rate-period');
                        if (!ratePeriodField.value) {
                            ratePeriodField.value = rizonConfig.rate_limit_period?.value || 8;
                        }
                        
                        const channelsField = document.getElementById('rizon-channels');
                        if (!channelsField.value) {
                            channelsField.value = Array.isArray(rizonConfig.channels?.value) 
                                ? rizonConfig.channels.value.join(',') : rizonConfig.channels?.value || '';
                        }
                        
                        const prefixField = document.getElementById('rizon-prefix');
                        if (!prefixField.value) {
                            prefixField.value = (rizonConfig.command_prefix?.value || '!').replace(/\\/g, '');
                        }
                    }
                    
                    // Populate Libera settings (preserve existing user input)
                    if (data.config.libera) {
                        const liberaConfig = data.config.libera;
                        
                        // Only load from database if fields are empty (preserve user input)
                        const rateMessagesField = document.getElementById('libera-rate-messages');
                        if (!rateMessagesField.value) {
                            rateMessagesField.value = liberaConfig.rate_limit_messages?.value || 4;
                        }
                        
                        const ratePeriodField = document.getElementById('libera-rate-period');
                        if (!ratePeriodField.value) {
                            ratePeriodField.value = liberaConfig.rate_limit_period?.value || 8;
                        }
                        
                        const channelsField = document.getElementById('libera-channels');
                        if (!channelsField.value) {
                            channelsField.value = Array.isArray(liberaConfig.channels?.value) 
                                ? liberaConfig.channels.value.join(',') : liberaConfig.channels?.value || '';
                        }
                        
                        const prefixField = document.getElementById('libera-prefix');
                        if (!prefixField.value) {
                            prefixField.value = liberaConfig.command_prefix?.value || '~';
                        }
                    }
                    
                    document.getElementById('config-status').textContent = 'Loaded';
                    document.getElementById('config-status').style.color = 'var(--accent-green)';
                } else {
                    console.error('Failed to load bot config:', data.message);
                    document.getElementById('config-status').textContent = 'Error loading';
                    document.getElementById('config-status').style.color = 'var(--accent-red)';
                }
                
                // Show content, hide loading
                document.getElementById('bot-config-loading').style.display = 'none';
                document.getElementById('bot-config-content').style.display = 'block';
                
            } catch (error) {
                console.error('Error loading bot configuration:', error);
                document.getElementById('config-status').textContent = 'Connection error';
                document.getElementById('config-status').style.color = 'var(--accent-red)';
                
                // Still show the form for manual entry
                document.getElementById('bot-config-loading').style.display = 'none';
                document.getElementById('bot-config-content').style.display = 'block';
            }
        }
        
        async function saveBotConfig(network, event) {
            try {
                const rateMessages = parseInt(document.getElementById(`${network}-rate-messages`).value) || 4;
                const ratePeriod = parseInt(document.getElementById(`${network}-rate-period`).value) || 8;
                const channels = document.getElementById(`${network}-channels`).value.split(',').map(ch => ch.trim()).filter(ch => ch.length > 0);
                const prefix = document.getElementById(`${network}-prefix`).value || (network === 'rizon' ? '!' : '~');
                
                const configData = {
                    rate_limit_messages: {
                        value: rateMessages,
                        type: 'int',
                        description: 'Maximum messages per rate limit period'
                    },
                    rate_limit_period: {
                        value: ratePeriod,
                        type: 'int',
                        description: 'Rate limit period in seconds'
                    },
                    channels: {
                        value: channels,
                        type: 'json',
                        description: 'Default channels to join'
                    },
                    command_prefix: {
                        value: prefix,
                        type: 'string',
                        description: 'Command prefix for this network'
                    }
                };
                
                const response = await fetch(`/api/bot_config.php?network=${network}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(configData)
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    document.getElementById('config-status').textContent = `${network.charAt(0).toUpperCase() + network.slice(1)} saved`;
                    document.getElementById('config-status').style.color = 'var(--accent-green)';
                    
                    // Show success message on the button if event is available
                    if (event && event.target) {
                        const button = event.target;
                        const originalText = button.innerHTML;
                        button.innerHTML = '<i class="fas fa-check"></i> Saved!';
                        button.style.background = 'var(--accent-green)';
                        
                        setTimeout(() => {
                            button.innerHTML = originalText;
                            button.style.background = '#059669';
                        }, 2000);
                    }
                    
                } else {
                    throw new Error(result.message || 'Failed to save configuration');
                }
                
            } catch (error) {
                console.error(`Error saving ${network} config:`, error);
                document.getElementById('config-status').textContent = 'Save failed';
                document.getElementById('config-status').style.color = 'var(--accent-red)';
                alert(`Error saving ${network} configuration: ${error.message}`);
            }
        }
        
        function refreshBotConfig() {
            document.getElementById('bot-config-content').style.display = 'none';
            document.getElementById('bot-config-loading').style.display = 'block';
            document.getElementById('config-status').textContent = 'Refreshing...';
            document.getElementById('config-status').style.color = 'var(--text-secondary)';
            
            loadBotConfig();
        }
        
        // Legacy function for backward compatibility
        async function saveBotSettings() {
            // This function is kept for compatibility but is no longer used
            console.warn('saveBotSettings() is deprecated. Use saveBotConfig() instead.');
        }
        
        async function saveSecuritySettings() {
            const rateLimit = document.getElementById('rate-limit')?.value;
            const maxMessageLength = document.getElementById('max-message-length').value;
            
            const result = await adminApiCall('save_settings', {
                rate_limit: parseInt(rateLimit),
                max_message_length: parseInt(maxMessageLength)
            });
            
            if (result.error) {
                alert('Error saving security settings: ' + result.error);
            } else {
                alert(result.message || 'Security settings saved successfully');
            }
        }
        
        async function deleteScore(scoreId) {
            if (!confirm('Delete this score?')) return;
            
            const result = await adminApiCall('delete_score', { id: scoreId });
            if (result.error) {
                alert('Error deleting score: ' + result.error);
            } else {
                alert(result.message || 'Score deleted successfully');
                loadHighScores(); // Reload the table
            }
        }


        // Save authenticated user scores
        async function saveAuthenticatedScore(gameName, score, levelReached = 1) {
            if (!currentUser) return null;
            
            try {
                const response = await fetch('auth.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'save_score',
                        game_name: gameName,
                        score: score,
                        level_reached: levelReached
                    })
                });
                return await response.json();
            } catch (error) {
                console.error('Score save failed:', error);
                return null;
            }
        }

        // Click outside modal to close
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });

        // Admin Panel Functions
        async function showAdminPanel() {
            document.getElementById('admin-modal').style.display = 'flex';
            await loadUsers();
        }

        async function loadUsers() {
            const loadingDiv = document.getElementById('admin-loading');
            const contentDiv = document.getElementById('admin-content');
            const tbody = document.getElementById('users-tbody');

            loadingDiv.style.display = 'block';
            contentDiv.style.display = 'none';

            try {
                const data = await SecureAdmin.getUsers();

                if (data.success) {
                    tbody.innerHTML = '';
                    data.users.forEach(user => {
                        const row = document.createElement('tr');
                        const createdDate = new Date(user.created_at).toLocaleDateString();
                        const lastLogin = user.last_login ? new Date(user.last_login).toLocaleDateString() : 'Never';
                        
                        row.innerHTML = `
                            <td style="font-weight: 600;">${user.username}</td>
                            <td>${user.email}</td>
                            <td>
                                <span style="color: ${user.is_active ? '#059669' : '#dc2626'};">
                                    ${user.is_active ? '✅ Active' : '❌ Inactive'}
                                </span>
                            </td>
                            <td>
                                <span style="color: ${user.is_admin ? '#dc2626' : '#6b7280'};">
                                    ${user.is_admin ? '👑 Admin' : '👤 User'}
                                </span>
                            </td>
                            <td>${createdDate}</td>
                            <td>${lastLogin}</td>
                            <td>
                                <div class="admin-actions">
                                    <button class="toggle-admin ${user.is_admin ? 'admin' : ''}" 
                                            onclick="toggleAdmin(${user.id}, ${!user.is_admin})">
                                        ${user.is_admin ? 'Remove Admin' : 'Make Admin'}
                                    </button>
                                    <button class="toggle-active ${!user.is_active ? 'inactive' : ''}" 
                                            onclick="toggleActive(${user.id}, ${!user.is_active})">
                                        ${user.is_active ? 'Deactivate' : 'Activate'}
                                    </button>
                                </div>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; color: var(--text-secondary);">${data.message}</td></tr>`;
                }
            } catch (error) {
                tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; color: #dc2626;">Error loading users</td></tr>`;
            }

            loadingDiv.style.display = 'none';
            contentDiv.style.display = 'block';
        }

        async function toggleAdmin(userId, makeAdmin) {
            try {
                const data = await SecureAdmin.updateUserAdmin(userId, makeAdmin, currentCSRFToken);

                if (data.success) {
                    showAdminMessage(data.message, 'success');
                    await loadUsers(); // Refresh the table
                } else {
                    showAdminMessage(data.message, 'error');
                }
            } catch (error) {
                showAdminMessage('Error updating admin status', 'error');
            }
        }

        async function toggleActive(userId, makeActive) {
            try {
                const data = await SecureAdmin.updateUserStatus(userId, makeActive, currentCSRFToken);

                if (data.success) {
                    showAdminMessage(data.message, 'success');
                    await loadUsers(); // Refresh the table
                } else {
                    showAdminMessage(data.message, 'error');
                }
            } catch (error) {
                showAdminMessage('Error updating user status', 'error');
            }
        }

        function showAdminMessage(message, type) {
            const messageDiv = document.getElementById('admin-message');
            const className = type === 'success' ? 'success-message' : 'error-message';
            messageDiv.innerHTML = `<div class="${className}">${message}</div>`;
            
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 3000);
        }

        // Website user management functions
        async function loadWebsiteUsers() {
            const loadingDiv = document.getElementById('website-users-loading');
            const tableDiv = document.getElementById('website-users-table');
            
            loadingDiv.style.display = 'block';
            tableDiv.innerHTML = '';
            
            try {
                const data = await SecureAdmin.getUsers();
                
                if (data.success) {
                    displayWebsiteUsersTable(data.users, data.current_user_id);
                } else {
                    tableDiv.innerHTML = `<p style="color: var(--error-color);">Failed to load users: ${data.message}</p>`;
                }
            } catch (error) {
                console.error('Error loading website users:', error);
                tableDiv.innerHTML = `<p style="color: var(--error-color);">Error loading users</p>`;
            } finally {
                loadingDiv.style.display = 'none';
            }
        }

        function displayWebsiteUsersTable(users, currentUserId) {
            const tableDiv = document.getElementById('website-users-table');
            
            if (users.length === 0) {
                tableDiv.innerHTML = '<p style="color: var(--text-secondary);">No users found</p>';
                return;
            }
            
            const table = document.createElement('table');
            table.className = 'admin-table';
            table.style.width = '100%';
            table.style.marginTop = '1rem';
            
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Status</th>
                        <th>Admin</th>
                        <th>Created</th>
                        <th>Last Login</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    ${users.map(user => `
                        <tr>
                            <td><strong>${escapeHtml(user.username)}</strong></td>
                            <td>${escapeHtml(user.email)}</td>
                            <td>
                                <span class="status-badge" style="background: ${user.is_active ? '#d4edda' : '#f8d7da'}; color: ${user.is_active ? '#155724' : '#721c24'};">
                                    ${user.is_active ? 'Active' : 'Inactive'}
                                </span>
                            </td>
                            <td>
                                <span class="status-badge" style="background: ${user.is_admin ? '#d1ecf1' : '#f8f9fa'}; color: ${user.is_admin ? '#0c5460' : '#6c757d'};">
                                    ${user.is_admin ? 'Admin' : 'User'}
                                </span>
                            </td>
                            <td>${formatDate(user.created_at)}</td>
                            <td>${user.last_login ? formatDate(user.last_login) : 'Never'}</td>
                            <td>
                                <button class="user-action-btn toggle-admin ${user.is_admin ? 'admin' : ''}" 
                                        onclick="toggleWebsiteAdmin(${user.id}, ${!user.is_admin})"
                                        title="${user.is_admin ? 'Remove admin privileges from this user' : 'Grant admin privileges to this user'}"
                                        style="margin-right: 0.25rem; padding: 0.25rem 0.5rem; font-size: 0.9rem; min-width: 2rem;">
                                    ${user.is_admin ? '🔻' : '🔺'}
                                </button>
                                <button class="user-action-btn toggle-active ${!user.is_active ? 'inactive' : ''}" 
                                        onclick="toggleWebsiteActive(${user.id}, ${!user.is_active})"
                                        title="${user.is_active ? 'Deactivate this user account' : 'Activate this user account'}"
                                        style="margin-right: 0.25rem; padding: 0.25rem 0.5rem; font-size: 0.9rem; min-width: 2rem;">
                                    ${user.is_active ? '⏸️' : '▶️'}
                                </button>
                                ${user.id !== currentUserId ? `
                                    <button class="user-action-btn delete-user" 
                                            onclick="deleteWebsiteUser(${user.id}, '${escapeHtml(user.username)}')"
                                            title="Permanently delete this user account"
                                            style="background: #dc2626; color: white; border: 1px solid #dc2626; padding: 0.25rem 0.5rem; font-size: 0.9rem; min-width: 2rem;">
                                        🗑️
                                    </button>
                                ` : ''}
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            `;
            
            tableDiv.appendChild(table);
        }

        async function toggleWebsiteAdmin(userId, makeAdmin) {
            console.log('toggleWebsiteAdmin called with:', userId, makeAdmin);
            try {
                await getCSRFToken(); // Ensure we have a CSRF token
                const data = await SecureAdmin.updateUserAdmin(userId, makeAdmin, currentCSRFToken);
                console.log('Admin response data:', data);
                
                if (data.success) {
                    showAdminMessage(data.message, 'success');
                    loadWebsiteUsers(); // Reload the table
                } else {
                    showAdminMessage('Failed to update admin status: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error updating admin status:', error);
                showAdminMessage('Error updating admin status', 'error');
            }
        }

        async function toggleWebsiteActive(userId, makeActive) {
            console.log('toggleWebsiteActive called with:', userId, makeActive);
            try {
                await getCSRFToken(); // Ensure we have a CSRF token
                const data = await SecureAdmin.updateUserStatus(userId, makeActive, currentCSRFToken);
                console.log('Response data:', data);
                
                if (data.success) {
                    showAdminMessage(data.message, 'success');
                    loadWebsiteUsers(); // Reload the table
                } else {
                    showAdminMessage('Failed to update user status: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error updating user status:', error);
                showAdminMessage('Error updating user status', 'error');
            }
        }

        async function deleteWebsiteUser(userId, username) {
            if (!confirm(`⚠️ Are you sure you want to permanently delete user "${username}"?\n\nThis action cannot be undone!`)) {
                return;
            }
            
            console.log('deleteWebsiteUser called with:', userId, username);
            try {
                await getCSRFToken(); // Ensure we have a CSRF token
                const data = await SecureAdmin.deleteUser(userId, currentCSRFToken);
                console.log('Delete user response data:', data);
                
                if (data.success) {
                    showAdminMessage(`User "${username}" deleted successfully`, 'success');
                    loadWebsiteUsers(); // Reload the table
                } else {
                    showAdminMessage('Failed to delete user: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error deleting user:', error);
                showAdminMessage('Error deleting user', 'error');
            }
        }

        function formatDate(dateString) {
            if (!dateString) return 'Never';
            const date = new Date(dateString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Security Monitor Functions
        function initializeSecurityMonitoring() {
            console.log('Initializing security monitoring...');
            refreshSecurityData();
            
            // Set up auto-refresh every 5 seconds
            window.securityRefreshInterval = setInterval(refreshSecurityData, 5000);
        }
        
        function refreshSecurityData() {
            loadSecurityStats();
            loadSecurityAlerts();
            loadSecuritySession();
            loadSecurityEvents();
            loadSecurityErrors();
        }
        
        async function loadSecurityStats() {
            try {
                const response = await fetch('/api/bot_status.php?action=security_stats');
                const data = await response.json();
                
                document.getElementById('security-live-stats').innerHTML = `
                    <div style="display: grid; gap: 1rem;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Events Today:</span>
                            <span style="font-weight: bold; color: var(--primary-color);">${data.events_today || 0}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Critical Alerts:</span>
                            <span style="font-weight: bold; color: #ff6b6b;">${data.critical_alerts || 0}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Blocked IPs:</span>
                            <span style="font-weight: bold; color: #ffa500;">${data.blocked_ips || 0}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>System Health:</span>
                            <span style="font-weight: bold; color: #00ff00;">Active</span>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading security stats:', error);
                document.getElementById('security-live-stats').innerHTML = '<div style="color: #ff6b6b;">Error loading stats</div>';
            }
        }
        
        async function loadSecurityAlerts() {
            try {
                // Use existing security events data for now
                const events = JSON.parse(localStorage.getItem('recent_security_events') || '[]');
                const alerts = events.filter(e => e.type.includes('ATTACK') || e.type.includes('WARNING'));
                
                if (alerts.length === 0) {
                    document.getElementById('security-alerts').innerHTML = '<div style="color: var(--text-secondary);">No recent alerts</div>';
                    return;
                }
                
                const alertsHtml = alerts.slice(0, 5).map(alert => `
                    <div style="background: rgba(255, 107, 107, 0.1); border-left: 3px solid #ff6b6b; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 3px;">
                        <div style="font-weight: bold; color: #ff6b6b;">${alert.type}</div>
                        <div style="font-size: 0.85em; color: var(--text-secondary);">${alert.message}</div>
                        <div style="font-size: 0.75em; color: var(--text-muted); margin-top: 0.25rem;">${alert.timestamp}</div>
                    </div>
                `).join('');
                
                document.getElementById('security-alerts').innerHTML = alertsHtml;
            } catch (error) {
                console.error('Error loading security alerts:', error);
                document.getElementById('security-alerts').innerHTML = '<div style="color: #ff6b6b;">Error loading alerts</div>';
            }
        }
        
        async function loadSecuritySession() {
            try {
                // Mock session data for now - would be replaced with real API call
                const sessionData = {
                    session_id: 'sess_' + Math.random().toString(36).substr(2, 8),
                    expires_in: 1800,
                    fingerprint_valid: true,
                    ip_address: '127.0.0.1',
                    is_secure: window.location.protocol === 'https:'
                };
                
                const expiresMinutes = Math.floor(sessionData.expires_in / 60);
                const expiresSeconds = sessionData.expires_in % 60;
                
                document.getElementById('security-session-status').innerHTML = `
                    <div style="display: grid; gap: 0.75rem; font-size: 0.9em;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Session ID:</span>
                            <span style="font-family: monospace; color: var(--primary-color);">${sessionData.session_id}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Expires In:</span>
                            <span style="color: ${sessionData.expires_in < 300 ? '#ff6b6b' : '#00ff00'};">${expiresMinutes}m ${expiresSeconds}s</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Fingerprint:</span>
                            <span style="color: ${sessionData.fingerprint_valid ? '#00ff00' : '#ff6b6b'};">
                                ${sessionData.fingerprint_valid ? '✓ Valid' : '✗ Invalid'}
                            </span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Connection:</span>
                            <span style="color: ${sessionData.is_secure ? '#00ff00' : '#ffa500'};">
                                ${sessionData.is_secure ? '🔒 HTTPS' : '⚠️ HTTP'}
                            </span>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading session status:', error);
                document.getElementById('security-session-status').innerHTML = '<div style="color: #ff6b6b;">Error loading session info</div>';
            }
        }
        
        async function loadSecurityEvents() {
            try {
                // Try to load real security events from the temp file
                let events = [];
                try {
                    const response = await fetch('/security_events_read.php');
                    if (response.ok) {
                        events = await response.json();
                    }
                } catch (e) {
                    console.log('Could not load real events, using localStorage fallback');
                }
                
                // Fallback to localStorage
                if (events.length === 0) {
                    events = JSON.parse(localStorage.getItem('recent_security_events') || '[]');
                }
                
                if (events.length === 0) {
                    document.getElementById('security-recent-events').innerHTML = '<div style="color: var(--text-secondary);">No recent events</div>';
                    document.getElementById('security-top-ips').innerHTML = '<div style="color: var(--text-secondary);">No threat data</div>';
                    return;
                }
                
                // Recent events
                const recentHtml = events.slice(0, 8).map(event => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; border-bottom: 1px solid var(--border-light);">
                        <div>
                            <div style="font-weight: 500; color: var(--text-primary);">${event.type}</div>
                            <div style="font-size: 0.8em; color: var(--text-secondary);">${event.timestamp}</div>
                        </div>
                        <div style="padding: 0.25rem 0.5rem; background: rgba(0, 123, 255, 0.1); color: #007bff; border-radius: 3px; font-size: 0.75em;">
                            ${event.ip || 'unknown'}
                        </div>
                    </div>
                `).join('');
                
                document.getElementById('security-recent-events').innerHTML = recentHtml;
                
                // Top IPs
                const ipCounts = {};
                events.forEach(event => {
                    const ip = event.ip || 'unknown';
                    ipCounts[ip] = (ipCounts[ip] || 0) + 1;
                });
                
                const topIPs = Object.entries(ipCounts)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5);
                
                if (topIPs.length > 0) {
                    const maxCount = topIPs[0][1];
                    const topIPsHtml = topIPs.map(([ip, count]) => {
                        const percentage = (count / maxCount) * 100;
                        return `
                            <div style="margin-bottom: 0.75rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                    <span style="font-family: monospace; font-size: 0.9em;">${ip}</span>
                                    <span style="font-weight: bold; color: var(--primary-color);">${count}</span>
                                </div>
                                <div style="background: var(--border-light); height: 6px; border-radius: 3px; overflow: hidden;">
                                    <div style="background: linear-gradient(to right, #ff6b6b, #ffa500); height: 100%; width: ${percentage}%; transition: width 0.3s ease;"></div>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    document.getElementById('security-top-ips').innerHTML = topIPsHtml;
                } else {
                    document.getElementById('security-top-ips').innerHTML = '<div style="color: var(--text-secondary);">No threat data</div>';
                }
            } catch (error) {
                console.error('Error loading security events:', error);
                document.getElementById('security-recent-events').innerHTML = '<div style="color: #ff6b6b;">Error loading events</div>';
                document.getElementById('security-top-ips').innerHTML = '<div style="color: #ff6b6b;">Error loading threat data</div>';
            }
        }
        
        async function loadSecurityErrors() {
            try {
                // Mock error statistics
                const errorStats = {
                    today: Math.floor(Math.random() * 10),
                    yesterday: Math.floor(Math.random() * 15),
                    week: Math.floor(Math.random() * 50),
                    by_type: {
                        'PHP_ERROR': Math.floor(Math.random() * 5),
                        'DATABASE_ERROR': Math.floor(Math.random() * 3),
                        'FILE_ERROR': Math.floor(Math.random() * 2)
                    }
                };
                
                let errorsHtml = `
                    <div style="display: grid; gap: 0.75rem;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Today:</span>
                            <span style="color: #ff6b6b; font-weight: bold;">${errorStats.today}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Yesterday:</span>
                            <span style="color: #ffa500; font-weight: bold;">${errorStats.yesterday}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>This Week:</span>
                            <span style="color: #ffaa00; font-weight: bold;">${errorStats.week}</span>
                        </div>
                `;
                
                if (Object.keys(errorStats.by_type).length > 0) {
                    errorsHtml += '<div style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid var(--border-light);"><strong>By Type:</strong></div>';
                    Object.entries(errorStats.by_type).forEach(([type, count]) => {
                        errorsHtml += `
                            <div style="display: flex; justify-content: space-between; font-size: 0.85em;">
                                <span>${type}:</span>
                                <span style="color: var(--primary-color);">${count}</span>
                            </div>
                        `;
                    });
                }
                
                errorsHtml += '</div>';
                document.getElementById('security-error-stats').innerHTML = errorsHtml;
            } catch (error) {
                console.error('Error loading error stats:', error);
                document.getElementById('security-error-stats').innerHTML = '<div style="color: #ff6b6b;">Error loading stats</div>';
            }
        }


        // Tool Functions
        function openTool(toolType) {
            const toolInterface = document.getElementById('tool-interface');
            const toolTitle = document.getElementById('tool-title');
            const toolContent = document.getElementById('tool-content');
            
            // Show the tool interface
            toolInterface.style.display = 'block';
            
            // Scroll to the tool interface
            toolInterface.scrollIntoView({ behavior: 'smooth' });
            
            // Set tool title and content based on type
            switch(toolType) {
                case 'base64':
                    toolTitle.textContent = '📝 Base64 Encoder/Decoder';
                    toolContent.innerHTML = `
                        <div style="display: grid; gap: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Input Text:</label>
                                <textarea id="base64-input" placeholder="Enter text to encode/decode" style="width: 100%; min-height: 120px; padding: 0.75rem; border: 1px solid var(--border-light); border-radius: var(--radius-md); background: var(--bg-secondary); color: var(--text-primary); font-family: var(--font-mono); resize: vertical;"></textarea>
                            </div>
                            <div style="display: flex; gap: 1rem;">
                                <button onclick="encodeBase64()" style="flex: 1; padding: 0.75rem; background: var(--primary-color); color: white; border: none; border-radius: var(--radius-md); cursor: pointer;">Encode</button>
                                <button onclick="decodeBase64()" style="flex: 1; padding: 0.75rem; background: var(--primary-color); color: white; border: none; border-radius: var(--radius-md); cursor: pointer;">Decode</button>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Output:</label>
                                <textarea id="base64-output" readonly placeholder="Result will appear here" style="width: 100%; min-height: 120px; padding: 0.75rem; border: 1px solid var(--border-light); border-radius: var(--radius-md); background: var(--bg-tertiary); color: var(--text-primary); font-family: var(--font-mono); resize: vertical;"></textarea>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'hash':
                    toolTitle.textContent = '🔐 Hash Generator';
                    toolContent.innerHTML = `
                        <div style="display: grid; gap: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Input Text:</label>
                                <textarea id="hash-input" placeholder="Enter text to hash" style="width: 100%; min-height: 120px; padding: 0.75rem; border: 1px solid var(--border-light); border-radius: var(--radius-md); background: var(--bg-secondary); color: var(--text-primary); resize: vertical;"></textarea>
                            </div>
                            <button onclick="generateHashes()" style="padding: 0.75rem; background: var(--primary-color); color: white; border: none; border-radius: var(--radius-md); cursor: pointer;">Generate Hashes</button>
                            <div id="hash-results" style="display: grid; gap: 0.75rem;"></div>
                        </div>
                    `;
                    break;
                    
                case 'url':
                    toolTitle.textContent = '🔗 URL Encoder/Decoder';
                    toolContent.innerHTML = `
                        <div style="display: grid; gap: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Input URL:</label>
                                <textarea id="url-input" placeholder="Enter URL to encode/decode" style="width: 100%; min-height: 120px; padding: 0.75rem; border: 1px solid var(--border-light); border-radius: var(--radius-md); background: var(--bg-secondary); color: var(--text-primary); resize: vertical;"></textarea>
                            </div>
                            <div style="display: flex; gap: 1rem;">
                                <button onclick="encodeURL()" style="flex: 1; padding: 0.75rem; background: var(--primary-color); color: white; border: none; border-radius: var(--radius-md); cursor: pointer;">Encode</button>
                                <button onclick="decodeURL()" style="flex: 1; padding: 0.75rem; background: var(--primary-color); color: white; border: none; border-radius: var(--radius-md); cursor: pointer;">Decode</button>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Output:</label>
                                <textarea id="url-output" readonly placeholder="Result will appear here" style="width: 100%; min-height: 120px; padding: 0.75rem; border: 1px solid var(--border-light); border-radius: var(--radius-md); background: var(--bg-tertiary); color: var(--text-primary); resize: vertical;"></textarea>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'json':
                    toolTitle.textContent = '📋 JSON Formatter';
                    toolContent.innerHTML = `
                        <div style="display: grid; gap: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Input JSON:</label>
                                <textarea id="json-input" placeholder="Enter JSON to format" style="width: 100%; min-height: 200px; padding: 0.75rem; border: 1px solid var(--border-light); border-radius: var(--radius-md); background: var(--bg-secondary); color: var(--text-primary); font-family: var(--font-mono); resize: vertical;"></textarea>
                            </div>
                            <div style="display: flex; gap: 1rem;">
                                <button onclick="formatJSON()" style="flex: 1; padding: 0.75rem; background: var(--primary-color); color: white; border: none; border-radius: var(--radius-md); cursor: pointer;">Format</button>
                                <button onclick="minifyJSON()" style="flex: 1; padding: 0.75rem; background: var(--primary-color); color: white; border: none; border-radius: var(--radius-md); cursor: pointer;">Minify</button>
                                <button onclick="validateJSON()" style="flex: 1; padding: 0.75rem; background: var(--primary-color); color: white; border: none; border-radius: var(--radius-md); cursor: pointer;">Validate</button>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Output:</label>
                                <textarea id="json-output" readonly placeholder="Formatted JSON will appear here" style="width: 100%; min-height: 200px; padding: 0.75rem; border: 1px solid var(--border-light); border-radius: var(--radius-md); background: var(--bg-tertiary); color: var(--text-primary); font-family: var(--font-mono); resize: vertical;"></textarea>
                            </div>
                            <div id="json-status" style="padding: 0.5rem; border-radius: var(--radius-md); font-size: 0.875rem; display: none;"></div>
                        </div>
                    `;
                    break;
                    
                case 'uuid':
                    toolTitle.textContent = '🆔 UUID Generator';
                    toolContent.innerHTML = `
                        <div style="display: grid; gap: 1rem;">
                            <div style="display: flex; gap: 1rem; align-items: center;">
                                <label style="font-weight: 600;">Count:</label>
                                <input type="number" id="uuid-count" value="1" min="1" max="100" style="width: 80px; padding: 0.5rem; border: 1px solid var(--border-light); border-radius: var(--radius-md); background: var(--bg-secondary); color: var(--text-primary);">
                                <button onclick="generateUUIDs()" style="padding: 0.5rem 1rem; background: var(--primary-color); color: white; border: none; border-radius: var(--radius-md); cursor: pointer;">Generate UUIDs</button>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Generated UUIDs:</label>
                                <textarea id="uuid-output" readonly placeholder="UUIDs will appear here" style="width: 100%; min-height: 200px; padding: 0.75rem; border: 1px solid var(--border-light); border-radius: var(--radius-md); background: var(--bg-tertiary); color: var(--text-primary); font-family: var(--font-mono); resize: vertical;"></textarea>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'password':
                    toolTitle.textContent = '🔑 Password Generator';
                    toolContent.innerHTML = `
                        <div style="display: grid; gap: 1rem;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Length:</label>
                                    <input type="range" id="pwd-length" min="8" max="128" value="16" oninput="document.getElementById('pwd-length-display').textContent = this.value" style="width: 100%;">
                                    <span id="pwd-length-display" style="font-size: 0.875rem; color: var(--text-secondary);">16</span>
                                </div>
                                <div style="display: grid; gap: 0.5rem;">
                                    <label><input type="checkbox" id="pwd-upper" checked> Uppercase (A-Z)</label>
                                    <label><input type="checkbox" id="pwd-lower" checked> Lowercase (a-z)</label>
                                    <label><input type="checkbox" id="pwd-numbers" checked> Numbers (0-9)</label>
                                    <label><input type="checkbox" id="pwd-symbols"> Symbols (!@#$%^&*)</label>
                                </div>
                            </div>
                            <button onclick="generatePassword()" style="padding: 0.75rem; background: var(--primary-color); color: white; border: none; border-radius: var(--radius-md); cursor: pointer;">Generate Password</button>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Generated Password:</label>
                                <div style="display: flex; gap: 0.5rem;">
                                    <input type="text" id="password-output" readonly placeholder="Password will appear here" style="flex: 1; padding: 0.75rem; border: 1px solid var(--border-light); border-radius: var(--radius-md); background: var(--bg-tertiary); color: var(--text-primary); font-family: var(--font-mono);">
                                    <button onclick="copyToClipboard('password-output')" style="padding: 0.75rem 1rem; background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: var(--radius-md); cursor: pointer;">📋</button>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'timestamp':
                    toolTitle.textContent = '⏰ Timestamp Converter';
                    toolContent.innerHTML = `
                        <div style="display: grid; gap: 1rem;">
                            <div style="display: grid; grid-template-columns: 1fr auto; gap: 1rem; align-items: end;">
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Timestamp (seconds):</label>
                                    <input type="number" id="timestamp-input" placeholder="1640995200" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-light); border-radius: var(--radius-md); background: var(--bg-secondary); color: var(--text-primary);">
                                </div>
                                <button onclick="convertTimestamp()" style="padding: 0.75rem 1rem; background: var(--primary-color); color: white; border: none; border-radius: var(--radius-md); cursor: pointer;">Convert</button>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Human Readable:</label>
                                <input type="text" id="timestamp-output" readonly placeholder="Converted date will appear here" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-light); border-radius: var(--radius-md); background: var(--bg-tertiary); color: var(--text-primary);">
                            </div>
                            <hr style="border: none; border-top: 1px solid var(--border-light);">
                            <div style="display: grid; grid-template-columns: 1fr auto; gap: 1rem; align-items: end;">
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Date (YYYY-MM-DD HH:MM:SS):</label>
                                    <input type="datetime-local" id="date-input" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-light); border-radius: var(--radius-md); background: var(--bg-secondary); color: var(--text-primary);">
                                </div>
                                <button onclick="convertDate()" style="padding: 0.75rem 1rem; background: var(--primary-color); color: white; border: none; border-radius: var(--radius-md); cursor: pointer;">Convert</button>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Timestamp:</label>
                                <input type="text" id="date-output" readonly placeholder="Timestamp will appear here" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-light); border-radius: var(--radius-md); background: var(--bg-tertiary); color: var(--text-primary);">
                            </div>
                            <button onclick="getCurrentTimestamp()" style="padding: 0.75rem; background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: var(--radius-md); cursor: pointer; color: var(--text-primary);">Use Current Time</button>
                        </div>
                    `;
                    break;
                    
                case 'calculator':
                    toolTitle.textContent = '🧮 Calculator';
                    toolContent.innerHTML = `
                        <div style="display: grid; gap: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Expression:</label>
                                <input type="text" id="calc-input" placeholder="e.g., (2 + 3) * 4" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-light); border-radius: var(--radius-md); background: var(--bg-secondary); color: var(--text-primary); font-family: var(--font-mono);" onkeypress="if(event.key==='Enter') calculate()">
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem;">
                                <button onclick="appendToCalc('7')" class="calc-btn">7</button>
                                <button onclick="appendToCalc('8')" class="calc-btn">8</button>
                                <button onclick="appendToCalc('9')" class="calc-btn">9</button>
                                <button onclick="appendToCalc('/')" class="calc-btn">÷</button>
                                <button onclick="appendToCalc('4')" class="calc-btn">4</button>
                                <button onclick="appendToCalc('5')" class="calc-btn">5</button>
                                <button onclick="appendToCalc('6')" class="calc-btn">6</button>
                                <button onclick="appendToCalc('*')" class="calc-btn">×</button>
                                <button onclick="appendToCalc('1')" class="calc-btn">1</button>
                                <button onclick="appendToCalc('2')" class="calc-btn">2</button>
                                <button onclick="appendToCalc('3')" class="calc-btn">3</button>
                                <button onclick="appendToCalc('-')" class="calc-btn">-</button>
                                <button onclick="appendToCalc('0')" class="calc-btn">0</button>
                                <button onclick="appendToCalc('.')" class="calc-btn">.</button>
                                <button onclick="clearCalc()" class="calc-btn" style="background: var(--bg-tertiary);">C</button>
                                <button onclick="appendToCalc('+')" class="calc-btn">+</button>
                                <button onclick="appendToCalc('(')" class="calc-btn">(</button>
                                <button onclick="appendToCalc(')')" class="calc-btn">)</button>
                                <button onclick="calculate()" class="calc-btn" style="background: var(--primary-color); color: white; grid-column: span 2;">=</button>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Result:</label>
                                <input type="text" id="calc-output" readonly placeholder="Result will appear here" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-light); border-radius: var(--radius-md); background: var(--bg-tertiary); color: var(--text-primary); font-family: var(--font-mono); font-size: 1.25rem;">
                            </div>
                        </div>
                        <style>
                            .calc-btn {
                                padding: 1rem;
                                border: 1px solid var(--border-light);
                                border-radius: var(--radius-md);
                                background: var(--bg-secondary);
                                color: var(--text-primary);
                                cursor: pointer;
                                font-weight: 600;
                                transition: all 0.2s;
                            }
                            .calc-btn:hover {
                                background: var(--bg-tertiary);
                            }
                        </style>
                    `;
                    break;
                    
                default:
                    toolTitle.textContent = '🔧 Tool';
                    toolContent.innerHTML = '<p>Tool implementation coming soon!</p>';
            }
        }

        function closeTool() {
            document.getElementById('tool-interface').style.display = 'none';
        }

        // Base64 functions
        function encodeBase64() {
            const input = document.getElementById('base64-input').value;
            const output = document.getElementById('base64-output');
            try {
                output.value = btoa(unescape(encodeURIComponent(input)));
            } catch (e) {
                output.value = 'Error: ' + e.message;
            }
        }

        function decodeBase64() {
            const input = document.getElementById('base64-input').value;
            const output = document.getElementById('base64-output');
            try {
                output.value = decodeURIComponent(escape(atob(input)));
            } catch (e) {
                output.value = 'Error: ' + e.message;
            }
        }

        // Hash functions
        async function generateHashes() {
            const input = document.getElementById('hash-input').value;
            const results = document.getElementById('hash-results');
            
            if (!input) {
                results.innerHTML = '<div style="color: var(--text-secondary);">Enter text to generate hashes</div>';
                return;
            }
            
            const encoder = new TextEncoder();
            const data = encoder.encode(input);
            
            try {
                const md5Hash = await crypto.subtle.digest('SHA-1', data); // Using SHA-1 as MD5 alternative
                const sha1Hash = await crypto.subtle.digest('SHA-1', data);
                const sha256Hash = await crypto.subtle.digest('SHA-256', data);
                
                results.innerHTML = `
                    <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius-md);">
                        <strong>SHA-1:</strong><br>
                        <code style="font-family: var(--font-mono); word-break: break-all;">${Array.from(new Uint8Array(sha1Hash)).map(b => b.toString(16).padStart(2, '0')).join('')}</code>
                    </div>
                    <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius-md);">
                        <strong>SHA-256:</strong><br>
                        <code style="font-family: var(--font-mono); word-break: break-all;">${Array.from(new Uint8Array(sha256Hash)).map(b => b.toString(16).padStart(2, '0')).join('')}</code>
                    </div>
                `;
            } catch (e) {
                results.innerHTML = '<div style="color: red;">Error generating hashes: ' + e.message + '</div>';
            }
        }

        // URL functions
        function encodeURL() {
            const input = document.getElementById('url-input').value;
            const output = document.getElementById('url-output');
            try {
                output.value = encodeURIComponent(input);
            } catch (e) {
                output.value = 'Error: ' + e.message;
            }
        }

        function decodeURL() {
            const input = document.getElementById('url-input').value;
            const output = document.getElementById('url-output');
            try {
                output.value = decodeURIComponent(input);
            } catch (e) {
                output.value = 'Error: ' + e.message;
            }
        }

        // JSON functions
        function formatJSON() {
            const input = document.getElementById('json-input').value;
            const output = document.getElementById('json-output');
            const status = document.getElementById('json-status');
            
            try {
                const parsed = JSON.parse(input);
                output.value = JSON.stringify(parsed, null, 2);
                status.style.display = 'block';
                status.style.background = 'var(--accent-green)';
                status.style.color = 'var(--text-primary)';
                status.textContent = '✅ Valid JSON';
            } catch (e) {
                status.style.display = 'block';
                status.style.background = '#fecaca';
                status.style.color = '#991b1b';
                status.textContent = '❌ Invalid JSON: ' + e.message;
            }
        }

        function minifyJSON() {
            const input = document.getElementById('json-input').value;
            const output = document.getElementById('json-output');
            const status = document.getElementById('json-status');
            
            try {
                const parsed = JSON.parse(input);
                output.value = JSON.stringify(parsed);
                status.style.display = 'block';
                status.style.background = 'var(--accent-green)';
                status.style.color = 'var(--text-primary)';
                status.textContent = '✅ Valid JSON';
            } catch (e) {
                status.style.display = 'block';
                status.style.background = '#fecaca';
                status.style.color = '#991b1b';
                status.textContent = '❌ Invalid JSON: ' + e.message;
            }
        }

        function validateJSON() {
            const input = document.getElementById('json-input').value;
            const status = document.getElementById('json-status');
            
            try {
                JSON.parse(input);
                status.style.display = 'block';
                status.style.background = 'var(--accent-green)';
                status.style.color = 'var(--text-primary)';
                status.textContent = '✅ Valid JSON';
            } catch (e) {
                status.style.display = 'block';
                status.style.background = '#fecaca';
                status.style.color = '#991b1b';
                status.textContent = '❌ Invalid JSON: ' + e.message;
            }
        }

        // UUID functions
        function generateUUIDs() {
            const count = parseInt(document.getElementById('uuid-count').value);
            const output = document.getElementById('uuid-output');
            
            const uuids = [];
            for (let i = 0; i < count; i++) {
                uuids.push(generateUUID());
            }
            
            output.value = uuids.join('\\n');
        }

        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // Password functions
        function generatePassword() {
            const length = parseInt(document.getElementById('pwd-length').value);
            const useUpper = document.getElementById('pwd-upper').checked;
            const useLower = document.getElementById('pwd-lower').checked;
            const useNumbers = document.getElementById('pwd-numbers').checked;
            const useSymbols = document.getElementById('pwd-symbols').checked;
            
            let charset = '';
            if (useUpper) charset += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            if (useLower) charset += 'abcdefghijklmnopqrstuvwxyz';
            if (useNumbers) charset += '0123456789';
            if (useSymbols) charset += '!@#$%^&*()_+-=[]{}|;:,.<>?';
            
            if (!charset) {
                alert('Please select at least one character type');
                return;
            }
            
            let password = '';
            for (let i = 0; i < length; i++) {
                password += charset.charAt(Math.floor(Math.random() * charset.length));
            }
            
            document.getElementById('password-output').value = password;
        }

        // Timestamp functions
        function convertTimestamp() {
            const timestamp = parseInt(document.getElementById('timestamp-input').value);
            const output = document.getElementById('timestamp-output');
            
            if (isNaN(timestamp)) {
                output.value = 'Invalid timestamp';
                return;
            }
            
            const date = new Date(timestamp * 1000);
            output.value = date.toLocaleString();
        }

        function convertDate() {
            const dateInput = document.getElementById('date-input').value;
            const output = document.getElementById('date-output');
            
            if (!dateInput) {
                output.value = 'Please select a date';
                return;
            }
            
            const date = new Date(dateInput);
            output.value = Math.floor(date.getTime() / 1000);
        }

        function getCurrentTimestamp() {
            const now = Math.floor(Date.now() / 1000);
            document.getElementById('timestamp-input').value = now;
            document.getElementById('timestamp-output').value = new Date().toLocaleString();
        }

        // Calculator functions
        function appendToCalc(value) {
            const input = document.getElementById('calc-input');
            input.value += value;
        }

        function clearCalc() {
            document.getElementById('calc-input').value = '';
            document.getElementById('calc-output').value = '';
        }

        function calculate() {
            const input = document.getElementById('calc-input').value;
            const output = document.getElementById('calc-output');
            
            try {
                // Replace display symbols with actual operators
                const expression = input.replace(/÷/g, '/').replace(/×/g, '*');
                
                // Use Function constructor for safer evaluation
                const result = Function('"use strict"; return (' + expression + ')')();
                output.value = result;
            } catch (e) {
                output.value = 'Error: ' + e.message;
            }
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            element.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(element.value);
            showCopyNotification();
        }
    </script>
</body>
</html>
