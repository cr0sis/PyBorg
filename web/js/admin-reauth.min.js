!function(e,t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e=e||self).AdminReAuth=r()}(this,0,function(){"use strict";var a=function(){var n={},i=null,r=null;function s(t,n){return fetch("/admin_reauth.php",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify(t)}).then(function(e){if(!e.ok)throw new Error("HTTP "+e.status);return e.json()}).then(function(e){return n&&n(e),e})}function c(){if(i)return;i=document.createElement("div"),i.id="reauth-modal",i.innerHTML='\n            <div class="modal-overlay" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:10000;display:flex;align-items:center;justify-content:center;">\n                <div class="modal-content" style="background:var(--bg-primary);border:2px solid var(--primary-color);border-radius:10px;padding:2rem;max-width:400px;width:90%;">\n                    <h2 style="color:var(--primary-color);margin-bottom:1rem;text-align:center;">üîê Admin Re-Authentication</h2>\n                    <p style="margin-bottom:1.5rem;color:var(--text-secondary);text-align:center;">This operation requires password confirmation for security.</p>\n                    \n                    <div id="reauth-error" style="display:none;background:rgba(255,0,0,0.1);border:1px solid #ff0000;color:#ff6666;padding:10px;border-radius:5px;margin-bottom:1rem;"></div>\n                    \n                    <form id="reauth-form">\n                        <div style="margin-bottom:1rem;">\n                            <label style="display:block;margin-bottom:0.5rem;color:var(--text-primary);font-weight:500;">Password:</label>\n                            <input type="password" id="reauth-password" required style="width:100%;padding:0.75rem;border:2px solid var(--border-light);border-radius:5px;background:var(--bg-secondary);color:var(--text-primary);font-size:1rem;">\n                        </div>\n                        \n                        <div id="reauth-2fa-section" style="display:none;margin-bottom:1rem;">\n                            <label style="display:block;margin-bottom:0.5rem;color:var(--text-primary);font-weight:500;">2FA Code:</label>\n                            <input type="text" id="reauth-2fa" placeholder="123456" maxlength="6" style="width:100%;padding:0.75rem;border:2px solid var(--border-light);border-radius:5px;background:var(--bg-secondary);color:var(--text-primary);font-size:1rem;text-align:center;letter-spacing:2px;">\n                        </div>\n                        \n                        <div style="display:flex;gap:1rem;margin-top:1.5rem;">\n                            <button type="button" id="reauth-cancel" style="flex:1;padding:0.75rem;background:var(--text-muted);color:white;border:none;border-radius:5px;cursor:pointer;">Cancel</button>\n                            <button type="submit" id="reauth-verify" style="flex:1;padding:0.75rem;background:var(--primary-color);color:white;border:none;border-radius:5px;cursor:pointer;">Verify</button>\n                        </div>\n                    </form>\n                </div>\n            </div>\n        ',document.body.appendChild(i)}function l(){i&&(document.body.removeChild(i),i=null),r&&(r.reject(new Error("Authentication cancelled")),r=null)}return n.showReAuthModal=function(){return new Promise(function(t,n){if(r)return void n(new Error("Re-authentication already in progress"));r={resolve:t,reject:n},c();var e=document.getElementById("reauth-form"),a=document.getElementById("reauth-password"),o=document.getElementById("reauth-2fa"),d=document.getElementById("reauth-2fa-section"),u=document.getElementById("reauth-error"),f=document.getElementById("reauth-cancel");function m(e){u.textContent=e,u.style.display="block"}function h(){u.style.display="none"}a.focus(),h(),f.onclick=function(){l()},e.onsubmit=function(e){e.preventDefault(),h();var i=a.value,c=o.value||null;i?s({action:"verify_reauth",password:i,totp_code:c}).then(function(e){if(e.success)l(),r.resolve(!0);else{if(e.requires_2fa&&"none"===d.style.display)return d.style.display="block",void o.focus();m(e.message||"Authentication failed")}}).catch(function(e){m("Authentication error: "+e.message)}):m("Please enter your password")}})},n.checkReAuthStatus=function(){return s({action:"check_reauth"})},n.clearReAuth=function(){return s({action:"clear_reauth"})},n.handleReAuthError=function(t){return"REAUTH_REQUIRED"===t.error||"IP_CHANGE_DETECTED"===t.error?n.showReAuthModal().then(function(){return!0}).catch(function(){return!1}):Promise.resolve(!1)},n}();return"undefined"!=typeof window&&(window.AdminReAuth=a),a});
